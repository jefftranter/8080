 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 1 - 2024-07-31 11:12:52 AM


       1/      0 :                      ;;;     SYDD - SYSTEM DEVICE DRIVER.
       2/      0 :                      ;
       3/      0 :                      ;       J.G. LETWIN, OCT 77
       4/      0 :                      ;
       5/      0 :                      ;       COPYRIGHT HEATH CO.
       6/      0 :                      
       7/      0 :                      ;;;     SYDD - SYSTEM DEVICE DRIVER.
       8/      0 :                      ;
       9/      0 :                      ;       SYDD IS THE DEVICE DRIVER FOR THE SYSTEM DEVICE, AN H17 MINI/-FLOPPY.
      10/      0 :                      
      11/      0 :                      ;;      ASSEMBLY CONSTANTS
      12/      0 :                      
      13/      0 : =376O                MI.CPI  EQU     376Q            ; CPI INSTRUCTION
      14/      0 : =12O                 ERPTCNT EQU     10              ; SOFT ERROR RETRY COUNT
      15/      0 :                      
      16/      0 :                              INCLUDE mtr.asm
(1)    1/      0 :                      ; MTR - SOURCE CODE FOR THIS WAS NOT PUBLISHED BY THE HEATH CO. AND
(1)    2/      0 :                      ; HAS BEEN REVERSE ENGINEERED.
(1)    3/      0 :                      
(1)    4/      0 : =40.010O             MFLAG   EQU     20010Q          ; USER FLAG OPTIONS
(1)    5/      0 : =40.033O             TICCNT  EQU     20033Q          ; CLOCK TICK COUNTER
(1)    6/      0 : =40.037O             UIVEC   EQU     20037Q          ; USER INTERRUPT VECTOR
(1)    7/      0 :                      
      17/      0 :                              INCLUDE u8251.asm
(1)    1/      0 :                      ;       8251 USART BIT DEFINITIONS.
(1)    2/      0 :                      ;
(1)    3/      0 :                      
(1)    4/      0 :                      ;       PORT ADDRESSES
(1)    5/      0 :                      
(1)    6/      0 : =0O                  UDR     EQU     0               ; DATA REGISTER IS EVEN
(1)    7/      0 : =1O                  UBR     EQU     1               ; STATUS REGISTER IS NEXT
(1)    8/      0 :                      
(1)    9/      0 : =372O                SC.UART EQU     372Q            ; CONSOLE USART ADDRESS (IFF 8251)
(1)   10/      0 :                      
(1)   11/      0 :                      
(1)   12/      0 :                      ;       MODE INSTRUCTION CONTROL BITS.
(1)   13/      0 :                      
(1)   14/      0 : =100O                UMI.1B  EQU     01000000B       ; 1 STOP BIT
(1)   15/      0 : =200O                UMI.HB  EQU     10000000B       ; 1 1/2 STOP BITS
(1)   16/      0 : =300O                UMI.2B  EQU     11000000B       ; 2 STOP BITS
(1)   17/      0 : =40O                 UMI.PE  EQU     00100000B       ; EVEN PARITY
(1)   18/      0 : =20O                 UMI.PA  EQU     00010000B       ; USE PARITY
(1)   19/      0 : =0O                  UMI.L5  EQU     00000000B       ; 5 BIT CHARACTERS
(1)   20/      0 : =4O                  UMI.L6  EQU     00000100B       ; 6 BIT CHARACTERS
(1)   21/      0 : =10O                 UMI.L7  EQU     00001000B       ; 7 BIT CHARACTERS
(1)   22/      0 : =14O                 UMI.L8  EQU     00001100B       ; 8 BIT CHARACTERS
(1)   23/      0 : =1O                  UMI.1X  EQU     00000001B       ; CLOCK X 1
(1)   24/      0 : =2O                  UMI.16X EQU     00000010B       ; CLOCK X 16
(1)   25/      0 : =3O                  UMI.64X EQU     00000011B       ; CLOCK X 64
(1)   26/      0 :                      
(1)   27/      0 :                      ;       COMMAND INSTRUCTION BITS.
(1)   28/      0 :                      
(1)   29/      0 : =100O                UCI.IR  EQU     01000000B       ; INTERNAL RESET
(1)   30/      0 : =40O                 UCI.RO  EQU     00100000B       ; READER-ON CONTROL FLAG
(1)   31/      0 : =20O                 UCI.ER  EQU     00010000B       ; ERROR RESET
(1)   32/      0 : =4O                  UCI.RE  EQU     00000100B       ; RECEIVE ENABLE
(1)   33/      0 : =2O                  UCI.IE  EQU     00000010B       ; ENABLE INTERRUPTS FLAG
(1)   34/      0 : =1O                  UCI.TE  EQU     00000001B       ; TRANSMIT ENABLE
(1)   35/      0 :                      
(1)   36/      0 :                      ;       STATUS READ BITS.
 AS V1.42 Beta [Bld 269] - Source File h17.asm(u8251.asm) - Page 2 - 2024-07-31 11:12:52 AM


(1)   37/      0 :                      
(1)   38/      0 : =40O                 USR.FE  EQU     00100000B       ; FRAMING ERROR
(1)   39/      0 : =20O                 USR.OE  EQU     00010000B       ; OVERRUN ERROR
(1)   40/      0 : =10O                 USR.PE  EQU     00001000B       ; PARITY ERROR
(1)   41/      0 : =4O                  USR.TXE EQU     00000100B       ; TRANSMITTER EMPTY
(1)   42/      0 : =2O                  USR.RXR EQU     00000010B       ; RECEIVER READY
(1)   43/      0 : =1O                  USR.TXR EQU     00000001B       ; TRANSMITTER READY
(1)   44/      0 :                      
      18/      0 :                              INCLUDE ascii.asm
(1)    1/      0 :                      ; ASCII - SOURCE CODE FOR THIS WAS NOT PUBLISHED BY THE HEATH CO. AND
(1)    2/      0 :                      ; HAS BEEN REVERSE ENGINEERED.
(1)    3/      0 :                      
(1)    4/      0 :                      ; Constants
(1)    5/      0 :                      
(1)    6/      0 : =15O                 CR      EQU     15Q             ; Carriage Return
(1)    7/      0 : =12O                 LF      EQU     12Q             ; Line Feed
(1)    8/      0 : =7O                  BELL    EQU     07Q             ; Bell
(1)    9/      0 :                      
      19/      0 :                              INCLUDE hosdef.asm
(1)    1/      0 :                      ;;      HOSDEF - DEFINE HOS PARAMETER.
(1)    2/      0 :                      ;
(1)    3/      0 :                      
(1)    4/      0 : =377O                SYSCALL EQU     377Q            ; SYSCALL INSTRUCTION
(1)    5/      0 :                      
(1)    6/      0 :                              ORG     0
(1)    7/      0 :                      
(1)    8/      0 :                      ;       RESIDENT FUNCTIONS
(1)    9/      0 :                      
(1)   10/      0 :                      .EXIT   DS      1               ; EXIT (MUST BE FIRST)
(1)   11/      1 :                      .SCIN   DS      1               ; SCIN
(1)   12/      2 :                      SCOUT   DS      1               ; SCOUT
(1)   13/      3 :                      .PRINT  DS      1               ; PRINT
(1)   14/      4 :                      .READ   DS      1               ; READ
(1)   15/      5 :                      .WRITE  DS      1               ; WRITE
(1)   16/      6 :                      .CONSL  DS      1               ; SET/CLEAR CONSOLE OPTIONS
(1)   17/      7 :                      .CLRCO  DS      1               ; CLEAR CONSOLE BUFFER
(1)   18/     10 :                      .SYSRES DS      1               ; PRECEDING FUNCTIONS ARE RESIDENT
(1)   19/     11 :                      
(1)   20/     11 :                      ;       HDOSOVL0.SYS FUNCTIONS
(1)   21/     11 :                      
(1)   22/     40 :                              ORG     40Q
(1)   23/     40 :                      
(1)   24/     40 :                      .LINK   DS      1               ; LINK  (MUST BE FIRST)
(1)   25/     41 :                      .CTLC   DS      1               ; CTL-C
(1)   26/     42 :                      .OPENR  DS      1               ; OPENR
(1)   27/     43 :                      .OPENW  DS      1               ; OPENW
(1)   28/     44 :                      .OPENU  DS      1               ; OPENU
(1)   29/     45 :                      .OPENC  DS      1               ; OPENC
(1)   30/     46 :                      .CLOSE  DS      1               ; CLOSE
(1)   31/     47 :                      .POSIT  DS      1               ; POSITION
(1)   32/     50 :                      .DELET  DS      1               ; DELETE
(1)   33/     51 :                      .RENAM  DS      1               ; RENAME
(1)   34/     52 :                      .SETTP  DS      1               ; SETTOP
(1)   35/     53 :                      .DECODE DS      1               ; NAME DECODE
(1)   36/     54 :                      .NAME   DS      1               ; GET FILE NAME FROM CHANNEL
(1)   37/     55 :                      .CLEAR  DS      1               ; CLEAR CHAN
(1)   38/     56 :                      .CLEARA DS      1               ; CLEAR ALL CHANS
(1)   39/     57 :                      .ERROR  DS      1               ; LOOKUP ERROR
(1)   40/     60 :                      .CHFLG  DS      1               ; CHANGE FLAGS
(1)   41/     61 :                      .DISMT  DS      1               ; FLAG SYSTEM DISK DISMOUNTED
 AS V1.42 Beta [Bld 269] - Source File h17.asm(hosdef.asm) - Page 3 - 2024-07-31 11:12:52 AM


(1)   42/     62 :                      
      20/     62 :                              INCLUDE dirdef.asm
(1)    1/     62 :                      ;;      DIRECTORY ENTRY FORMAT.
(1)    2/     62 :                      
(1)    3/      0 :                              ORG     0
(1)    4/      0 :                      
(1)    5/      0 : =377O                DF.EMP  EQU     377Q            ; FLAGS ENTRY EMPTY
(1)    6/      0 : =376O                DF.CLR  EQU     376Q            ; FLAGS ENTRY EMPTY, REST OF DIR ALSO CLEAR
(1)    7/      0 :                      
(1)    8/      0 :                      DIR.NAM DS      8               ; NAME
(1)    9/     10 :                      DIR.EXT DS      3               ; EXTENSION
(1)   10/     13 :                      DIR.PRO DS      1               ; PROJECT
(1)   11/     14 :                      DIR.VER DS      1               ; VERSION
(1)   12/     15 : =15O                 DIRIDL  EQU     $               ; FILE IDENTIFICATION LENGTH
(1)   13/     15 :                      
(1)   14/     15 :                      DIR.CLU DS      1               ; CLUSTER FACTOR
(1)   15/     16 :                      DIR.FLG DS      1               ; FLAGS
(1)   16/     17 :                              DS      1               ; RESERVED
(1)   17/     20 :                      DIR.FGN DS      1               ; FIRST GROUP NUMBER
(1)   18/     21 :                      DIR.LGN DS      1               ; LAST GROUP NUMBER
(1)   19/     22 :                      DIR.LSI DS      1               ; LAST SECTOR INDEX (IN LAST GROUP)
(1)   20/     23 :                      DIR.CRD DS      2               ; CREATION DATE
(1)   21/     25 :                      DIR.ALD DS      2               ; LAST ALTERATION DATE
(1)   22/     27 :                      
(1)   23/     27 : =27O                 DIRELEN EQU     $               ; DIRECTORY ENTRY LENGTH
(1)   24/     27 :                      
      21/     27 :                              INCLUDE devdef.asm
(1)    1/     27 :                      ;;      DEVICE TABLE ENTRYS.
(1)    2/     27 :                      
(1)    3/      0 :                              ORG     0
(1)    4/      0 :                      
(1)    5/      0 :                      DEV.NAM DS      2               ; DEVICE NAME
(1)    6/      2 :                      DEV.RES DS      1               ; DRIVER RESIDENT CODE
(1)    7/      3 : =1O                  DR.IM   EQU     00000001B       ; DRIVER IN MEMORY
(1)    8/      3 : =2O                  DR.PRG  EQU     00000010B       ; DRIVER PERMANENTLY RESIDENT
(1)    9/      3 :                      
(1)   10/      3 :                      DEV.JMP DS      1               ; JMP TO PROCESSOR
(1)   11/      4 :                      DEV.DDA DS      2               ; DRIVER ADDRESS
(1)   12/      6 :                      DEV.FLG DS      1               ; FLAG BYTE
(1)   13/      7 : =1O                  DT.DD   EQU     00000001B       ; DIRECTORY DEVICE
(1)   14/      7 : =2O                  DT.CR   EQU     00000010B       ; CAPABLE OF READ OPERATION
(1)   15/      7 : =4O                  DT.CW   EQU     00000100B       ; CAPABLE OF WRITE OPERATION
(1)   16/      7 :                      
(1)   17/      7 :                      DEV.GRT DS      2               ; ADDRESS OF GROUP RESERVATION TABLE (IF DIRECTORY)
(1)   18/     11 :                      DEV.SPG DS      1               ; SECTORS PER GROUP THIS DEVICE
(1)   19/     12 :                      DEV.MUM                         ; MOUNTED UNIT MASK
(1)   20/     12 :                      DEV.MNU DS      1               ; MAXIMUM NUMBER OF UNITS
(1)   21/     13 :                      DEV.DVL DS      2               ; DRIVER BYTE LENGTH
(1)   22/     15 :                      DEV.DVG DS      1               ; DRIVER ROUTINE GROUP ADDRESS
(1)   23/     16 :                      DEV.DIR DS      2               ; DIRECTORY FIRST SECTOR ADDRESS
(1)   24/     20 :                      DEV.GTS DS      2               ; GET SECTOR NUMBER
(1)   25/     22 :                      
      22/     22 :                              INCLUDE h17def.asm
(1)    1/     22 :                      ;       H17 CONTROL INFORMATION.
(1)    2/     22 :                      
(1)    3/     22 : =177O                DP.DC   EQU     07FH            ; DISK CONTROL PORT
(1)    4/     22 :                      
(1)    5/     22 : =1O                  DF.HD   EQU     00000001B       ; HOLE DETECT
(1)    6/     22 : =2O                  DF.T0   EQU     00000010B       ; TRACK 0 DETECT
(1)    7/     22 : =4O                  DF.WP   EQU     00000100B       ; WRITE PROTECT
 AS V1.42 Beta [Bld 269] - Source File h17.asm(h17def.asm) - Page 4 - 2024-07-31 11:12:52 AM


(1)    8/     22 : =10O                 DF.SD   EQU     00001000B       ; SYNC DETECT
(1)    9/     22 :                      
(1)   10/     22 : =1O                  DF.WQ   EQU     00000001B       ; WRITE GATE ENABLE
(1)   11/     22 : =2O                  DF.DS0  EQU     00000010B       ; DRIVE SELECT 0
(1)   12/     22 : =4O                  DF.DS1  EQU     00000100B       ; DRIVE SELECT 1
(1)   13/     22 : =10O                 DF.DS2  EQU     00001000B       ; DRIVE SELECT 2
(1)   14/     22 : =20O                 DF.MO   EQU     00010000B       ; MOTOR ON (BOTH DRIVES)
(1)   15/     22 : =40O                 DF.DI   EQU     00100000B       ; DIRECTION (0=OUT)
(1)   16/     22 : =100O                DF.ST   EQU     01000000B       ; STEP COMMAND (ACTIVE HIGH)
(1)   17/     22 : =200O                DF.WR   EQU     10000000B       ; WRITE ENABLE RAM
(1)   18/     22 :                      
(1)   19/     22 :                      ;       DISK UART PORTS AND CONTROL FLAGS.
(1)   20/     22 :                      
(1)   21/     22 : =174O                UP.DP   EQU     07CH            ; DATA PORT
(1)   22/     22 : =175O                UP.FC   EQU     07DH            ; FILL CHARACTER
(1)   23/     22 : =175O                UP.ST   EQU     07DH            ; STATUS FLAGS
(1)   24/     22 : =176O                UP.SC   EQU     07EH            ; SYN CHARACTER (OUTPUT)
(1)   25/     22 : =176O                UP.SR   EQU     07EH            ; SYNC RESET (INPUT)
(1)   26/     22 :                      
(1)   27/     22 : =1O                  UF.RDA  EQU     00000001B       ; RECEIVE DATA AVAILABLE
(1)   28/     22 : =2O                  UF.ROR  EQU     00000010B       ; RECEIVER OVERRUN
(1)   29/     22 : =4O                  UF.RPE  EQU     00000100B       ; RECEIVER PARITY ERROR
(1)   30/     22 : =100O                UF.FCT  EQU     01000000B       ; FILL CHAR TRANSMITTED
(1)   31/     22 : =200O                UF.TB   EQU     10000000B       ; TRANSMITTER BUFFER EMPTY
(1)   32/     22 :                      
(1)   33/     22 :                      ;       CHARACTER DEFINITIONS
(1)   34/     22 :                      
(1)   35/     22 : =375O                C.DSYN  EQU     0FDH            ; PREFIX SYNC CHARACTER
(1)   36/     22 :                      
      23/     22 :                              INCLUDE ecdef.asm
(1)    1/     22 :                      ;;      ERROR CODE DEFINITIONS
(1)    2/     22 :                      
(1)    3/      0 :                              ORG     0
(1)    4/      0 :                              DS      1               ; NO ERROR #0
(1)    5/      1 :                      EC.EOF  DS      1               ; END OF FILE
(1)    6/      2 :                      EC.EOM  DS      1               ; END OF MEDIA
(1)    7/      3 :                      EC.ILC  DS      1               ; ILLEGAL SYSCALL CODE
(1)    8/      4 :                      EC.CNA  DS      1               ; CHANNEL NOT AVAILABLE
(1)    9/      5 :                      EC.DNS  DS      1               ; DEVICE NOT SUITABLE
(1)   10/      6 :                      EC.IDN  DS      1               ; ILLEGAL DEVICE NAME
(1)   11/      7 :                      EC.IFN  DS      1               ; ILLEGAL FILE NAME
(1)   12/     10 :                      EC.NRD  DS      1               ; NO ROOM FOR DEVICE DRIVER
(1)   13/     11 :                      EC.FNO  DS      1               ; CHANNEL NOT OPEN
(1)   14/     12 :                      EC.ILR  DS      1               ; ILLEGAL REQUEST
(1)   15/     13 :                      EC.FUC  DS      1               ; FILE USAGE CONFLICT
(1)   16/     14 :                      EC.FNF  DS      1               ; FILE NAME NOT FOUND
(1)   17/     15 :                      EC.UND  DS      1               ; UNKNOWN DEVICE
(1)   18/     16 :                      EC.ICN  DS      1               ; ILLEGAL CHANNEL NUMBER
(1)   19/     17 :                      EC.DIF  DS      1               ; DIRECTORY FULL
(1)   20/     20 :                      EC.IFC  DS      1               ; ILLEGAL FILE CONTENTS
(1)   21/     21 :                      EC.NEM  DS      1               ; NOT ENOUGH MEMORY
(1)   22/     22 :                      EC.RF   DS      1               ; READ FAILURE
(1)   23/     23 :                      EC.WF   DS      1               ; WRITE FAILURE
(1)   24/     24 :                      EC.WPV  DS      1               ; WRITE PROTECTION VIOLATION
(1)   25/     25 :                      EC.WP   DS      1               ; DISK WRITE PROTECTED
(1)   26/     26 :                      EC.FAP  DS      1               ; FILE ALREADY PRESENT
(1)   27/     27 :                      EC.DDA  DS      1               ; DEVICE DRIVER ABORT
(1)   28/     30 :                      EC.FL   DS      1               ; FILE LOCKED
(1)   29/     31 :                      EC.FAO  DS      1               ; FILE ALREADY OPEN
(1)   30/     32 :                      EC.IS   DS      1               ; ILLEGAL SWITCH
 AS V1.42 Beta [Bld 269] - Source File h17.asm(ecdef.asm) - Page 5 - 2024-07-31 11:12:52 AM


(1)   31/     33 :                      EC.UUN  DS      1               ; UNKNOWN UNIT NUMBER
(1)   32/     34 :                      EC.FNR  DS      1               ; FILE NAME REQUIRED
(1)   33/     35 :                      EC.DIW  DS      1               ; DEVICE IS NOT WRITABLE (OR WRITE LOCKED)
(1)   34/     36 :                      EC.UNA  DS      1               ; UNIT NOT AVAILABLE
(1)   35/     37 :                      EC.ILV  DS      1               ; ILLEGAL VALUE
(1)   36/     40 :                      EC.ILO  DS      1               ; ILLEGAL OPTION
(1)   37/     41 :                      
      24/     41 :                              INCLUDE dddef.asm
(1)    1/     41 :                      ;;      DEVICE DRIVER COMMUNICATION FLAGS
(1)    2/     41 :                      ;
(1)    3/      0 :                              ORG     0
(1)    4/      0 :                      
(1)    5/      0 :                      DC.REA  DS      1               ; READ
(1)    6/      1 :                      DC.WRI  DS      1               ; WRITE
(1)    7/      2 :                      DC.RER  DS      1               ; READ REGARDLESS
(1)    8/      3 :                      DC.OPR  DS      1               ; OPEN FOR READ
(1)    9/      4 :                      DC.OPW  DS      1               ; OPEN FOR WRITE
(1)   10/      5 :                      DC.OPU  DS      1               ; OPEN FOR UPDATE
(1)   11/      6 :                      DC.CLU  DS      1               ; CLOSE
(1)   12/      7 :                      DC.ABT  DS      1               ; ABORT
(1)   13/     10 :                      DC.MOV  DS      1               ; MOUNT DEVICE
(1)   14/     11 :                      
      25/     11 :                              INCLUDE picdef.asm
(1)    1/     11 :                      ;;      PIC FORMAT EQUIVALENCES.
(1)    2/     11 :                      
(1)    3/      0 :                              ORG     0
(1)    4/      0 :                      
(1)    5/      0 :                      PIC.ID  DS      1               ; 377Q = BINARY FILE FLAG
(1)    6/      1 :                              DS      1               ; FILE TYPE (FT.PIC)
(1)    7/      2 :                      PIC.LEN DS      2               ; LENGTH OF ENTIRE RECORD
(1)    8/      4 :                      PIC.PTR DS      2               ; INDEX OF START OF PIC TABLE
(1)    9/      6 :                      
(1)   10/      6 :                      PIC.COD                         ; CODE STARTS HERE
(1)   11/      6 :                      
      26/      6 :                              INCLUDE hosequ.asm
(1)    1/      6 :                      ;;	HDOS SYSTEM EQUIVALENCES.
(1)    2/      6 :                      ;
(1)    3/      6 :                      
(1)    4/      6 : =24.000O             S.GRT   EQU     12000Q          ; SYSTEM AREA FOR GRT0
(1)    5/      6 : =25.000O             S.GRT1  EQU     12400Q          ; SYSTEM AREAS FOR GRT 1
(1)    6/      6 : =26.000O             SECSCR  EQU     13000Q          ; SYSTEM 512 BYTE SCRATCH AREA
(1)    7/      6 : =30.000O             ROMBOOT EQU     14000Q          ; ROM BOOT ENTRY
(1)    8/      6 :                      
(1)    9/ 40.100 :                              ORG     020100Q         ; FREE SPACE FROM PAM-8
(1)   10/ 40.100 :                      
(1)   11/ 40.100 :                              DS      8
(1)   12/ 40.110 :                      D.CON   DS      16              ; DISK CONSTANTS        
(1)   13/ 40.130 : =40.130O             SYDD    EQU     $               ; SYSTEM DISK ENTRY POINT
(1)   14/ 40.130 :                      D.VEC   DS      24*3            ; SYSTEM ROM ENTRY VECTORS
(1)   15/ 40.240 :                      D.RAM   DS      31              ; SYSTEM ROM WORK AREA
(1)   16/ 40.277 :                      S.VAL   DS      38              ; SYSTEM VALUES
(1)   17/ 40.345 :                      S.INT   DS      113             ; SYSTEM INTERNAL WORK AREAS
(1)   18/ 41.126 :                              DS      16
(1)   19/ 41.146 :                      S.SOVR  DS      2               ; STACK OVERFLOW WARNING
(1)   20/ 41.150 :                              DS      21200Q-$        ; SYSTEM STACK
(1)   21/ 42.200 :                      
(1)   22/ 42.200 : =42.200O             STACK   EQU     $               ; LWA+1 SYSTEM STACK
(1)   23/ 42.200 : =42.200O             USERFWA EQU     $               ; USER FWA
(1)   24/ 42.200 :                      
      27/ 42.200 :                              INCLUDE edcon.asm
 AS V1.42 Beta [Bld 269] - Source File h17.asm(edcon.asm) - Page 6 - 2024-07-31 11:12:52 AM


(1)    1/ 42.200 :                      ;;      D.CON DETAILED EQUIVALENCES.
(1)    2/ 42.200 :                      ;
(1)    3/ 42.200 :                      ;       HOSEQU MUST BE MODIFIED WHEN THIS TABLE IS MODIFIED.
(1)    4/ 42.200 :                      
(1)    5/ 40.110 :                              ORG      D.CON
(1)    6/ 40.110 :                      
(1)    7/ 40.110 :                      D.XITA  DS       2              ; SEE SYSTEM ROM FOR DESCRIPTION
(1)    8/ 40.112 :                      D.WRITA DS       1
(1)    9/ 40.113 :                      D.WRITB DS       1
(1)   10/ 40.114 :                      D.WRITC DS       1
(1)   11/ 40.115 :                      D.MAIA  DS       1
(1)   12/ 40.116 :                      D.LPSA  DS       1
(1)   13/ 40.117 :                      D.SDPA  DS       1
(1)   14/ 40.120 :                      D.SDPB  DS       1
(1)   15/ 40.121 :                      D.STSA  DS       1
(1)   16/ 40.122 :                      D.STSB  DS       1
(1)   17/ 40.123 :                      D.WHDA  DS       1
(1)   18/ 40.124 :                      D.WNHA  DS       1
(1)   19/ 40.125 :                      D.WSCA  DS       1
(1)   20/ 40.126 :                      
(1)   21/ 40.126 :                      D.ERTS  DS       2              ; TRACK AND SECTOR OF LAST DISK ERRORS
(1)   22/ 40.130 :                      
      28/ 40.130 :                              INCLUDE edvec.asm
(1)    1/ 40.130 :                      ;;      JMP VECTORS FOR ROM CODE
(1)    2/ 40.130 :                      ;
(1)    3/ 40.130 :                      ;       SEE DISK ROM FOR ADDRESSES
(1)    4/ 40.130 :                      ;
(1)    5/ 40.130 :                      ;       HOSEQU MUST BE ALTERED WHEN THIS TABLE IS ALTERED.
(1)    6/ 40.130 :                      
(1)    7/ 40.130 :                              ORG     D.VEC
(1)    8/ 40.130 :                      
(1)    9/ 40.130 :                      D.SYDD  DS      3               ; JMP  R.SYDD (MUST BE FIRST)
(1)   10/ 40.133 :                      D.MOUNT DS      3               ; JMP  R.MOUNT
(1)   11/ 40.136 :                      D.XOK   DS      3               ; JMP  R.XOK
(1)   12/ 40.141 :                      D.ABORT DS      3               ; JMP  R.ABORT
(1)   13/ 40.144 :                      D.XIT   DS      3               ; JMP  R.XIT
(1)   14/ 40.147 :                      D.READ  DS      3               ; JMP  R.READ
(1)   15/ 40.152 :                      D.READR DS      3               ; JMP  R.READR
(1)   16/ 40.155 :                      D.WRITE DS      3               ; JMP  R.WRITE
(1)   17/ 40.160 :                      D.CDE   DS      3               ; JMP  R.CDE
(1)   18/ 40.163 :                      D.DTS   DS      3               ; JMP  R.DTS
(1)   19/ 40.166 :                      D.SDT   DS      3               ; JMP  R.SDT
(1)   20/ 40.171 :                      D.MAI   DS      3               ; JMP  R.MAI
(1)   21/ 40.174 :                      D.MAO   DS      3               ; JMP  R.MAO
(1)   22/ 40.177 :                      D.LPS   DS      3               ; JMP  R.LPS
(1)   23/ 40.202 :                      D.RDB   DS      3               ; JMP  R.RDB
(1)   24/ 40.205 :                      D.SDP   DS      3               ; JMP  R.SDP
(1)   25/ 40.210 :                      D.STS   DS      3               ; JMP  R.STS
(1)   26/ 40.213 :                      D.STZ   DS      3               ; JMP  R.STZ
(1)   27/ 40.216 :                      D.UDLY  DS      3               ; JMP  R.UDLY
(1)   28/ 40.221 :                      D.WSC   DS      3               ; JMP  R.WSC
(1)   29/ 40.224 :                      D.WSP   DS      3               ; JMP  R.WSP
(1)   30/ 40.227 :                      D.WNB   DS      3               ; JMP  R.WNB
(1)   31/ 40.232 :                      D.ERRT  DS      3               ; JMP  R.ERRT
(1)   32/ 40.235 :                      D.DLY   DS      3               ; JMP  R.DLY
(1)   33/ 40.240 :                      
      29/ 40.240 :                              INCLUDE edram.asm
(1)    1/ 40.240 :                      ;;      EDRAM - DISK RAM WORAREA DEFINITION.
(1)    2/ 40.240 :                      ;
(1)    3/ 40.240 :                      ;       ZEROED UPON BOOTING UP.
 AS V1.42 Beta [Bld 269] - Source File h17.asm(edram.asm) - Page 7 - 2024-07-31 11:12:52 AM


(1)    4/ 40.240 :                      ;
(1)    5/ 40.240 :                      ;       HOSEQU MUST BE CHANGED WHEN THIS DECK IS CHANGED.
(1)    6/ 40.240 :                      
(1)    7/ 40.240 :                              ORG     D.RAM
(1)    8/ 40.240 :                      
(1)    9/ 40.240 :                      D.TT    DS      1               ; TARGET TRACK (CURRENT OPERATION)
(1)   10/ 40.241 :                      D.TS    DS      1               ; TARGET SECTOR (CURRENT OPERATION)
(1)   11/ 40.242 :                      
(1)   12/ 40.242 :                      D.DVCTL DS      1               ; DEVICE CONTROL BYTE
(1)   13/ 40.243 :                      
(1)   14/ 40.243 :                      D.DLYMO DS      1               ; MOTOR ON DELAY COUNT
(1)   15/ 40.244 :                      D.DLYHS DS      1               ; HEAD SETTLE DELAY COUNTER
(1)   16/ 40.245 :                      
(1)   17/ 40.245 :                      D.TRKPT DS      2               ; ADDRESS IN D.DRVTB FOR TRACK NUMBER
(1)   18/ 40.247 :                      D.VOLPT DS      2               ; ADDRESS IN D.DRVTB FOR VOLUME NUMBER
(1)   19/ 40.251 :                      
(1)   20/ 40.251 :                      D.DRVTB DS      2*4             ; TRACK NUMBER AND VOLUME NUMBER FOR 4 DRIVES
(1)   21/ 40.261 :                      
(1)   22/ 40.261 :                      D.HECNT DS      1               ; HARD ERROR COUNT
(1)   23/ 40.262 :                      D.SECNT DS      2               ; SOFT ERROR COUNT
(1)   24/ 40.264 :                      D.OECNT DS      1               ; OPERATION ERROR COUNT
(1)   25/ 40.265 :                      
(1)   26/ 40.265 :                      ;       GLOBAL DISK ERROR COUNTERS
(1)   27/ 40.265 :                      
(1)   28/ 40.265 :                      D.ERR                           ; BEGINNING OF ERROR BLOCK
(1)   29/ 40.265 :                      D.E.MDS DS     1                ; MISSING DATA SYNC
(1)   30/ 40.266 :                      D.E.HSY DS     1                ; MISSING HEADER SYNC
(1)   31/ 40.267 :                      D.E.CHK DS     1                ; DATA CHECKSUM
(1)   32/ 40.270 :                      D.E.HCK DS     1                ; HEADER CHECKSUM
(1)   33/ 40.271 :                      D.E.VOL DS     1                ; WRONG VOLUME NUMBER
(1)   34/ 40.272 :                      D.E.TRK DS     1                ; BAD TRACK SEEK
(1)   35/ 40.273 :                      D.ERRL                          ; LIST OF ERROR COUNTERS
(1)   36/ 40.273 :                      
(1)   37/ 40.273 :                      ;       I/O OPERATION COUNTS
(1)   38/ 40.273 :                      
(1)   39/ 40.273 :                      D.OPR   DS  2
(1)   40/ 40.275 :                      D.OPW   DS  2
(1)   41/ 40.277 :                      
(1)   42/ 40.277 : =37O                 D.RAML  EQU $-D.RAM
(1)   43/ 40.277 :                      
      30/ 40.277 :                              INCLUDE esval.asm
(1)    1/ 40.277 :                      ;;      S.VAL - SYSTEM VALUE DEFINITIONS.
(1)    2/ 40.277 :                      ;
(1)    3/ 40.277 :                      ;       THESE VALUES ARE SET AND MAINTAINED BY THE SYSTEM.
(1)    4/ 40.277 :                      ;
(1)    5/ 40.277 :                      ;       THE DECK HOSEQU MUST BE MODIFIED WHEN THIS IS MODIFIED.
(1)    6/ 40.277 :                      
(1)    7/ 40.277 :                              ORG     S.VAL
(1)    8/ 40.277 :                      
(1)    9/ 40.277 :                      S.DATE  DS      9               ; SYSTEM DATE (IN ASCII)
(1)   10/ 40.310 :                      S.DATC  DS      2               ; CODED DATE
(1)   11/ 40.312 :                      S.TIME  DS      4               ; TIME FROM MIDNIGHT (IN TICS)
(1)   12/ 40.316 :                      S.HIMEM DS      2               ; HARDWARE HIGH MEMORY ADDRESS+1
(1)   13/ 40.320 :                      
(1)   14/ 40.320 :                      S.SYSM  DS      2               ; FWA RESIDENT SYSTEM
(1)   15/ 40.322 :                      
(1)   16/ 40.322 :                      S.USRM  DS      2               ; LWA USER MEMORY
(1)   17/ 40.324 :                      
(1)   18/ 40.324 :                      S.OMAX  DS      2               ; MAX OVERLAY SIZE FOR SYSTEM
(1)   19/ 40.326 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm(esval.asm) - Page 8 - 2024-07-31 11:12:52 AM


(1)   20/ 40.326 :                      ;;      THE FOLLOWING FIVE CELLS SHOULD BE MODIFIED/READ ONLY VIA THE .CONSL SYSCALL
(1)   21/ 40.326 :                      
(1)   22/ 40.326 : =200O                CSL.ECH EQU     10000000B       ; SUPPRESS ECHO
(1)   23/ 40.326 : =2O                  CSL.WRP EQU     00000010B       ; WRAP LINES AT WIDTH
(1)   24/ 40.326 : =1O                  CSL.CHR EQU     00000001B       ; OPERATE IN CHARACTER MODE
(1)   25/ 40.326 :                      
(1)   26/ 40.326 : =0O                  I.CSLMD EQU     0               ; S.CSLMD IS FIRST BYTE
(1)   27/ 40.326 : =1O                  S.CSLMD EQU     1               ; CONSOLE MODE
(1)   28/ 40.326 :                      
(1)   29/ 40.326 : =200O                CTP.BKS EQU     10000000B       ; TERMINAL PROCESSES BACKSPACES
(1)   30/ 40.326 : =40O                 CTP.MLI EQU     00100000B       ; MAP LOWER CASE TO UPPER ON INPUT
(1)   31/ 40.326 : =20O                 CTP.MLO EQU     00010000B       ; MAP LOWER CASE TO UPPER ON OUTPUT
(1)   32/ 40.326 : =10O                 CTP.2SB EQU     00001000B       ; TERMINAL NEEDS TWO STOP BITS
(1)   33/ 40.326 : =2O                  CTP.BKM EQU     00000010B       ; MAP BKSP (UPON INPUT) TO RUBOUT
(1)   34/ 40.326 : =1O                  CTP.TAB EQU     00000001B       ; TERMINAL SUPPORTS TAB CHARACTERS
(1)   35/ 40.326 :                      
(1)   36/ 40.326 : =1O                  I.CONTY EQU     1               ; S.CONTY IS 2ND BYTE
(1)   37/ 40.326 :                      S.CONTY DS      1               ; CONSOLE TYPE FLAGS
(1)   38/ 40.327 : =2O                  I.CUSOR EQU     2               ; S.CUSOR IS 3RD BYTE
(1)   39/ 40.327 :                      S.CUSOR DS      1               ; CURRENT CURSOR POSITION
(1)   40/ 40.330 : =3O                  I.CONWI EQU     3               ; S.CONWI IS 4TH BYTE
(1)   41/ 40.330 :                      S.CONWI DS      1               ; CONSOLE WIDTH
(1)   42/ 40.331 :                      
(1)   43/ 40.331 : =1O                  CO.FLG  EQU     00000001B       ; CTL-O FLAG
(1)   44/ 40.331 : =200O                CS.FLG  EQU     10000000B       ; CTL-S FLAG
(1)   45/ 40.331 :                      
(1)   46/ 40.331 : =4O                  I.CONFL EQU     4               ; S.CONFL IS 5TH BYTE
(1)   47/ 40.331 :                      S.CONFL DS      1               ; CONSOLE FLAGS
(1)   48/ 40.332 :                      
(1)   49/ 40.332 :                      S.CAADR DS      2               ; ADDRESS FOR ABORT PROCESSING (>256 IF VALID)
(1)   50/ 40.334 :                      S.CCTAB DS      6               ; ADDR FOR CTL-A, CTL-B, CTL-C PROCESSING
(1)   51/ 40.342 :                      
      31/ 40.342 :                              INCLUDE esint.asm
(1)    1/ 40.342 :                      ;;      S.INT - SYSTEM INTERNAL WORKAREA DEFINITIONS.
(1)    2/ 40.342 :                      ;
(1)    3/ 40.342 :                      ;       THESE CELLS ARE REFERENCED BY OVERLAYS AND MAIN CODE, AND
(1)    4/ 40.342 :                      ;       MUST THEREFORE RESIDE IN FIXED LOW MEMORY
(1)    5/ 40.342 :                      
(1)    6/ 40.342 :                      
(1)    7/ 40.345 :                              ORG     S.INT
(1)    8/ 40.345 :                      
(1)    9/ 40.345 :                      ;;      CONSOLE STATUS FLAGS
(1)   10/ 40.345 :                      
(1)   11/ 40.345 :                      S.CDB   DS      1               ; CONSOLE DESCRIPTOR BYTE
(1)   12/ 40.346 : =0O                  CDB.H85 EQU     00000000B
(1)   13/ 40.346 : =1O                  CDB.H84 EQU     00000001B       ; =0 IF H8-5, =1 IF H8-4
(1)   14/ 40.346 :                      S.BAUD  DS      2               ; [0-14]  H8-4 BAUD RATE, =0 IF H8-5
(1)   15/ 40.350 :                      ;                               ; [15]    =1 IF BAUD RATE => 2 STOP BITS
(1)   16/ 40.350 :                      ;
(1)   17/ 40.350 :                      
(1)   18/ 40.350 :                      ;;      TABLE ADDRESS WORDS
(1)   19/ 40.350 :                      
(1)   20/ 40.350 :                      S.DLINK DS      2               ; ADDRESS OF DATA IN HDOS CODE
(1)   21/ 40.352 :                      S.CFWA  DS      2               ; FWA CHANNEL TABLE
(1)   22/ 40.354 :                      S.DFWA  DS      2               ; FWA DEVICE TABLE
(1)   23/ 40.356 :                      S.RFWA  DS      2               ; FWA RESIDENT HDOS CODE
(1)   24/ 40.360 :                      
(1)   25/ 40.360 :                      ;;      DEVICE DRIVER DELAYED LOAD FLAGS
(1)   26/ 40.360 :                      
(1)   27/ 40.360 :                      S.DDLDA DS      2               ; DRIVER LOAD ADDRESS (HIGH BYTE=0 IF NO LOAD PENDING)
 AS V1.42 Beta [Bld 269] - Source File h17.asm(esint.asm) - Page 9 - 2024-07-31 11:12:52 AM


(1)   28/ 40.362 :                      S.DDLEN DS      2               ; CODE LENGTH IN BYTES
(1)   29/ 40.364 :                      S.DDGRP DS      1               ; GROUP NUMBER FOR DRIVER
(1)   30/ 40.365 :                              DS      1               ; HOLD PLACE
(1)   31/ 40.366 :                      ;S.DDSEC DS     2               ; SECTOR NUMBER FOR DRIVER ( * OBSOLETE ! * )
(1)   32/ 40.366 :                      S.DDDTA DS      2               ; DEVICE'S ADDRESS IKN DEVLST +DEV.RES
(1)   33/ 40.370 :                      S.DDOPC DS      1               ; OPEN OPCODE PENDING
(1)   34/ 40.371 :                      
(1)   35/ 40.371 :                      ;;      OVERLAY MANAGEMENT FLAGS
(1)   36/ 40.371 :                      
(1)   37/ 40.371 : =1O                  OVL.IN  EQU     00000001B       ; IN MEMORY
(1)   38/ 40.371 : =2O                  OVL.RES EQU     00000010B       ; PERMANENTLY RESIDENT
(1)   39/ 40.371 : =200O                OVL.UCS EQU     10000000B       ; USER CODE SWAPPED FOR OVERLAY
(1)   40/ 40.371 :                      
(1)   41/ 40.371 :                      S.OVLFL DS      1               ; OVERLAY FLAG
(1)   42/ 40.372 :                      S.UCSF  DS      2               ; FWA SWAPPED USER CODE
(1)   43/ 40.374 :                      S.UCSL  DS      2               ; LENGTH SWAPPED USER CODE
(1)   44/ 40.376 :                      S.OVLS  DS      2               ; SIZE OF OVERLAY CODE
(1)   45/ 41.000 :                      S.OVLE  DS      2               ; ENTRY POINT OF OVERLAY CODE
(1)   46/ 41.002 :                      
(1)   47/ 41.002 :                      S.SSN   DS      2               ; SWAP AREA SECTOR NUMBER
(1)   48/ 41.004 :                      S.OSN   DS      2               ; OVERLAY SECTOR NUMBER
(1)   49/ 41.006 :                      
(1)   50/ 41.006 :                      ;       SYSCALL PROCESSING WORK AREAS
(1)   51/ 41.006 :                      
(1)   52/ 41.006 :                      S.CACC  DS      1               ; (ACC) UPON SYSCALL
(1)   53/ 41.007 :                      S.CODE  DS      1               ; SYSCALL INDEX IN PROGRESS
(1)   54/ 41.010 :                      
(1)   55/ 41.010 :                      ;       JUMPS TO ROUTINES IN RESIDENT HDOS CODE
(1)   56/ 41.010 :                      
(1)   57/ 41.010 :                      S.JUMPS                         ; START OF DUMP VECTORS
(1)   58/ 41.010 :                      S.SDD   DS      3               ; JUMP TO STAND-IN DEVICE DRIVER
(1)   59/ 41.013 :                      S.FASER DS      3               ; JUMP TO FATSERR (FATAL SYSTEM ERROR)
(1)   60/ 41.016 :                      S.DIREA DS      3               ; JUMP TO DIREAD (DISK FILE READ)
(1)   61/ 41.021 :                      S.FCI   DS      3               ; JUMP TO FCI (FETCH CHANNEL READ)
(1)   62/ 41.024 :                      S.SCI   DS      3               ; JUMP TO SCI (STORE CHANNEL INFO)
(1)   63/ 41.027 :                      S.MOUNT DS      1               ; <>0 IF THE SYSTEM DISK IS MOUNTED
(1)   64/ 41.030 :                      S.DCS   DS      1               ; DEFAULT CLUSTER SIZE-1
(1)   65/ 41.031 :                      
(1)   66/ 41.031 :                              DS      1               ; UNUSED
(1)   67/ 41.032 :                      
(1)   68/ 41.032 :                      ;       STACK VALUE SAVED FOR OVERLAY SYSCALLS
(1)   69/ 41.032 :                      
(1)   70/ 41.032 :                      S.OVSTK DS      2               ; VALUE OF SP UPON SYSCALLS USING OVERLAY
(1)   71/ 41.034 :                      
(1)   72/ 41.034 :                      ;       VOLUME DEPENDENT VALUES FOR SY1:
(1)   73/ 41.034 :                      
(1)   74/ 41.034 :                      S.S1DIS DS      2               ; DIRECTORY SECTOR
(1)   75/ 41.036 :                      S.S1GRT DS      2               ; GRT SECTOR
(1)   76/ 41.040 :                      
(1)   77/ 41.040 :                      ;;      ACTIVE I/O AREA.
(1)   78/ 41.040 :                      ;
(1)   79/ 41.040 :                      ;       THE AIO.XXX AREA CONTAINS INFORMATION ABOUT THE I/O OPERATION
(1)   80/ 41.040 :                      ;       CURRENTLY BEING PERFORMED. THE INFORMATION IS OBTAINED FROM
(1)   81/ 41.040 :                      ;       THE CHANNEL TABLE, AND WILL BE RESTORED THERE WHEN DONE.
(1)   82/ 41.040 :                      ;
(1)   83/ 41.040 :                      ;       NORMALLY, THE AIO.XXX INFORMATION WOULD BE OBTAINED DIRECTLY
(1)   84/ 41.040 :                      ;       FROM VARIOUS SYSTEM TABLES VIA POINTER REGISTERS. SINCE THE
(1)   85/ 41.040 :                      ;       8080 HAS NO GOOD INDEXED ADDRESSING, THE DATA IS MANUALLY
(1)   86/ 41.040 :                      ;       COPIES INTO THE AIO.XXX CELLS BEFORE PROCESSING, AND
(1)   87/ 41.040 :                      ;       BACKDATED AFTER PROCESSING.
 AS V1.42 Beta [Bld 269] - Source File h17.asm(esint.asm) - Page 10 - 2024-07-31 11:12:52 AM


(1)   88/ 41.040 :                      
(1)   89/ 41.040 :                      AIO.VEC DS      3               ; JUMP INSTRUCTION
(1)   90/ 41.043 : =41.041O             AIO.DDA EQU     $-2             ; DEVICE DRIVER INDEX
(1)   91/ 41.043 :                      AIO.FLG DS      1               ; FLAG BYTE
(1)   92/ 41.044 :                      AIO.GRT DS      2               ; ADDRESS OF GROUP RESERV TABLE
(1)   93/ 41.046 :                      AIO.SPG DS      1               ; SECTORS PER GROUP
(1)   94/ 41.047 :                      AIO.CGN DS      1               ; CURRENT GROUP NUMBER
(1)   95/ 41.050 :                      AIO.CSI DS      1               ; CURRENT SECTOR INDEX
(1)   96/ 41.051 :                      AIO.LGN DS      1               ; LAST GROUP NUMBER
(1)   97/ 41.052 :                      AIO.LSI DS      1               ; LAST SECTOR INDEX
(1)   98/ 41.053 :                      AIO.DTA DS      2               ; DEVICE TABLE ADDRESS
(1)   99/ 41.055 :                      AIO.DES DS      2               ; DIRECTORY SECTOR
(1)  100/ 41.057 :                      AIO.DEV DS      2               ; DEVICE CODE
(1)  101/ 41.061 :                      AIO.UNI DS      1               ; UNIT NUMBER (0-9)
(1)  102/ 41.062 :                      
(1)  103/ 41.062 :                      AIO.DIR DS      DIRELEN         ; DIRECTORY ENTRY
(1)  104/ 41.111 :                      
(1)  105/ 41.111 :                      AIO.CNT DS      1               ; SECTOR COUNT
(1)  106/ 41.112 :                      AIO.EOM DS      1               ; END OF MEDIA FLAG
(1)  107/ 41.113 :                      AIO.EOF DS      1               ; END OF FILE FLAG
(1)  108/ 41.114 :                      AIO.TFP DS      2               ; TEMP FILE POINTERS
(1)  109/ 41.116 :                      AIO.CHA DS      2               ; ADDRESS OF CHANNEL BLOCK (IOC.DDA)
(1)  110/ 41.120 :                      
      32/ 41.120 :                      
      33/ 30.000 :                              ORG     14000Q
      34/ 30.000 :                      
      35/ 30.000 : 303 014 037                  JMP     BOOT            ; BOOT CODE
      36/ 30.003 :                      
      37/ 30.003 :                      ;;      MEMORY DIAGNOSTIC.
      38/ 30.003 :                      ;
      39/ 30.003 :                      
      40/ 30.003 : 041 300 377                  LXI     H,-64
      41/ 30.006 : 071                          DAD     SP              ; (HL) = END
      42/ 30.007 : 353                          XCHG                    ; (DE) = END+1
      43/ 30.010 : 041 100 040                  LXI     H,20100Q        ; (HL) = START
      44/ 30.013 : 166                          HLT                     ; PAUSE FOR ADJUSTMENT
      45/ 30.014 :                      
      46/ 30.014 :                      ;       (HL) = START
      47/ 30.014 :                      ;       (DE) = END
      48/ 30.014 :                      
      49/ 30.014 :                      ;       ZERO TEST AREA
      50/ 30.014 :                      
      51/ 30.014 : 042 076 040                  SHLD    20100Q-2
      52/ 30.017 : 066 000              MEM1    MVI     M,0
      53/ 30.021 : 043                          INX     H
      54/ 30.022 : 315 216 030                  CALL    DCDEHL
      55/ 30.025 : 302 017 030                  JNZ     MEM1
      56/ 30.030 :                      
      57/ 30.030 :                      ;       START TESTING MEMORY. INCREMENT EACH BYTE IN TURN, AND COMPARE
      58/ 30.030 :                      ;       THAT RESULT TO THE EXPECTED VALUE
      59/ 30.030 :                      
      60/ 30.030 : 006 000                      MVI     B,0             ; (B) = EXPECTED VALUE
      61/ 30.032 : 052 076 040          MEM2    LHLD    20100Q-2
      62/ 30.035 : 004                          INR     B
      63/ 30.036 :                      
      64/ 30.036 : 064                  MEM3    INR     M
      65/ 30.037 : 176                          MOV     A,M             ; (A) = VALUE
      66/ 30.040 : 270                          CMP     B
      67/ 30.041 : 312 046 030                  JZ      MEM4            ; IS OK
      68/ 30.044 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 11 - 2024-07-31 11:12:52 AM


      69/ 30.044 :                      ;       HAVE ERROR. (HL) = ADDRESS OF BYTE IN ERROR
      70/ 30.044 :                      
      71/ 30.044 : 166                          HLT
      72/ 30.045 : 000                          NOP
      73/ 30.046 :                      
      74/ 30.046 : 043                  MEM4    INX     H
      75/ 30.047 : 315 216 030                  CALL    DCDEHL
      76/ 30.052 : 302 036 030                  JNZ     MEM3            ; NOT AT END OF PASS
      77/ 30.055 : 303 032 030                  JMP     MEM2            ; AT END OF PASS
      78/ 30.060 :                      
      79/ 30.060 :                              INCLUDE comp.asm
(1)    1/ 30.060 :                      ;;      DCOMP - COMPARE TO CHARACTER STRINGS
(1)    2/ 30.060 :                      ;
(1)    3/ 30.060 :                      ;       DCOMP COMPARES TWO BYTE STRINGS.
(1)    4/ 30.060 :                      ;
(1)    5/ 30.060 :                      ;       ENTRY   (C) = COMPARE COUNT
(1)    6/ 30.060 :                      ;               (DE) = FWA OF STRING #1
(1)    7/ 30.060 :                      ;               (HL) = FWA OF STRING #2
(1)    8/ 30.060 :                      ;       EXIT    'Z' CLEAR, IF MIS-MATCH
(1)    9/ 30.060 :                      ;               (C) = LENGTH REMAINING
(1)   10/ 30.060 :                      ;               (DE) = ADDRESS OF MISMATCH IN STRING #1
(1)   11/ 30.060 :                      ;               (HL) = ADDRESS OF MISMATCH IN STRING #2
(1)   12/ 30.060 :                      ;               'C' SET, HAVE MATCH
(1)   13/ 30.060 :                      ;               (C) = 0
(1)   14/ 30.060 :                      ;               (DE) = (DE) + (OC)
(1)   15/ 30.060 :                      ;               (HL) = (HL) + (OC)
(1)   16/ 30.060 :                      ;       USES    A,F,C,D,E,H,L
(1)   17/ 30.060 :                      
(1)   18/ 30.060 : 032                  DCOMP   LDAX    D
(1)   19/ 30.061 : 276                          CMP     M               ; COMPARE
(1)   20/ 30.062 : 300                          RNZ                     ; NO MATCH
(1)   21/ 30.063 : 023                          INX     D
(1)   22/ 30.064 : 043                          INX     H
(1)   23/ 30.065 : 015                          DCR     C
(1)   24/ 30.066 : 302 060 030                  JNZ     DCOMP           ; TRY SOME MORE
(1)   25/ 30.071 : 311                          RET
(1)   26/ 30.072 :                      
      80/ 30.072 :                              INCLUDE dada.asm
(1)    1/ 30.072 :                      ;;      DDADA - PERFORM (H,L) = (H,L) + (0,A)
(1)    2/ 30.072 :                      ;
(1)    3/ 30.072 :                      ;       ENTRY   (H,L) = BEFORE VALUE
(1)    4/ 30.072 :                      ;               (A) = BEFORE VALUE
(1)    5/ 30.072 :                      ;       EXIT    (H,L) = (H,L) + (0,A)
(1)    6/ 30.072 :                      ;               'C' SET IF OVERFLOW
(1)    7/ 30.072 :                      ;       USES    F,H,L
(1)    8/ 30.072 :                      
(1)    9/ 30.072 : 325                  DDADA   PUSH    D
(1)   10/ 30.073 : 137                          MOV     E,A
(1)   11/ 30.074 : 026 000                      MVI     D,0
(1)   12/ 30.076 : 031                          DAD     D
(1)   13/ 30.077 : 321                          POP     D
(1)   14/ 30.100 : 311                          RET                     ; EXIT
(1)   15/ 30.101 :                      
      81/ 30.101 :                              INCLUDE dada2.asm
(1)    1/ 30.101 :                      ;;      DDATA. - ADD (0,A) TO (H,L)
(1)    2/ 30.101 :                      ;
(1)    3/ 30.101 :                      ;       ENTRY   NONE
(1)    4/ 30.101 :                      ;       EXIT    (H,L) = (H,L) + (0A)
(1)    5/ 30.101 :                      ;       USES    A,F,H,L
(1)    6/ 30.101 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm(dada2.asm) - Page 12 - 2024-07-31 11:12:52 AM


(1)    7/ 30.101 : 205                  DDADA.  ADD     L
(1)    8/ 30.102 : 157                          MOV     L,A
(1)    9/ 30.103 : 320                          RNC
(1)   10/ 30.104 : 044                          INR     H
(1)   11/ 30.105 : 311                          RET
(1)   12/ 30.106 :                      
      82/ 30.106 :                              INCLUDE du66.asm
(1)    1/ 30.106 :                      ;;      DDU66 - UNSIGNED 16 / 16 DIVIDE.
(1)    2/ 30.106 :                      ;
(1)    3/ 30.106 :                      ;       (HL) = (BC)/(DE)
(1)    4/ 30.106 :                      ;
(1)    5/ 30.106 :                      ;       ENTRY   (BC), (DE) PRESET
(1)    6/ 30.106 :                      ;       EXIT    (HL) = RESULT
(1)    7/ 30.106 :                      ;               (DE) = REMAINDER
(1)    8/ 30.106 :                      ;       USES    ALL
(1)    9/ 30.106 :                      
(1)   10/ 30.106 :                      
(1)   11/ 30.106 : 172                  DDU66   MOV     A,D             ; TWOS COMPLEMENT (DE)
(1)   12/ 30.107 : 057                          CMA
(1)   13/ 30.110 : 127                          MOV     D,A
(1)   14/ 30.111 : 173                          MOV     A,E
(1)   15/ 30.112 : 057                          CMA
(1)   16/ 30.113 : 137                          MOV     E,A
(1)   17/ 30.114 : 023                          INX     D
(1)   18/ 30.115 : 172                          MOV     A,D
(1)   19/ 30.116 : 263                          ORA     E
(1)   20/ 30.117 : 312 205 030                  JZ      DU665           ; IF DIVIDE BY 0
(1)   21/ 30.122 : 257                          XRA     A
(1)   22/ 30.123 :                      
(1)   23/ 30.123 :                      ;       SHIFT (DE) LEFT UNTIL:
(1)   24/ 30.123 :                      ;
(1)   25/ 30.123 :                      ;       1) DE < BL
(1)   26/ 30.123 :                      ;       2) OVERFLOW
(1)   27/ 30.123 :                      
(1)   28/ 30.123 : 142                  DU661   MOV     H,D
(1)   29/ 30.124 : 153                          MOV     L,E
(1)   30/ 30.125 : 011                          DAD     B
(1)   31/ 30.126 : 322 143 030                  JNC     DU662           ; IS TOO LARGE
(1)   32/ 30.131 : 074                          INR     A               ; COUNT SHIFT
(1)   33/ 30.132 : 142                          MOV     H,D
(1)   34/ 30.133 : 153                          MOV     L,E
(1)   35/ 30.134 : 051                          DAD     H
(1)   36/ 30.135 : 353                          XCHG                    ; (DE) = (DE)*2
(1)   37/ 30.136 : 332 123 030                  JC      DU661           ; IF NOT OVERFLOW
(1)   38/ 30.141 :                      
(1)   39/ 30.141 :                      ;       (DE) OVERFLOWED, PUT IT BACK.
(1)   40/ 30.141 :                      
(1)   41/ 30.141 : 353                          XCHG
(1)   42/ 30.142 : 075                          DCR     A               ; REMOVE EXTRA COUNT
(1)   43/ 30.143 :                      
(1)   44/ 30.143 :                      ;       READY TO START SUBTRACTING. (A) = LOOP COUNT
(1)   45/ 30.143 :                      
(1)   46/ 30.143 : 140                  DU662   MOV   H,B               ; (H,L) = WORKING VALU
(1)   47/ 30.144 : 151                          MOV   L,C
(1)   48/ 30.145 : 001 000 000                  LXI   B,0               ; (BC) = RESULT
(1)   49/ 30.150 : 365                  DU663   PUSH  PSW               ; SAVE (A)
(1)   50/ 30.151 : 031                          DAD   D
(1)   51/ 30.152 : 332 163 030                  JC    DU664             ; IF SUBTRACT OK
(1)   52/ 30.155 : 175                          MOV   A,L               ; ADD BACK IN
(1)   53/ 30.156 : 223                          SUB   E
 AS V1.42 Beta [Bld 269] - Source File h17.asm(du66.asm) - Page 13 - 2024-07-31 11:12:52 AM


(1)   54/ 30.157 : 157                          MOV   L,A
(1)   55/ 30.160 : 174                          MOV   A,H
(1)   56/ 30.161 : 232                          SBB   D
(1)   57/ 30.162 : 147                          MOV   H,A
(1)   58/ 30.163 : 171                  DU664   MOV   A,C
(1)   59/ 30.164 : 027                          RAL
(1)   60/ 30.165 : 117                          MOV   C,A
(1)   61/ 30.166 : 170                          MOV   A,B
(1)   62/ 30.167 : 027                          RAL
(1)   63/ 30.170 : 107                          MOV   B,A
(1)   64/ 30.171 :                      
(1)   65/ 30.171 :                      ;       RIGHT SHIFT (DE)
(1)   66/ 30.171 :                      
(1)   67/ 30.171 : 067                          STC
(1)   68/ 30.172 : 172                          MOV   A,D
(1)   69/ 30.173 : 037                          RAR
(1)   70/ 30.174 : 127                          MOV   D,A
(1)   71/ 30.175 : 173                          MOV   A,E
(1)   72/ 30.176 : 037                          RAR
(1)   73/ 30.177 : 137                          MOV   E,A
(1)   74/ 30.200 : 361                          POP   PSW
(1)   75/ 30.201 : 075                          DCR   A
(1)   76/ 30.202 : 362 150 030                  JP    DU663             ; IF NOT DONE
(1)   77/ 30.205 : 353                  DU665   XCHG                    ; (D,E) = REMAINDER
(1)   78/ 30.206 : 140                          MOV   H,B               ; (HL) = RESULT
(1)   79/ 30.207 : 151                          MOV   L,C
(1)   80/ 30.210 : 311                          RET
(1)   81/ 30.211 :                      
      83/ 30.211 :                              INCLUDE hlihl.asm
(1)    1/ 30.211 :                      ;;      DHLIHL - LOAD HL INDIRECT THROUGH HL.
(1)    2/ 30.211 :                      ;
(1)    3/ 30.211 :                      ;       (HL) = ((HL))
(1)    4/ 30.211 :                      ;
(1)    5/ 30.211 :                      ;       ENTRY   NONE
(1)    6/ 30.211 :                      ;       EXIT    NONE
(1)    7/ 30.211 :                      ;       USES    A,H,L
(1)    8/ 30.211 :                      
(1)    9/ 30.211 : 176                  DHLIHL  MOV     A,M
(1)   10/ 30.212 : 043                          INX     H
(1)   11/ 30.213 : 146                          MOV     H,M
(1)   12/ 30.214 : 157                          MOV     L,A
(1)   13/ 30.215 : 311                          RET
(1)   14/ 30.216 :                      
      84/ 30.216 :                              INCLUDE cdehl.asm
(1)    1/ 30.216 :                      ;;      DCDEHL - COMPARE (DE) TO (HL)
(1)    2/ 30.216 :                      ;
(1)    3/ 30.216 :                      ;       DCDEHL COMPARES (DE) TO (HL) FOR EQUALITY.
(1)    4/ 30.216 :                      ;
(1)    5/ 30.216 :                      ;       ENTRY   NONE
(1)    6/ 30.216 :                      ;       EXIT    'Z' SET IF (DE) = (HL)
(1)    7/ 30.216 :                      ;       USES    A,F
(1)    8/ 30.216 :                      
(1)    9/ 30.216 : 173                  DCDEHL  MOV     A,E
(1)   10/ 30.217 : 255                          XRA     L
(1)   11/ 30.220 : 300                          RNZ                     ; IF DIFFERENT
(1)   12/ 30.221 : 172                          MOV     A,D
(1)   13/ 30.222 : 254                          XRA     H
(1)   14/ 30.223 : 311                          RET
(1)   15/ 30.224 :                      
      85/ 30.224 :                              INCLUDE chl.asm         ; COMPLEMENT (HL)
 AS V1.42 Beta [Bld 269] - Source File h17.asm(chl.asm) - Page 14 - 2024-07-31 11:12:52 AM


(1)    1/ 30.224 :                      ;;      DCHL - COMPLEMENT (HL).
(1)    2/ 30.224 :                      ;
(1)    3/ 30.224 :                      ;       (HL) = -(HL)            TWO'S COMPLEMENT
(1)    4/ 30.224 :                      ;
(1)    5/ 30.224 :                      ;       ENTRY   NONE
(1)    6/ 30.224 :                      ;       EXIT    NONE
(1)    7/ 30.224 :                      ;       USES    A,F,H,L
(1)    8/ 30.224 :                      
(1)    9/ 30.224 : 174                  DCHL    MOV     A,H
(1)   10/ 30.225 : 057                          CMA
(1)   11/ 30.226 : 147                          MOV     H,A
(1)   12/ 30.227 : 175                          MOV     A,L
(1)   13/ 30.230 : 057                          CMA
(1)   14/ 30.231 : 157                          MOV     L,A
(1)   15/ 30.232 : 043                          INX     H
(1)   16/ 30.233 : 311                          RET
(1)   17/ 30.234 :                      
      86/ 30.234 :                              INCLUDE indl.asm        ; INDEXED LOAD
(1)    1/ 30.234 :                      ;;      DINDL - INDEXED LOAD.
(1)    2/ 30.234 :                      ;
(1)    3/ 30.234 :                      ;       DINDL LOADS DE WITH THE TWO BYTES AT (HL)+DISPLACEMENT
(1)    4/ 30.234 :                      ;
(1)    5/ 30.234 :                      ;       THIS ACTS AS AN INDEXED FULL WORD LOAD.
(1)    6/ 30.234 :                      ;
(1)    7/ 30.234 :                      ;       (DE) = ( (HL) + DISPLACEMENT )
(1)    8/ 30.234 :                      ;
(1)    9/ 30.234 :                      ;       ENTRY   ((RET)) = DISPLACEMENT (FULL WORD)
(1)   10/ 30.234 :                      ;               (HL) = TABLE ADDRESS
(1)   11/ 30.234 :                      ;       EXIT    TO (RET+2)
(1)   12/ 30.234 :                      ;       USES    A,F,D,E
(1)   13/ 30.234 :                      
(1)   14/ 30.234 : 343                  DINDL   XTHL                    ; (HL) = RET, ((SP) = TBL ADDRESS
(1)   15/ 30.235 : 136                          MOV     E,M
(1)   16/ 30.236 : 043                          INX     H
(1)   17/ 30.237 : 126                          MOV     D,M             ; (DE) = DISPLACEMENT
(1)   18/ 30.240 :                      
(1)   19/ 30.240 : 043                          INX     H
(1)   20/ 30.241 : 343                          XTHL                    ; ((SP)) = RET, (HL) = TBL ADDRESS
(1)   21/ 30.242 : 353                          XCHG                    ; (DE) = TBL ADDRESS, (HL) = DISPLACEMENT
(1)   22/ 30.243 : 031                          DAD     D               ; (HL) = TARGET ADDRESS
(1)   23/ 30.244 : 176                          MOV     A,M
(1)   24/ 30.245 : 043                          INX     H
(1)   25/ 30.246 : 146                          MOV     H,M
(1)   26/ 30.247 : 157                          MOV     L,A             ; (HL) = ((HL))
(1)   27/ 30.250 : 353                          XCHG                    ; (DE) = VALUE, (HL) = TABLE ADDRESS
(1)   28/ 30.251 : 311                          RET
(1)   29/ 30.252 :                      
      87/ 30.252 :                      
      88/ 30.252 :                      ;;      DMOVE - MOVE DATA
      89/ 30.252 :                      ;
      90/ 30.252 :                      ;       DMOVE MOVES A BLOCK OF BYTES TO A NEW MEMORY ADDRESS.
      91/ 30.252 :                      ;       IF THE MOVE IS TO A LOWER ADDRESS, THE BYTES ARE MOVED FROM
      92/ 30.252 :                      ;       FIRST TO LAST.
      93/ 30.252 :                      ;
      94/ 30.252 :                      ;       IF THE MOVE IS TO A HIGHER ADDRESS, THE BYTES ARE MOVED FROM
      95/ 30.252 :                      ;       LAST TO FIRST.
      96/ 30.252 :                      ;
      97/ 30.252 :                      ;       THIS IS DONE SO THAT AN OVERLAPPED MOVE WILL NOT 'RIPPLE'.
      98/ 30.252 :                      ;
      99/ 30.252 :                      ;       ENTRY   (BC) = COUNT
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 15 - 2024-07-31 11:12:52 AM


     100/ 30.252 :                      ;               (DE) = FROM
     101/ 30.252 :                      ;               (HL) = TO
     102/ 30.252 :                      ;       EXIT    MOVED
     103/ 30.252 :                      ;               (DE) = ADDRESS OF NEXT FROM BYTE
     104/ 30.252 :                      ;               (HL) = ADDRESS OF NEXT *TO* BYTE
     105/ 30.252 :                      ;               'C' CLEAR
     106/ 30.252 :                      ;       USES    ALL
     107/ 30.252 :                      
     108/ 30.252 : =30.252O             DMOVE   EQU     $
     109/ 30.252 : 170                          MOV     A,B
     110/ 30.253 : 261                          ORA     C
     111/ 30.254 : 310                          RZ                      ; NONE TO MOVE
     112/ 30.255 : 175                          MOV     A,L             ; COMPARE *FROM* TO *TO*
     113/ 30.256 : 223                          SUB     E
     114/ 30.257 : 174                          MOV     A,H
     115/ 30.260 : 232                          SBB     D
     116/ 30.261 : 332 311 030                  JC      MOV2            ; IS MOVE DOWN (TO LOWER ADDRESSES)
     117/ 30.264 :                      
     118/ 30.264 :                      ;       IF MOVE UP (TI HIGHER ADDRESSES)
     119/ 30.264 :                      
     120/ 30.264 : 013                          DCX     B
     121/ 30.265 : 011                          DAD     B               ; (HL) = *TO* LUA
     122/ 30.266 : 345                          PUSH    H               ; SAVE *TO* LIMIT
     123/ 30.267 : 353                          XCHG
     124/ 30.270 : 011                          DAD     B               ; (HL) = *FROM* LWA
     125/ 30.271 : 345                          PUSH    H               ; SAVE *FROM* LIMIT
     126/ 30.272 :                      
     127/ 30.272 : 176                  MOV1    MOV     A,M             ; MOVE BYTE
     128/ 30.273 : 022                          STAX    D
     129/ 30.274 : 033                          DCX     D               ; DECREMENT *TO* ADDRESS
     130/ 30.275 : 053                          DCX     H               ; DECREMENT *FROM* ADDRESS
     131/ 30.276 : 013                          DCX     B               ; DECREMENT COUNT
     132/ 30.277 : 170                          MOV     A,B
     133/ 30.300 : 247                          ANA     A
     134/ 30.301 : 362 272 030                  JP      MOV1            ; MORE TO GO
     135/ 30.304 : 321                          POP     D               ; (DE) = *FROM* LIMIT
     136/ 30.305 : 341                          POP     H               ; (HL) = *TO* LIMIT
     137/ 30.306 : 023                          INX     D
     138/ 30.307 : 043                          INX     H
     139/ 30.310 : 311                          RET                     ; DONE
     140/ 30.311 :                      
     141/ 30.311 :                      ;       IS MOVE DOWN (TO LOWER ADDRESSES)
     142/ 30.311 :                      
     143/ 30.311 : 032                  MOV2    LDAX    D               ; MOVE BYTE
     144/ 30.312 : 167                          MOV     M,A
     145/ 30.313 : 043                          INX     H               ; INCREMENT *FROM*
     146/ 30.314 : 023                          INX     D               ; INCREMENT *TO*
     147/ 30.315 : 013                          DCX     B               ; DECREMENT COUNT
     148/ 30.316 : 170                          MOV     A,B
     149/ 30.317 : 261                          ORA     C
     150/ 30.320 : 302 311 030                  JNZ     MOV2            ; IF NOT DONE
     151/ 30.323 : 311                          RET                     ; DONE
     152/ 30.324 :                      
     153/ 30.324 :                              INCLUDE mu10.asm
(1)    1/ 30.324 :                      ;;      DMU10 - MULTIPLY UNSIGNED 16 BIT QUANTITY BY 10.
(1)    2/ 30.324 :                      ;
(1)    3/ 30.324 :                      ;       (HL) = (DE)*10
(1)    4/ 30.324 :                      ;
(1)    5/ 30.324 :                      ;       ENTRY   (DE) = MULTIPLIER
(1)    6/ 30.324 :                      ;       EXIT    'C' CLEAR IF OK
 AS V1.42 Beta [Bld 269] - Source File h17.asm(mu10.asm) - Page 16 - 2024-07-31 11:12:52 AM


(1)    7/ 30.324 :                      ;               (HL) = PRODUCT
(1)    8/ 30.324 :                      ;               'C' SET IF ERROR
(1)    9/ 30.324 :                      ;       USES    D,E,H,L,F
(1)   10/ 30.324 :                      
(1)   11/ 30.324 :                      
(1)   12/ 30.324 : 353                  DMU10   XCHG                    ; (HL) = MULTIPLIER
(1)   13/ 30.325 : 051                          DAD     H               ; (HL) = X*2
(1)   14/ 30.326 : 330                          RC
(1)   15/ 30.327 : 124                          MOV     D,H
(1)   16/ 30.330 : 135                          MOV     E,L
(1)   17/ 30.331 : 051                          DAD     H               ; (HL) = X*4
(1)   18/ 30.332 : 330                          RC
(1)   19/ 30.333 : 051                          DAD     H               ; (HL) = X*8
(1)   20/ 30.334 : 330                          RC
(1)   21/ 30.335 : 031                          DAD     D               ; (HL) = X*10
(1)   22/ 30.336 : 311                          RET
(1)   23/ 30.337 :                      
(1)   24/ 30.337 :                      
(1)   25/ 30.337 :                      
(1)   26/ 30.337 :                      
     154/ 30.337 :                              INCLUDE mu66.asm
(1)    1/ 30.337 :                      ;;      DMU66 - UNSIGNED 16X16 MULTIPLY.
(1)    2/ 30.337 :                      ;
(1)    3/ 30.337 :                      ;       ENTRY   (BC) = MULTIPLICAND
(1)    4/ 30.337 :                      ;               (DE) = MULTIPLIER
(1)    5/ 30.337 :                      ;       EXIT    (HL) = RESULT
(1)    6/ 30.337 :                      ;               'Z' SET IF NOT OVERFLOW
(1)    7/ 30.337 :                      ;       USES    ALL
(1)    8/ 30.337 :                      
(1)    9/ 30.337 :                      
(1)   10/ 30.337 : 257                  DMU66   XRA     A
(1)   11/ 30.340 : 365                          PUSH    PSW             ; SAVE OVERFLOW STATUS
(1)   12/ 30.341 : 041 000 000                  LXI     H,0             ; (HL) = RESULT ACCUMULATOR
(1)   13/ 30.344 :                      
(1)   14/ 30.344 : 170                  MU661   MOV     A,B
(1)   15/ 30.345 : 037                          RAR
(1)   16/ 30.346 : 107                          MOV     B,A
(1)   17/ 30.347 : 171                          MOV     A,C
(1)   18/ 30.350 : 037                          RAR
(1)   19/ 30.351 : 117                          MOV     C,A
(1)   20/ 30.352 : 322 364 030                  JNC     MU662           ; IF BIT CLEAR
(1)   21/ 30.355 : 031                          DAD     D
(1)   22/ 30.356 : 322 364 030                  JNC     MU662           ; IF NOT OVERFLOW
(1)   23/ 30.361 : 361                          POP     PSW
(1)   24/ 30.362 : 074                          INR     A
(1)   25/ 30.363 : 365                          PUSH    PSW
(1)   26/ 30.364 : 170                  MU662   MOV     A,B
(1)   27/ 30.365 : 261                          ORA     C               ; SEE IF MULTIPLIER 0
(1)   28/ 30.366 : 312 005 031                  JZ      MU663           ; IF ZERO; AM DONE
(1)   29/ 30.371 : 353                          XCHG
(1)   30/ 30.372 : 051                          DAD     H               ; (D,E) = (DE)*2
(1)   31/ 30.373 : 353                          XCHG
(1)   32/ 30.374 : 322 344 030                  JNC     MU661           ; IF NOT OVERFLOW
(1)   33/ 30.377 : 361                          POP     PSW
(1)   34/ 31.000 : 074                          INR     A
(1)   35/ 31.001 : 365                          PUSH    PSW             ; FLAG OVERFLOW
(1)   36/ 31.002 : 303 344 030                  JMP     MU661           ; PROCESS NEXT BIT
(1)   37/ 31.005 :                      
(1)   38/ 31.005 : 361                  MU663   POP     PSW             ; (A,F) = OVERFLOW STATUS
(1)   39/ 31.006 : 311                          RET
 AS V1.42 Beta [Bld 269] - Source File h17.asm(mu66.asm) - Page 17 - 2024-07-31 11:12:52 AM


(1)   40/ 31.007 :                      
     155/ 31.007 :                              INCLUDE mu86.asm
(1)    1/ 31.007 :                      ;;      DMJ86 - MULTIPLY 8X16 UNSIGNED.
(1)    2/ 31.007 :                      ;
(1)    3/ 31.007 :                      ;       DMU86 MULTIPLIES A 16 BIT VALUE BY A 8
(1)    4/ 31.007 :                      ;       BUT VALUE.
(1)    5/ 31.007 :                      ;
(1)    6/ 31.007 :                      ;       ENTRY   (A) = MULTIPLIER
(1)    7/ 31.007 :                      ;               (DE) = MULTIPLICAND
(1)    8/ 31.007 :                      ;       EXIT    (HL) = RESULT
(1)    9/ 31.007 :                      ;               'Z' SET IF NOT OVERFLOW
(1)   10/ 31.007 :                      ;       USES    A,F,H,L
(1)   11/ 31.007 :                      
(1)   12/ 31.007 :                      
(1)   13/ 31.007 : 041 000 000          DMU86   LXI     H,0             ; (HL) = RESULT ACCUMULATOR
(1)   14/ 31.012 : 305                          PUSH    B
(1)   15/ 31.013 : 104                          MOV     B,H             ; (B) = OVERFLOW FLAG
(1)   16/ 31.014 : 267                  MU860   ORA     A               ; CLEAR CARRY
(1)   17/ 31.015 :                      
(1)   18/ 31.015 : 037                  MU861   RAR
(1)   19/ 31.016 : 322 026 031                  JNC     MU862           ; IF NOT TO ADD
(1)   20/ 31.021 : 031                          DAD     D
(1)   21/ 31.022 : 322 026 031                  JNC     MU862           ; NOT OVERFLOW
(1)   22/ 31.025 : 004                          INR     B
(1)   23/ 31.026 : 267                  MU862   ORA     A
(1)   24/ 31.027 : 312 044 031                  JZ      MU863           ; IF DONE
(1)   25/ 31.032 : 353                          XCHG
(1)   26/ 31.033 : 051                          DAD     H
(1)   27/ 31.034 : 353                          XCHG
(1)   28/ 31.035 : 322 015 031                  JNC     MU861           ; LOOP IF NOT OVERFLOW
(1)   29/ 31.040 : 004                          INR     B
(1)   30/ 31.041 : 303 014 031                  JMP     MU860
(1)   31/ 31.044 :                      
(1)   32/ 31.044 : 260                  MU863   ORA     B               ; SET *Z* FLAG IF NOT OVERFLOW
(1)   33/ 31.045 : 301                          POP     B               ; RESTORE (BC)
(1)   34/ 31.046 : 311                          RET
(1)   35/ 31.047 :                      
     156/ 31.047 :                              INCLUDE savall.asm
(1)    1/ 31.047 :                      ;;      DRSTALL - RESTORE ALL REGISTERS.
(1)    2/ 31.047 :                      
(1)    3/ 31.047 :                      ;
(1)    4/ 31.047 :                      ;       DRSTALL RESTORES ALL THE REGISTERS OFF THE STACK, AND
(1)    5/ 31.047 :                      ;       RETURNS TO THE PREVIOUS CALLER.
(1)    6/ 31.047 :                      ;
(1)    7/ 31.047 :                      ;       ENTRY   (SP) = PWS
(1)    8/ 31.047 :                      ;               (SP+2) = BC
(1)    9/ 31.047 :                      ;               (SP+4) = DE
(1)   10/ 31.047 :                      ;               (SP+6) = HL
(1)   11/ 31.047 :                      ;               (SP+8) = RET
(1)   12/ 31.047 :                      ;       EXIT    TO *RET*, REGISTERS RESTORED
(1)   13/ 31.047 :                      ;       USES    ALL
(1)   14/ 31.047 :                      
(1)   15/ 31.047 :                      
(1)   16/ 31.047 : 361                  DRSTALL POP     PSW
(1)   17/ 31.050 : 301                          POP     B
(1)   18/ 31.051 : 321                          POP     D
(1)   19/ 31.052 : 341                          POP     H
(1)   20/ 31.053 : 311                          RET
(1)   21/ 31.054 :                      
(1)   22/ 31.054 :                      ;;      DSAVALL - SAVE ALL REGISTERS ON STACK.
 AS V1.42 Beta [Bld 269] - Source File h17.asm(savall.asm) - Page 18 - 2024-07-31 11:12:52 AM


(1)   23/ 31.054 :                      ;
(1)   24/ 31.054 :                      ;       DSAVALL SAVES ALL THE REGISTERS ON THE STACK.
(1)   25/ 31.054 :                      ;
(1)   26/ 31.054 :                      ;       ENTRY   NONE
(1)   27/ 31.054 :                      ;       EXIT    (SP) = PSW
(1)   28/ 31.054 :                      ;               (SP+2) = BC
(1)   29/ 31.054 :                      ;               (SP+4) = DE
(1)   30/ 31.054 :                      ;               (SP+6) = HL
(1)   31/ 31.054 :                      ;       USES    H,L
(1)   32/ 31.054 :                      
(1)   33/ 31.054 :                      
(1)   34/ 31.054 : 343                  DSAVALL XTHL                    ; PUSH H, (HL) = RETURN ADDRESS
(1)   35/ 31.055 : 325                          PUSH    D
(1)   36/ 31.056 : 305                          PUSH    B
(1)   37/ 31.057 : 365                          PUSH    PSW
(1)   38/ 31.060 : 351                          PCHL                    ; RETURN TO CALLER
(1)   39/ 31.061 :                      
     157/ 31.061 :                              INCLUDE tjmp.asm
(1)    1/ 31.061 :                      ;;      DTJMP - TABLE JUMP.
(1)    2/ 31.061 :                      ;
(1)    3/ 31.061 :                      ;       USAGE
(1)    4/ 31.061 :                      ;
(1)    5/ 31.061 :                      ;       CALL    DTMP            (A) = INDEX
(1)    6/ 31.061 :                      ;       DW      ADDR1           INDEX = 0
(1)    7/ 31.061 :                      ;       .       .
(1)    8/ 31.061 :                      ;       .       .
(1)    9/ 31.061 :                      ;       .       .
(1)   10/ 31.061 :                      ;       DW      ADDRN           INDEX = N01
(1)   11/ 31.061 :                      ;
(1)   12/ 31.061 :                      ;       ENTRY   (A) = INDEX
(1)   13/ 31.061 :                      ;       EXIT    TO PROCESSOR
(1)   14/ 31.061 :                      ;               (A) = INDEX*2
(1)   15/ 31.061 :                      ;       USES    A,F
(1)   16/ 31.061 :                      
(1)   17/ 31.061 :                      
(1)   18/ 31.061 : 007                  DTJMP   RLC                     ; (A) = INDEX*2
(1)   19/ 31.062 :                      
(1)   20/ 31.062 : =31.062O             DTJMP.  EQU     $
(1)   21/ 31.062 : 343                          XTHL                    ; (HL) = TABLE ADDRESS
(1)   22/ 31.063 : 365                          PUSH    PSW             ; SAVE INDEX*2
(1)   23/ 31.064 : 315 101 030                  CALL    DDADA.
(1)   24/ 31.067 : 176                          MOV     A,M
(1)   25/ 31.070 : 043                          INX     H
(1)   26/ 31.071 : 146                          MOV     H,M
(1)   27/ 31.072 : 157                          MOV     L,A
(1)   28/ 31.073 : 361                          POP     PSW             ; (A) = INDEX*2
(1)   29/ 31.074 : 343                          XTHL                    ; ADDRESS IS ON STACK
(1)   30/ 31.075 : 311                          RET                     ; JUMP TO PROCESSOR
(1)   31/ 31.076 :                      
     158/ 31.076 :                              INCLUDE tbra.asm
(1)    1/ 31.076 :                      ;;      DTBRA - BRANCH RELATIVE THROUGH TABLE.
(1)    2/ 31.076 :                      ;
(1)    3/ 31.076 :                      ;       DTBRA USES THE SUPPLIED INDEX TO SELECT A BYTE FROM THE
(1)    4/ 31.076 :                      ;       JUMP TABLE. THE CONTENTS OF THIS BYTE ARE ADDED TO THE
(1)    5/ 31.076 :                      ;       ADDRESS OF THE BYTE, YIELDING THE PROCESSOR ADDRESS.
(1)    6/ 31.076 :                      ;
(1)    7/ 31.076 :                      ;       CALL    DTBRA
(1)    8/ 31.076 :                      ;       DB      LAB1-*          ; INDEX = 0 FOR LAB1
(1)    9/ 31.076 :                      ;       DB      LAB2-*          ; INDEX = 0 FOR LAB2
(1)   10/ 31.076 :                      ;       DB      LABN-*          ; INDEX = 0 FOR LABN
 AS V1.42 Beta [Bld 269] - Source File h17.asm(tbra.asm) - Page 19 - 2024-07-31 11:12:52 AM


(1)   11/ 31.076 :                      ;
(1)   12/ 31.076 :                      ;       ENTRY   (A) = INDEX
(1)   13/ 31.076 :                      ;               (RET) = TABLE FWA
(1)   14/ 31.076 :                      ;       EXIT    TO COMPUTED ADDRESS
(1)   15/ 31.076 :                      ;       USES    F,H,L
(1)   16/ 31.076 :                      
(1)   17/ 31.076 :                      
(1)   18/ 31.076 : =31.076O             DTBRA   EQU     $
(1)   19/ 31.076 : 343                          XTHL                    ; (HL) = TABLE ADDRESS
(1)   20/ 31.077 : 325                          PUSH    D
(1)   21/ 31.100 : 137                          MOV     E,A
(1)   22/ 31.101 : 026 000                      MVI     D,0
(1)   23/ 31.103 : 031                          DAD     D               ; (HL) = ADDRESS OF ELEMENT
(1)   24/ 31.104 : 136                          MOV     E,M
(1)   25/ 31.105 : 031                          DAD     D               ; (HL) = PROCESSOR ADDRESS
(1)   26/ 31.106 : 321                          POP     D
(1)   27/ 31.107 : 343                          XTHL
(1)   28/ 31.110 : 311                          RET
(1)   29/ 31.111 :                      
(1)   30/ 31.111 :                      ;;      DTBLS - TABLE SEARCH
(1)   31/ 31.111 :                      ;
(1)   32/ 31.111 :                      ;       TABLE FORMAT
(1)   33/ 31.111 :                      ;
(1)   34/ 31.111 :                      ;       DB      KEY1,VAL1,
(1)   35/ 31.111 :                      ;       .       .
(1)   36/ 31.111 :                      ;       .       .
(1)   37/ 31.111 :                      ;       DB      KEYN,VALN
(1)   38/ 31.111 :                      ;       DB      0
(1)   39/ 31.111 :                      ;
(1)   40/ 31.111 :                      ;       ENTRY   (A) = PATTERN
(1)   41/ 31.111 :                      ;               (HL) = TABLE FWA
(1)   42/ 31.111 :                      ;       EXIT    (A) = PATTERN IF FOUND
(1)   43/ 31.111 :                      ;               'Z' SET IF FOUND
(1)   44/ 31.111 :                      ;       USES    A,F,H,L
(1)   45/ 31.111 :                      
(1)   46/ 31.111 :                      
(1)   47/ 31.111 : 305                  DTBLS   PUSH    B
(1)   48/ 31.112 : 107                          MOV     B,A
(1)   49/ 31.113 : 176                  DTBL1   MOV     A,M             ; (A) = CHARACTER
(1)   50/ 31.114 : 270                          CMP     B
(1)   51/ 31.115 : 312 133 031                  JZ      DTBL2           ; IF MATCH
(1)   52/ 31.120 : 247                          ANA     A
(1)   53/ 31.121 : 043                          INX     H
(1)   54/ 31.122 : 043                          INX     H               ; SKIP PAST
(1)   55/ 31.123 : 302 113 031                  JNZ     DTBL1           ; IF NOT END OF TABLE
(1)   56/ 31.126 : 053                          DCX     H
(1)   57/ 31.127 : 053                          DCX     H
(1)   58/ 31.130 : 264                          ORA     H               ; CLEAR 'Z'
(1)   59/ 31.131 : 076 000                      MVI     A,0             ; SET (A) = 0 FOR OLD USERS
(1)   60/ 31.133 :                      
(1)   61/ 31.133 :                      ;       DONE
(1)   62/ 31.133 :                      
(1)   63/ 31.133 : 301                  DTBL2   POP     B
(1)   64/ 31.134 : 043                          INX     H
(1)   65/ 31.135 : 311                          RET
(1)   66/ 31.136 :                      
(1)   67/ 31.136 :                      ;;      DTYPTX - TYPE TEXT.
(1)   68/ 31.136 :                      ;
(1)   69/ 31.136 :                      ;       DTYPTX IS CALLED TO TYPE A BLOCK OF TEXT ON THE SYSTEM CONSOLE.
(1)   70/ 31.136 :                      ;
 AS V1.42 Beta [Bld 269] - Source File h17.asm(tbra.asm) - Page 20 - 2024-07-31 11:12:52 AM


(1)   71/ 31.136 :                      ;       EMBEDDED ZERO BYTES INDICATE A CARRIAGE RETURN LINE FEED,
(1)   72/ 31.136 :                      ;       A BYTE WITH THE 200Q BIT SET IS THE LAST BYTE IN THE MESSAGE.
(1)   73/ 31.136 :                      ;
(1)   74/ 31.136 :                      ;       ENTRY   (RET) = TEXT
(1)   75/ 31.136 :                      ;       EXIT    TO (RET+LENGTH)
(1)   76/ 31.136 :                      ;       USES    A,F
(1)   77/ 31.136 :                      
(1)   78/ 31.136 :                      
(1)   79/ 31.136 : 343                  DTYPTX  XTHL                    ; (HL) = TEXT ADDRESS
(1)   80/ 31.137 : 315 144 031                  CALL    DTYPTX.         ; TYPE IT
(1)   81/ 31.142 : 343                          XTHL
(1)   82/ 31.143 : 311                          RET
(1)   83/ 31.144 :                      
(1)   84/ 31.144 : 176                  DTYPTX. MOV     A,M
(1)   85/ 31.145 : 346 177                      ANI     177Q
(1)   86/ 31.147 : 377 002                      DB      SYSCALL,SCOUT
(1)   87/ 31.151 : 276                          CMP     M
(1)   88/ 31.152 : 043                          INX     H
(1)   89/ 31.153 : 312 144 031                  JZ      DTYPTX.         ; MORE TO GO
(1)   90/ 31.156 : 311                          RET
(1)   91/ 31.157 :                      
(1)   92/ 31.157 :                      
     159/ 31.157 :                              INCLUDE udd.asm
(1)    1/ 31.157 :                      ;;      DUDD - UNPACK DECIMAL DIGITS.
(1)    2/ 31.157 :                      ;
(1)    3/ 31.157 :                      ;       UDD CONVERTS A 16 BIT VALUE INTO A SPECIFIED NUMBER OF
(1)    4/ 31.157 :                      ;       DECIMAL DIGITS. THE RESULT IS ZERO FILLED.
(1)    5/ 31.157 :                      ;
(1)    6/ 31.157 :                      ;       ENTRY   (B,C) = ADDRESS VALUE
(1)    7/ 31.157 :                      ;               (A) = DIGIT COUNT
(1)    8/ 31.157 :                      ;               (H,L) = MEMORY ADDRESS
(1)    9/ 31.157 :                      ;       EXIT    (HL) = (HL) + (A)
(1)   10/ 31.157 :                      ;       USES    ALL
(1)   11/ 31.157 :                      
(1)   12/ 31.157 :                      
(1)   13/ 31.157 : =31.157O             DUDD    EQU     $
(1)   14/ 31.157 : 315 072 030                  CALL    DDADA
(1)   15/ 31.162 : 345                          PUSH    H               ; SAVE FINAL (H,L) VALUE
(1)   16/ 31.163 :                      
(1)   17/ 31.163 : 365                  UDD1    PUSH    PSW
(1)   18/ 31.164 : 345                          PUSH    H
(1)   19/ 31.165 : 021 012 000                  LXI     D,10
(1)   20/ 31.170 : 315 106 030                  CALL    DDU66           ; (H,L) = VALUE/10
(1)   21/ 31.173 : 345                          PUSH    H
(1)   22/ 31.174 : 301                          POP     B               ; (B,C) = REMAINDER
(1)   23/ 31.175 : 341                          POP     H
(1)   24/ 31.176 : 076 060                      MVI     A,'0'
(1)   25/ 31.200 : 203                          ADD     E               ; ADD REMAINDER
(1)   26/ 31.201 : 053                          DCX     H
(1)   27/ 31.202 : 167                          MOV     M,A             ; STORE DIGIT
(1)   28/ 31.203 : 361                          POP     PSW
(1)   29/ 31.204 : 075                          DCR     A
(1)   30/ 31.205 : 302 163 031                  JNZ     UDD1            ; IF MORE TO GO
(1)   31/ 31.210 : 341                          POP     H               ; RESTORE H
(1)   32/ 31.211 : 311                          RET                     ;    RETURN
(1)   33/ 31.212 :                      
     160/ 31.212 :                              INCLUDE zero.asm
(1)    1/ 31.212 :                      ;;      DZERO - ZERO MEMORY
(1)    2/ 31.212 :                      ;
(1)    3/ 31.212 :                      ;       DZERO ZEROS A BLOCK OF MEMORY.
 AS V1.42 Beta [Bld 269] - Source File h17.asm(zero.asm) - Page 21 - 2024-07-31 11:12:52 AM


(1)    4/ 31.212 :                      ;
(1)    5/ 31.212 :                      ;       ENTRY   (HL) = ADDRESS
(1)    6/ 31.212 :                      ;               (B) = COUNT
(1)    7/ 31.212 :                      ;       EXIT    (A) = 0
(1)    8/ 31.212 :                      ;       USES    A,B,F,H,L
(1)    9/ 31.212 :                      
(1)   10/ 31.212 :                      
(1)   11/ 31.212 : 257                  DZERO   XRA     A
(1)   12/ 31.213 : 167                  ZRO1    MOV     M,A
(1)   13/ 31.214 : 043                          INX     H
(1)   14/ 31.215 : 005                          DCR     B
(1)   15/ 31.216 : 302 213 031                  JNZ     ZRO1            ; IF MORE
(1)   16/ 31.221 : 311                          RET
(1)   17/ 31.222 :                      
     161/ 31.222 :                      
     162/ 31.222 :                      ;       DWDR - WRITE DISABLE RAM.
     163/ 31.222 :                      ;
     164/ 31.222 :                      ;       DWDR IS CALLED TO DISABLE THE WRITABILITY OF THE
     165/ 31.222 :                      ;       H17 CONTROLLER RAM AREA.
     166/ 31.222 :                      ;
     167/ 31.222 :                      ;       ENTRY   NONE
     168/ 31.222 :                      ;       EXIT    NONE
     169/ 31.222 :                      ;       USES    NONE
     170/ 31.222 :                      
     171/ 31.222 :                      
     172/ 31.222 : 365                  DWRD    PUSH    PSW
     173/ 31.223 : 363                          DI
     174/ 31.224 : 072 242 040                  LDA     D.DVCTL
     175/ 31.227 : 346 177                      ANI     377Q-DF.WR
     176/ 31.231 : 062 242 040          DWDR1   STA     D.DVCTL
     177/ 31.234 : 323 177                      OUT     DP.DC
     178/ 31.236 : 373                          EI
     179/ 31.237 : 361                          POP     PSW
     180/ 31.240 : 311                          RET
     181/ 31.241 :                      
     182/ 31.241 :                      ;;      DWER - WRITE ENABLE RAM.
     183/ 31.241 :                      ;
     184/ 31.241 :                      ;       DWER IS CALLED TO ENABLE WRITING TO THE H17 CONTROLLER RAM AREA.
     185/ 31.241 :                      ;
     186/ 31.241 :                      ;       ENTRY   NONE
     187/ 31.241 :                      ;       EXIT    NONE
     188/ 31.241 :                      ;       USES    NONE
     189/ 31.241 :                      
     190/ 31.241 :                      
     191/ 31.241 : 365                  DWER    PUSH    PSW
     192/ 31.242 : 363                          DI
     193/ 31.243 : 072 242 040                  LDA     D.DVCTL
     194/ 31.246 : 366 200                      ORI     DF.WR
     195/ 31.250 : 303 231 031                  JMP     DWDR1
     196/ 31.253 :                      
     197/ 31.253 :                      ;;      D.DISK - DEVICE DRIVER READ CODE.
     198/ 31.253 :                      ;
     199/ 31.253 :                      ;       ENTRY   (BC) = COUNT (IN SECTORS)
     200/ 31.253 :                      ;               (DE) = ADDRESS
     201/ 31.253 :                      ;               (HL) = SECTOR
     202/ 31.253 :                      ;       EXIT    'C' CLEAR IF OK, EXIT TO CALLER
     203/ 31.253 :                      ;               'C' SET IF ERROR
     204/ 31.253 :                      ;                TO S.FASER (FATAL SYSTEM ERROR) IF UNIT 0
     205/ 31.253 :                      ;                TO CALLER IF OTHER UNIT
     206/ 31.253 :                      ;                 (A) = ERROR CODE
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 22 - 2024-07-31 11:12:52 AM


     207/ 31.253 :                      
     208/ 31.253 :                      
     209/ 31.253 : 076 001              DWRITE  MVI     A,DC.WRI
     210/ 31.255 : 376                          DB      MI.CPI          ; SKIP NEXT
     211/ 31.256 : 257                  DREAD   XRA     A               ; SET READ CODE
     212/ 31.257 :                      
     213/ 31.257 : 315 130 040                  CALL    SYDD            ; CALL DEVICE DRIVER
     214/ 31.262 : 320                          RNC                     ; IF OK
     215/ 31.263 : 365                          PUSH    PSW             ; SAVE CODE
     216/ 31.264 : 072 061 041                  LDA     AIO.UNI
     217/ 31.267 : 247                          ANA     A
     218/ 31.270 : 314 013 041                  CZ      S.FASER         ; IF SY0:
     219/ 31.273 : 361                          POP     PSW
     220/ 31.274 : 311                          RET                     ; RETURN WITH BAD NEWS
     221/ 31.275 :                      
     222/ 31.275 :                      ;;      SREAD - READ FROM SYSTEM DISK.
     223/ 31.275 :                      ;
     224/ 31.275 :                      ;
     225/ 31.275 :                      ;       ENTRY   (BC) = COUNT (IN SECTORS)
     226/ 31.275 :                      ;               (DE) = ADDRESS
     227/ 31.275 :                      ;               (HL) = SECTOR
     228/ 31.275 :                      ;       EXIT    TO CALLER IF OK
     229/ 31.275 :                      ;               TO S.FASER (FATAL SYSTEM ERROR) IF ERROR
     230/ 31.275 :                      
     231/ 31.275 :                      
     232/ 31.275 : 072 061 041          SREAD   LDA     AIO.UNI
     233/ 31.300 : 365                          PUSH    PSW             ; SAVE CURRENT LIMIT
     234/ 31.301 : 257                          XRA     A
     235/ 31.302 : 062 061 041                  STA     AIO.UNI
     236/ 31.305 : 315 130 040          SREAD1  CALL    SYDD
     237/ 31.310 : 334 013 041                  CC      S.FASER         ; READ ERROR
     238/ 31.313 : 361                          POP     PSW
     239/ 31.314 : 062 061 041                  STA     AIO.UNI
     240/ 31.317 : 311                          RET
     241/ 31.320 :                      
     242/ 31.320 :                      
     243/ 31.320 :                      ;;      CONSTANT ZEROS
     244/ 31.320 :                      
     245/ 31.320 : 000 000 000 000 000  ZEROS   DB      0,0,0,0,0,0,0,0
          31.325 : 000 000 000        
     246/ 31.330 :                      
     247/ 31.330 :                      ;;      SWRITE - WRITE TO SYSTEM DISK.
     248/ 31.330 :                      ;
     249/ 31.330 :                      ;       ENTRY   (BC) = COUNT (IN SECTORS)
     250/ 31.330 :                      ;               (DE) = ADDRESS
     251/ 31.330 :                      ;               (HL) = SECTOR
     252/ 31.330 :                      ;       EXIT    TO CALLER IF OK
     253/ 31.330 :                      ;               TO S.FASER (FATAL SYSTEM ERROR) IF ERROR
     254/ 31.330 :                      
     255/ 31.330 :                      
     256/ 31.330 : 072 061 041          SWRITE  LDA     AIO.UNI
     257/ 31.333 : 365                          PUSH    PSW             ; SAVE OLD UNIT #
     258/ 31.334 : 257                          XRA     A
     259/ 31.335 : 062 061 041                  STA     AIO.UNI         ; SET SYSTEM UNIT
     260/ 31.340 : 074                          INR     A               ; (A) = DC.WRI
     261/ 31.341 : 303 305 031                  JMP     SREAD1
     262/ 31.344 :                      
     263/ 31.344 :                      ;;      ERR.FNO - ERROR: FILE NOT OPEN
     264/ 31.344 :                      
     265/ 31.344 : 076 011              ERR.FNO MVI     A,EC.FNO        ; FILE NOT OPEN
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 23 - 2024-07-31 11:12:52 AM


     266/ 31.346 : 067                          STC
     267/ 31.347 : 311                          RET                     ; ERROR CODE
     268/ 31.350 :                      
     269/ 31.350 :                      ;;      ERR.ILR - ERROR: ILLEGAL REQUEST
     270/ 31.350 :                      
     271/ 31.350 : 076 012              ERR.ILR MVI     A,EC.ILR        ; ILLEGAL REQUEST
     272/ 31.352 : 067                          STC
     273/ 31.353 : 311                          RET
     274/ 31.354 :                      
     275/ 31.354 :                      ;;      CFF - CHAIN FREE BLOCK TO FILE.
     276/ 31.354 :                      ;
     277/ 31.354 :                      ;       CFF UNCHAINS A FREE BLOCK FROM THE FREE LIST, AND CHAINS
     278/ 31.354 :                      ;       IT ONTO THE END OF THE ACTIVE FILE.
     279/ 31.354 :                      
     280/ 31.354 :                      ;       ENTRY   (HL) = ADDRESS IN GROUP TABLE OF THE GROUP IN QUESTION.
     281/ 31.354 :                      ;               (E) = INDEX OF PREVIOUS GROUP IN LIST
     282/ 31.354 :                      ;               AIO.XXX SETUP
     283/ 31.354 :                      ;       EXIT    AIO.LGN = (L) (AT ENTRY)
     284/ 31.354 :                      ;               AIO.LSI = 0
     285/ 31.354 :                      ;       USES    A,F,D,H,L
     286/ 31.354 :                      
     287/ 31.354 :                      
     288/ 31.354 : 176                  CFF     MOV     A,M             ; (A) = NEXT FREE
     289/ 31.355 : 066 000                      MVI     M,0             ; NEW BLOCK IS END OF CHAIN FOR FILE
     290/ 31.357 : 125                          MOV     D,L             ; (D) = NEW INDEX
     291/ 31.360 : 153                          MOV     L,E             ; (HL) = ADDRESS OF PREVIOUS BLOCK
     292/ 31.361 : 167                          MOV     M,A             ; UNCHAIN FROM FREE CHAIN
     293/ 31.362 : 072 051 041                  LDA     AIO.LGN         ; (A) = LAST GROUP #
     294/ 31.365 : 157                          MOV     L,A             ; (HL) = ADDRESS OF FILE LAST GROUP
     295/ 31.366 : 162                          MOV     M,D             ; LINK TO NEW LAST BLOCK
     296/ 31.367 : 041 051 041                  LXI     H,AIO.LGN
     297/ 31.372 : 162                          MOV     M,D             ; SET NEW LGN
     298/ 31.373 : 043                          INX     H
     299/ 31.374 : 066 000                      MVI     M,0             ; CLEAR LSI
     300/ 31.376 : 311                          RET
     301/ 31.377 :                      
     302/ 31.377 :                      ;;      DCA - DETERMINE CONTIGUOUS AREA.
     303/ 31.377 :                      ;
     304/ 31.377 :                      ;       DCA IS CALLED TO FIND HOW MANY OF THE SECTORS WHICH ARE TO BE
     305/ 31.377 :                      ;       READ ARE CONTIGUOUS.
     306/ 31.377 :                      ;
     307/ 31.377 :                      ;       ENTRY   (B) = SECTORS DESIRED
     308/ 31.377 :                      ;                     AIO.XXX SETUP
     309/ 31.377 :                      ;       EXIT    (B) = SECTORS-AIO.CNT
     310/ 31.377 :                      ;               AIO.CNT = SECTORS WHICH ARE CONTIGUOUS
     311/ 31.377 :                      ;               AIO.EOF = EC.EOF*2+1 IF EOF
     312/ 31.377 :                      ;               AIO.TFP = SETUP WITH GROUP AND INDEX OF START OF AREA
     313/ 31.377 :                      ;       USES    ALL
     314/ 31.377 :                      
     315/ 31.377 :                      
     316/ 31.377 : 315 205 032          DCA1    CALL    FFL             ; FOLLOW FORWARD LINK
     317/ 32.002 :                      
     318/ 32.002 : 052 047 041          DCA     LHLD    AIO.CGN         ; (H) = CURRENT GP #, (L) = CUR SEC INDEX
     319/ 32.005 : 042 114 041                  SHLD    AIO.TFP         ; TEMP FILE POINTER
     320/ 32.010 : 315 233 033                  CALL    TFE             ; TEST FOR EOF
     321/ 32.013 : 062 113 041                  STA     AIO.EOF         ; SET FLAG
     322/ 32.016 : 062 111 041                  STA     AIO.CNT         ; SET CNT=0 IF EOF
     323/ 32.021 : 310                          RZ                      ; IS EOF
     324/ 32.022 : 072 050 041                  LDA     AIO.CSI         ; (A) = CURRENT SECTOR INDEX
     325/ 32.025 : 147                          MOV     H,A
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 24 - 2024-07-31 11:12:52 AM


     326/ 32.026 : 072 046 041                  LDA     AIO.SPG
     327/ 32.031 : 274                          CMP     H               ; SEE IF GROUP EXHAUSTED
     328/ 32.032 : 312 377 031                  JZ      DCA1            ; WAS POINTING AT END OF GROUP
     329/ 32.035 :                      
     330/ 32.035 :                      ;       SEE IF MORE NEEDED.
     331/ 32.035 :                      
     332/ 32.035 : 170                  DCA2    MOV     A,B
     333/ 32.036 : 247                          ANA     A
     334/ 32.037 : 310                          RZ                      ; NO MORE SECTORS TO CHECK
     335/ 32.040 :                      
     336/ 32.040 :                      ;       SEE HOW MANY SECTORS ARE LEFT IN THIS GROUP
     337/ 32.040 :                      
     338/ 32.040 : 052 051 041                  LHLD    AIO.LGN         ; (L) = AIO.LGN, (H) = AIO.LSI
     339/ 32.043 : 072 047 041                  LDA     AIO.CGN
     340/ 32.046 : 275                          CMP     L               ; SEE IF WE ARE POINTED AT LAST GROUP
     341/ 32.047 : 312 055 032                  JZ      DCA3            ; WE ARE
     342/ 32.052 : 052 045 041                  LHLD    AIO.SPG-1       ; (H) = AIO.SPG
     343/ 32.055 : 365                  DCA3    PUSH    PSW             ; SAVE STATUS
     344/ 32.056 : 072 050 041                  LDA     AIO.CSI         ; (A) = CURRENT SECTOR INDEX
     345/ 32.061 : 224                          SUB     H               ; (A) = -SECTORS LEFT IN GROUP
     346/ 32.062 : 057                          CMA
     347/ 32.063 : 074                          INR     A               ; (A) = +SECTORS LEFT IN GROUP
     348/ 32.064 : 270                          CMP     B
     349/ 32.065 : 332 071 032                  JC      DCA4            ; NEED STILL MORE
     350/ 32.070 : 170                          MOV     A,B             ; DON'T TAKE MORE THAN WE NEED
     351/ 32.071 : 117                  DCA4    MOV     C,A             ; (C) = AMOUNT TO TAKE
     352/ 32.072 : 041 050 041                  LXI     H,AIO.CSI
     353/ 32.075 : 206                          ADD     M               ; UPDATE CSI TO INDICATE NUMBER TO BE READ
     354/ 32.076 : 167                          MOV     M,A
     355/ 32.077 : 171                          MOV     A,C             ; (A) = NUMBER TO BE READ
     356/ 32.100 : 041 111 041                  LXI     H,AIO.CNT
     357/ 32.103 : 206                          ADD     M               ; ADD TO COUNT
     358/ 32.104 : 167                          MOV     M,A
     359/ 32.105 : 170                          MOV     A,B             ; (A) = AMOUNT NEEDED
     360/ 32.106 : 221                          SUB     C
     361/ 32.107 : 107                          MOV     B,A
     362/ 32.110 : 361                          POP     PSW
     363/ 32.111 : 310                          RZ                      ; WAS ON LAST TRACK: AM DONE
     364/ 32.112 : 170                          MOV     A,B
     365/ 32.113 : 247                          ANA     A
     366/ 32.114 : 310                          RZ                      ; NO MORE NEEDED: AM DONE
     367/ 32.115 :                      
     368/ 32.115 :                      ;       USED UP THIS BLOCK, LINK TO THE NEXT.
     369/ 32.115 :                      ;       IF NOT CONTIGUOUS, STOP HERE
     370/ 32.115 :                      
     371/ 32.115 : 072 047 041                  LDA    AIO.CGN
     372/ 32.120 : 074                          INR    A
     373/ 32.121 : 365                          PUSH   PSW              ; SAVE NEXT CONTIGUOUS BLOCK #
     374/ 32.122 : 315 205 032                  CALL   FFL              ; FOLLOW FILE LINK
     375/ 32.125 : 361                          POP    PSW
     376/ 32.126 : 275                          CMP    L
     377/ 32.127 : 312 035 032                  JZ     DCA2             ; GOT IT, WAS CONTIGUOUS
     378/ 32.132 : 311                          RET                     ; STOP HERE
     379/ 32.133 :                      
     380/ 32.133 :                      ;;      FFB - FIND FREE BLOCK.
     381/ 32.133 :                      ;
     382/ 32.133 :                      ;       FFB IS CALLED TO LOCATE A FREE BLOCK IN THE GRT'S
     383/ 32.133 :                      ;       FREE CHAIN.
     384/ 32.133 :                      ;
     385/ 32.133 :                      ;       FFB WILL ATTEMPT TO GET A 'PREFERRED BLOCK', IF POSSIBLE.
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 25 - 2024-07-31 11:12:52 AM


     386/ 32.133 :                      ;       IF THE PREFERRED BLOCK IS NOT AVAILABLE, FFB WILL (OPTIONALLY) DO
     387/ 32.133 :                      ;       THE BEST HE CAN: START A VIRGIN CLUSTER, IF POSSIBLE. THEN
     388/ 32.133 :                      ;       JUST SETTLE FOR ANYTHING.
     389/ 32.133 :                      ;
     390/ 32.133 :                      ;       ENTRY   (D) = PREFERRED BLOCK NUMBER (O IF NONE)
     391/ 32.133 :                      ;               (C) = PREFERRED FLAG (=0, WILL TAKE SOMETHING ELSE,
     392/ 32.133 :                      ;                                    <>0, MUST HAVE PREFERRED BLOCK (OR NOTHING)
     393/ 32.133 :                      ;       EXIT    'C' SET, EOM ON DEVICE
     394/ 32.133 :                      ;               'C' CLEAR, NOT EOM
     395/ 32.133 :                      ;               'Z' CLEAR, COULDN'T GET PREFERRED BLOCK (ONLY IF (C)<>0 ON ENTRY)
     396/ 32.133 :                      ;               'Z' SET, GOT A BLOCK (PREFERRED OR NOT)
     397/ 32.133 :                      ;               (HL) = ADDRESS OF BLOCK IN GRT TABLE
     398/ 32.133 :                      ;               (E) = INDEX OF FREE BLOCK BEFORE THE FOUND ONE
     399/ 32.133 :                      ;       USES    A,F,E,H,L
     400/ 32.133 :                      
     401/ 32.133 :                      
     402/ 32.133 : 052 044 041          FFB     LHLD    AIO.GRT
     403/ 32.136 : 176                          MOV     A,M             ; (A) = FIRST FREE BLOCK
     404/ 32.137 : 247                          ANA     A
     405/ 32.140 : 067                          STC                     ; ASSUME FROM
     406/ 32.141 : 310                          RZ                      ; END OF MEDIA
     407/ 32.142 :                      
     408/ 32.142 :                      ;       NOT END OF MEDIA, TRY TO FIND THE CONTIGUOUS BLOCK IN THE FREE LIST.
     409/ 32.142 :                      
     410/ 32.142 : 135                          MOV     E,L             ; (E) = INDEX OF PREVIOUS BYTE
     411/ 32.143 : 054                          INR     L
     412/ 32.144 : 167                          MOV     M,A             ; FLAG CHANGE IN GRT
     413/ 32.145 : 157                  FFB4    MOV     L,A             ; (HL) = ADDRESS OF NEXT BYTE IN FREE CHAIN
     414/ 32.146 : 272                          CMP     D
     415/ 32.147 : 310                          RZ                      ; GOT THE ONE WE NEED
     416/ 32.150 : 322 161 032                  JNC     FFB5            ; GONE TOO FAR
     417/ 32.153 : 135                          MOV     E,L             ; SAVE THIS BLOCK INDEX
     418/ 32.154 : 176                          MOV     A,M
     419/ 32.155 : 247                          ANA     A
     420/ 32.156 : 302 145 032                  JNZ     FFB4            ; TRY AGAIN
     421/ 32.161 :                      
     422/ 32.161 :                      ;       COULDN'T FIND CONTIGUOUS BLOCK. THIS MEANS A BREAK IN
     423/ 32.161 :                      ;       CONTINUITY. IF WE HAVE ANYTHING, RETURN WITH IT.
     424/ 32.161 :                      ;       IF WE HAVE NOTHING YET, TRY TO FIND A VIRGIN CLUSTER.
     425/ 32.161 :                      
     426/ 32.161 : 171                  FFB5    MOV     A,C
     427/ 32.162 : 247                          ANA     A
     428/ 32.163 : 300                          RNZ                     ; MUST NOT CONTINUE
     429/ 32.164 : 157                          MOV     L,A             ; (HL) = (AIO.GRT)
     430/ 32.165 : 135                  FFB6    MOV     E,L             ; (E) = INDEX OF PREVIOUS MODE
     431/ 32.166 : 156                          MOV     L,M             ; LINK FORWARD
     432/ 32.167 : 072 077 041                  LDA     AIO.DIR+DIR.CLU
     433/ 32.172 : 245                          ANA     L               ; SEE IF START OF CLUSTER
     434/ 32.173 : 310                          RZ                      ; GOT VIRGIN CLUSTER
     435/ 32.174 : 176                          MOV     A,M
     436/ 32.175 : 247                          ANA     A
     437/ 32.176 : 302 165 032                  JNZ     FFB6            ; TRY AGAIN
     438/ 32.201 :                      
     439/ 32.201 :                      ;       CAN'T FIND VIRGIN CLUSTER. WILL TAKE WHATEVER WE CAN GET.
     440/ 32.201 :                      
     441/ 32.201 : 157                          MOV     L,A
     442/ 32.202 : 135                          MOV     E,L             ; (E) = INDEX OR PREVIOUS MODE
     443/ 32.203 : 156                          MOV     L,M             ; (HL) = ADDRESS OF FIRST FREE BLOCK BYTE
     444/ 32.204 : 311                          RET                     ; RETURN WITH 'Z': GOT ONE
     445/ 32.205 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 26 - 2024-07-31 11:12:52 AM


     446/ 32.205 :                      ;;      FFL - FOLLOW FORWARD LINK.
     447/ 32.205 :                      ;
     448/ 32.205 :                      ;       FFL LINK AIO.CON TO THE NEXT GROUP
     449/ 32.205 :                      ;
     450/ 32.205 :                      ;       ENTRY   NONE
     451/ 32.205 :                      ;       EXIT    AIO.CGN = LINK(AIO.CGN)
     452/ 32.205 :                      ;               AIO.CSI = 0
     453/ 32.205 :                      ;               (L) = AIO.CGN
     454/ 32.205 :                      ;       USES    A,F,H,L
     455/ 32.205 :                      
     456/ 32.205 : 052 044 041          FFL     LHLD    AIO.GRT
     457/ 32.210 : 072 047 041                  LDA     AIO.CGN
     458/ 32.213 : 157                          MOV     L,A             ; (HL) = ADDRESS
     459/ 32.214 : 156                          MOV     L,M             ; (L) = LINK
     460/ 32.215 : 046 000                      MVI     H,0
     461/ 32.217 : 042 047 041                  SHLD    AIO.CGN         ; SET CGN, CLEAR CSI
     462/ 32.222 : 311                          RET
     463/ 32.223 :                      
     464/ 32.223 :                      ;;      LDD - LOAD DEVICE DRIVER.
     465/ 32.223 :                      ;
     466/ 32.223 :                      ;       LDD IS CALLED TO PERFORM THE SUSPENDED LOAD OF A DEVICE DRIVER.
     467/ 32.223 :                      ;
     468/ 32.223 :                      ;       IF SOME OVL CODE WISHES TO LOAD A DEVICE DRIVER, IT MUST
     469/ 32.223 :                      ;       SUSPEND THE REQUEST, SINCE THE DEVICE DRIVER WILL OVERLAY THE
     470/ 32.223 :                      ;       OVL CODE. AFTER THE OVL CODE EXITS, THE RESIDENT CODE WILL CALL
     471/ 32.223 :                      ;       LDD TO PERFORM THE ACTUAL LOAD, OVER THE OVL.
     472/ 32.223 :                      ;
     473/ 32.223 :                      ;       ENTRY   DD.IOC = POINTER TO IOC.DDA
     474/ 32.223 :                      ;               DD.LDA = LOAD ADDRESS
     475/ 32.223 :                      ;               DD.LEN = LOAD LENGTH
     476/ 32.223 :                      ;               DD.SEC = SECTOR INDEX ON SYSTEM DEVICE
     477/ 32.223 :                      ;               DD.DTA = DEV.RES ADDRESS
     478/ 32.223 :                      ;               DD.OPE = OPEN CODE (DC.OPR, DC.OPW, DC.OPU)
     479/ 32.223 :                      ;       EXIT    OVL CODE DESTROYED
     480/ 32.223 :                      ;       USES    NONE
     481/ 32.223 :                      
     482/ 32.223 : =40.364O             S.DDSEC EQU     S.DDGRP         ; REFERENCE TO MAKE ASSEMBLE OK
     483/ 32.223 :                      
     484/ 32.223 : 315 054 031          LDD     CALL    DSAVALL         ; SAVE REGS
     485/ 32.226 :                      
     486/ 32.226 :                      ;       CLEAR OVL RESIDENT FLAG
     487/ 32.226 :                      
     488/ 32.226 : 041 371 040                  LXI     H,S.OVLFL
     489/ 32.231 : 176                          MOV     A,M
     490/ 32.232 : 346 376                      ANI     377Q-OVL.IN
     491/ 32.234 : 167                          MOV     M,A             ; CLEAR IN FLAG
     492/ 32.235 :                      
     493/ 32.235 :                      ;       LOAD OVERLAY
     494/ 32.235 :                      
     495/ 32.235 : 052 362 040                  LHLD    S.DDLEN         ; (HL) = LENGTH
     496/ 32.240 : 104                          MOV     B,H
     497/ 32.241 : 115                          MOV     C,L             ; (BC) = LENGTH
     498/ 32.242 : 052 360 040                  LHLD    S.DDLDA         ; (HL) = LOAD ADDRESS
     499/ 32.245 : 345                          PUSH    H               ; SAVE FOR LATER
     500/ 32.246 : 353                          XCHG
     501/ 32.247 : 041 377 026                  LXI     H,SECSCR+255    ; FORCE NEW DISK READ RIGHT AWAY
     502/ 32.252 :                      
     503/ 32.252 :                      ;       LOAD BINARY
     504/ 32.252 :                      
     505/ 32.252 : 315 362 032          LDD2    CALL    LDD8            ; FIND NEXT BYTE
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 27 - 2024-07-31 11:12:52 AM


     506/ 32.255 : 176                          MOV     A,M             ; (A) = NEXT BYTE
     507/ 32.256 : 022                          STAX    D               ; COPY
     508/ 32.257 : 023                          INX     D
     509/ 32.260 : 013                          DCX     B
     510/ 32.261 : 170                          MOV     A,B
     511/ 32.262 : 261                          ORA     C
     512/ 32.263 : 302 252 032                  JNZ     LDD2            ; MORE TO GO
     513/ 32.266 :                      
     514/ 32.266 :                      ;       CODE ALL LOADED, RELOCATE IT
     515/ 32.266 :                      
     516/ 32.266 : 301                          POP     B               ; (BC) = REL FACTOR
     517/ 32.267 : 005                          DCR     B
     518/ 32.270 : 005                          DCR     B
     519/ 32.271 : 315 362 032          LDD3    CALL    LDD8
     520/ 32.274 : 136                          MOV     E,M
     521/ 32.275 : 315 362 032                  CALL    LDD8
     522/ 32.300 : 126                          MOV     D,M             ; (DE) = REL ADDRESS OF WORD TO RELOCATE
     523/ 32.301 : 172                          MOV     A,D
     524/ 32.302 : 263                          ORA     E
     525/ 32.303 : 312 323 032                  JZ      LDD4            ; ALL DONE
     526/ 32.306 : 353                          XCHG                    ; (HL) = REL ADDRESS OF WORD TO RELOCATE
     527/ 32.307 : 011                          DAD     B               ; (HL) = ABS ADDRESS OF WORD TO RELOCATE
     528/ 32.310 : 176                          MOV     A,M
     529/ 32.311 : 201                          ADD     C
     530/ 32.312 : 167                          MOV     M,A
     531/ 32.313 : 043                          INX     H
     532/ 32.314 : 176                          MOV     A,M
     533/ 32.315 : 210                          ADC     B
     534/ 32.316 : 167                          MOV     M,A
     535/ 32.317 : 353                          XCHG                    ; RESTORE (HL)
     536/ 32.320 : 303 271 032                  JMP                     LDD3
     537/ 32.323 :                      
     538/ 32.323 :                      ;       SETUP ENTRY ADDRESSES IN TABLES
     539/ 32.323 :                      
     540/ 32.323 : 052 360 040          LDD4    LHLD    S.DDLDA
     541/ 32.326 : 353                          XCHG                    ; (DE) = ENTRY ADDRESS
     542/ 32.327 : 052 366 040                  LHLD    S.DDDTA         ; (HL) = ADDRESS OF DEVLST ENTRY
     543/ 32.332 : 176                          MOV     A,M
     544/ 32.333 : 366 001                      ORI     DR.IM           ; SET IN MEMORY
     545/ 32.335 : 167                          MOV     M,A
     546/ 32.336 : 043                          INX     H
     547/ 32.337 : 043                          INX     H
     548/ 32.340 : 163                          MOV     M,E
     549/ 32.341 : 043                          INX     H
     550/ 32.342 : 162                          MOV     M,D             ; SET ADDRESS IN TABLE
     551/ 32.343 : 353                          XCHG                    ; (HL) = ENTRY POINT ADDRESS
     552/ 32.344 : 257                          XRA     A
     553/ 32.345 : 062 361 040                  STA     S.DDLDA+1       ; CLEAR LOAD FLAG
     554/ 32.350 : 072 370 040                  LDA     S.DDOPC         ; (A) = OPEN CODE
     555/ 32.353 : 315 361 032                  CALL    PCHL            ; CALL CODE
     556/ 32.356 : 303 047 031                  JMP     DRSTALL         ; RESTORE REGISTERS
     557/ 32.361 :                      
     558/ 32.361 : 351                  PCHL    PCHL
     559/ 32.362 :                      
     560/ 32.362 :                      ;;      LDD8 - READ A BYTE FROM THE FILE.
     561/ 32.362 :                      ;
     562/ 32.362 :                      ;       ENTRY   (HL) = SECSCR POINTER OF CURRENT BYTE
     563/ 32.362 :                      ;               S.DDESC = SECTOR NUMBER OF NEXT SECTOR
     564/ 32.362 :                      ;       EXIT    (HL) = ADDRESS OF NEXT BYTE
     565/ 32.362 :                      ;       USES    L
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 28 - 2024-07-31 11:12:52 AM


     566/ 32.362 :                      
     567/ 32.362 :                      
     568/ 32.362 : 054                  LDD8    INR     L               ; POINT TO NEXT BYTE
     569/ 32.363 : 300                          RNZ                     ; GOT IT
     570/ 32.364 :                      
     571/ 32.364 :                      ;       MUST READ ANOTHER
     572/ 32.364 :                      
     573/ 32.364 : 305                          PUSH    B
     574/ 32.365 : 325                          PUSH    D
     575/ 32.366 : 345                          PUSH    H
     576/ 32.367 : 353                          XCHG                    ; (DE) = ADDRESS
     577/ 32.370 : 001 000 001                  LXI     B,256
     578/ 32.373 : 052 364 040                  LHLD    S.DDSEC         ; (HL) = SECTOR NUMBER TO READ
     579/ 32.376 : 043                          INX     H
     580/ 32.377 : 042 364 040                  SHLD    S.DDSEC         ; (HL) = NEXT SECTOR NUMBER TO READ
     581/ 33.002 : 053                          DCX     H               ; RESTORE (HL)
     582/ 33.003 : 315 275 031                  CALL    SREAD           ; READ IT
     583/ 33.006 : 341                          POP     H
     584/ 33.007 : 321                          POP     D
     585/ 33.010 : 301                          POP     B
     586/ 33.011 : 311                          RET
     587/ 33.012 :                      
     588/ 33.012 :                      ;       LDO - LOAD OVL CODE.
     589/ 33.012 :                      ;
     590/ 33.012 :                      ;       LDO IS CALLED WHEN THE OVL OVERLAY MUST BE LOADED.
     591/ 33.012 :                      ;
     592/ 33.012 :                      ;       IF USER HIGH MEM IS TOO HIGH, PART OF THE USER CODE WILL
     593/ 33.012 :                      ;       HAVE TO BE SAVED ON THE SWAP AREA, BEFORE THE OVL CODE CAN BE
     594/ 33.012 :                      ;       LOADED.
     595/ 33.012 :                      ;
     596/ 33.012 :                      ;       ENTRY   NONE
     597/ 33.012 :                      ;       EXIT    NONE
     598/ 33.012 :                      ;       USES    A,F,H,L
     599/ 33.012 :                      
     600/ 33.012 :                      
     601/ 33.012 : 325                  LDO     PUSH    D
     602/ 33.013 : 305                          PUSH    B
     603/ 33.014 :                      
     604/ 33.014 :                      ;       SEE IF WILL HAVE TO PAGE USER CODE
     605/ 33.014 :                      
     606/ 33.014 : 052 376 040                  LHLD    S.OVLS          ; (HL) = SIZE OF HDOSOVL
     607/ 33.017 : 315 224 030                  CALL    DCHL            ; COMPLEMENT (HL)
     608/ 33.022 : 353                          XCHG                    ; (DE) = -SIZE
     609/ 33.023 : 052 320 040                  LHLD    S.SYSM          ; (HL) = CURRENT FWA
     610/ 33.026 : 031                          DAD     D               ; (HL) = NEW FWA WITH OVL
     611/ 33.027 : 042 372 040                  SHLD    S.UCSF          ; SET USER SWAP (IN CASE IT IS SWAPPED)
     612/ 33.032 : 353                          XCHG
     613/ 33.033 : 052 322 040                  LHLD    S.USRM
     614/ 33.036 : 175                          MOV     A,L
     615/ 33.037 : 223                          SUB     E
     616/ 33.040 : 157                          MOV     L,A
     617/ 33.041 : 174                          MOV     A,H
     618/ 33.042 : 232                          SBB     D
     619/ 33.043 : 147                          MOV     H,A             ; (HL) = AMOUNT TO SWAP
     620/ 33.044 : 332 073 033                  JC      LDO1            ; NO NEED TO SWAP
     621/ 33.047 :                      
     622/ 33.047 :                      ;       MUST DUMP (HL) BYTES OF USER CODE STARTING AT (DE)
     623/ 33.047 :                      
     624/ 33.047 : 325                          PUSH    D               ; SAVE ADDRESS
     625/ 33.050 : 042 374 040                  SHLD    S.UCSL          ; SET LENGTH OF DUMP
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 29 - 2024-07-31 11:12:52 AM


     626/ 33.053 : 104                          MOV     B,H
     627/ 33.054 : 115                          MOV     C,L             ; (BC) = COUNT
     628/ 33.055 : 052 002 041                  LHLD    S.SSN           ; (HL) = SECTOR FOR SWAP (SET BY BOOT)
     629/ 33.060 : 315 330 031                  CALL    SWRITE
     630/ 33.063 : 041 371 040                  LXI     H,S.OVLFL
     631/ 33.066 : 076 200                      MVI     A,OVL.UCS
     632/ 33.070 : 266                          ORA     M               ; SET USER CODE SWAPPED
     633/ 33.071 : 167                          MOV     M,A
     634/ 33.072 : 321                          POP     D               ; (DE) = ADDRESS TO LOAD
     635/ 33.073 :                      
     636/ 33.073 :                      ;       AM READY TO LOAD OVL OVERLAY.
     637/ 33.073 :                      ;
     638/ 33.073 :                      ;       (DE) = ADDRESS
     639/ 33.073 :                      
     640/ 33.073 : 052 376 040          LDO1    LHLD    S.OVLS
     641/ 33.076 : 104                          MOV     B,H
     642/ 33.077 : 115                          MOV     C,L             ; (BC) = SIZE OF OVERLAY
     643/ 33.100 : 052 004 041                  LHLD    S.OSN
     644/ 33.103 : 315 275 031                  CALL    SREAD           ; READ IT
     645/ 33.106 : 041 371 040                  LXI     H,S.OVLFL
     646/ 33.111 : 176                          MOV     A,M
     647/ 33.112 : 366 001                      ORI     OVL.IN          ; SET IT IN
     648/ 33.114 : 167                          MOV     M,A
     649/ 33.115 :                      
     650/ 33.115 :                      ;       RELOCATE OVL
     651/ 33.115 :                      
     652/ 33.115 : 052 372 040                  LHLD    S.UCSF          ; (HL) = FWA OVERLAY LOAD
     653/ 33.120 : 021 006 000                  LXI     D,PIC.COD
     654/ 33.123 : 104                          MOV     B,H
     655/ 33.124 : 115                          MOV     C,L             ; (BC) = OVL FWA
     656/ 33.125 : 031                          DAD     D               ; (HL) = ADDRESS OF ENTRY POINT
     657/ 33.126 : 042 000 041                  SHLD    S.OVLE          ; SET ENTRY POINT
     658/ 33.131 : 053                          DCX     H
     659/ 33.132 : 176                          MOV     A,M
     660/ 33.133 : 053                          DCX     H
     661/ 33.134 : 156                          MOV     L,M
     662/ 33.135 : 147                          MOV     H,A             ; (HL) = REL ADDRESS OF TABLE
     663/ 33.136 : 011                          DAD     B               ; (HL) = ANS ADDRESS OF TABLE
     664/ 33.137 : 315 175 033                  CALL    REL.            ; RELOCATE OVL
     665/ 33.142 :                      
     666/ 33.142 : 301                          POP     B
     667/ 33.143 : 321                          POP     D
     668/ 33.144 : 311                          RET
     669/ 33.145 :                      
     670/ 33.145 :                      ;;      PDI - PREPARE FOR DEVICE I/O
     671/ 33.145 :                      ;
     672/ 33.145 :                      ;       PDI PREPARES FOR PHYSICAL I/O, BY
     673/ 33.145 :                      ;
     674/ 33.145 :                      ;       1) COMPUTING THE PHYSICAL ADDRESS
     675/ 33.145 :                      ;       2) PREPARE THE COUNT
     676/ 33.145 :                      ;
     677/ 33.145 :                      ;       ENTRY   AIO.XXX SETUP
     678/ 33.145 :                      ;       EXIT    (BC) = COUNT
     679/ 33.145 :                      ;               (HL) = SECTOR
     680/ 33.145 :                      ;               (A) = 0
     681/ 33.145 :                      ;       USES    A,F,B,C,H,L
     682/ 33.145 :                      
     683/ 33.145 : 052 114 041          PDI     LHLD    AIO.TFP         ; (L) = AIO.CGN, (H) = AIO.CSI
     684/ 33.150 : 072 046 041                  LDA     AIO.SPG         ; (A) = SECTORS PER GROUP
     685/ 33.153 : 117                          MOV     C,A
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 30 - 2024-07-31 11:12:52 AM


     686/ 33.154 : 175                          MOV     A,L             ; (A) = GROUP NUMBER
     687/ 33.155 : 154                          MOV     L,H
     688/ 33.156 : 046 000                      MVI     H,0             ; (HL) = (0,CSI)
     689/ 33.160 : 104                          MOV     B,H             ; (BC) = (0,SPG)
     690/ 33.161 :                      
     691/ 33.161 :                      ;       COMPUTE SECTOR NUMBER BY ADDING SPG 'BLOCK NUMBER' TIMES.
     692/ 33.161 :                      
     693/ 33.161 : 011                  PDI1    DAD     B               ; ADD
     694/ 33.162 : 075                          DCR     A
     695/ 33.163 : 302 161 033                  JNZ     PDI1            ; MORE TO GO
     696/ 33.166 : 072 111 041                  LDA     AIO.CNT         ; (A) = COUNT
     697/ 33.171 : 110                          MOV     C,B             ; (C) = 0
     698/ 33.172 : 107                          MOV     B,A             ; (B) = SECTOR COUNT
     699/ 33.173 : 257                          XRA     A               ; CLEAR A
     700/ 33.174 : 311                          RET
     701/ 33.175 :                      
     702/ 33.175 :                      ;;      REL - RELOCATE CODE.
     703/ 33.175 :                      ;
     704/ 33.175 :                      ;       REL PROCESSES A RELOCATION LIST.
     705/ 33.175 :                      ;
     706/ 33.175 :                      ;       ENTRY   (BC) = DISPLACEMENT FROM ASSEMBLED ADDRESS
     707/ 33.175 :                      ;               (DE) = RELOCATION FACTOR (FROM CURRENT ADDRESS)
     708/ 33.175 :                      ;               (HL) = FWA RELOCATION LIST
     709/ 33.175 :                      ;       EXIT    NONE
     710/ 33.175 :                      ;       USES    ALL
     711/ 33.175 :                      
     712/ 33.175 :                      
     713/ 33.175 : 120                  REL.    MOV     D,B             ; ENTRY FOR CODE DISPLACE = REL FACTOR
     714/ 33.176 : 131                          MOV     E,C
     715/ 33.177 :                      
     716/ 33.177 : 325                  REL     PUSH    D               ; SAVE RELOCATION FACTOR
     717/ 33.200 : 136                          MOV     E,M
     718/ 33.201 : 043                          INX     H
     719/ 33.202 : 126                          MOV     D,M
     720/ 33.203 : 043                          INX     H               ; (DE) = REL ADDRESS OF WORD TO RELOCATE
     721/ 33.204 : 172                          MOV     A,D
     722/ 33.205 : 263                          ORA     E
     723/ 33.206 : 302 213 033                  JNZ     REL1            ; MORE TO DO
     724/ 33.211 : 321                          POP     D
     725/ 33.212 : 311                          RET                     ; EXIT
     726/ 33.213 :                      
     727/ 33.213 :                      ;       (DE) = INDEX OF WORD TO RELOCATE
     728/ 33.213 :                      ;       (HL) = RELOCATION TABLE ADDRESS
     729/ 33.213 :                      ;       (BC) = CODE DISPLACEMENT FACTOR
     730/ 33.213 :                      ;       ((SP)) = CODE RELOCATION FACTOR
     731/ 33.213 :                      
     732/ 33.213 : 353                  REL1    XCHG
     733/ 33.214 : 011                          DAD     B               ; (HL) = ABS ADDR OF WORD TO REL
     734/ 33.215 : 353                          XCHG                    ; (DE) = ABS CODE ADDRESS, (HL) = REL TABLE ADDR
     735/ 33.216 : 343                          XTHL                    ; (HL) = CODE REL FACTOR
     736/ 33.217 : 032                          LDAX    D
     737/ 33.220 : 205                          ADD     L               ; RELOCATE WORD OF CODE
     738/ 33.221 : 022                          STAX    D
     739/ 33.222 : 023                          INX     D
     740/ 33.223 : 032                          LDAX    D
     741/ 33.224 : 214                          ADC     H
     742/ 33.225 : 022                          STAX    D               ; RELOCATE
     743/ 33.226 : 353                          XCHG                    ; (DE) = RELOCATION FACTOR
     744/ 33.227 : 341                          POP     H               ; (HL) = RELOCATION TABLE ENTRY ADDRESS
     745/ 33.230 : 303 177 033                  JMP     REL             ; DO IT AGAIN
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 31 - 2024-07-31 11:12:52 AM


     746/ 33.233 :                      
     747/ 33.233 :                      ;;      TFE - TEST FOR EOF.
     748/ 33.233 :                      ;
     749/ 33.233 :                      ;       TFE CHECKS FOR AN END OF FILE, INDICATE BY
     750/ 33.233 :                      ;              AIO.CON = AIO.LGN
     751/ 33.233 :                      ;              AIO.CSI = AIO.LSI
     752/ 33.233 :                      ;
     753/ 33.233 :                      ;       ENTRY   NONE
     754/ 33.233 :                      ;       EXIT    'Z' CLEAR IF NOT EOF
     755/ 33.233 :                      ;                (A) = 0
     756/ 33.233 :                      ;               'Z' SET IF EOF
     757/ 33.233 :                      ;                'C' SET
     758/ 33.233 :                      ;                (A) = EC.EOF
     759/ 33.233 :                      ;       USES    A,F,H,L
     760/ 33.233 :                      
     761/ 33.233 :                      
     762/ 33.233 : 052 051 041          TFE     LHLD    AIO.LGN
     763/ 33.236 : 072 047 041                  LDA     AIO.CGN
     764/ 33.241 : 275                          CMP     L
     765/ 33.242 : 076 000                      MVI     A,0
     766/ 33.244 : 300                          RNZ                     ; NOT EOF
     767/ 33.245 : 072 050 041                  LDA     AIO.CSI
     768/ 33.250 : 274                          CMP     H
     769/ 33.251 : 076 000                      MVI     A,0
     770/ 33.253 : 300                          RNZ                     ; NOT EOF
     771/ 33.254 : 076 003                      MVI     A,EC.EOF*2+1    ; SET EOF CODE
     772/ 33.256 : 311                          RET
     773/ 33.257 :                      
     774/ 33.257 :                      ;;      RUC - RESTORE USER CODE.
     775/ 33.257 :                      ;
     776/ 33.257 :                      ;       RUC RESTORES THE USER PROGRAM CODE WHICH WAS SWAPPED
     777/ 33.257 :                      ;       FOR THE OVL CODE.
     778/ 33.257 :                      ;
     779/ 33.257 :                      ;       SINCE RUC RESIDES IN THE OVL AREA, IT MAY NOT RETURN AFTER THE
     780/ 33.257 :                      ;       DISK I/O CALL.
     781/ 33.257 :                      ;
     782/ 33.257 :                      ;       ENTRY   NONE
     783/ 33.257 :                      ;       EXIT    NONE
     784/ 33.257 :                      ;       USES    NONE
     785/ 33.257 :                      
     786/ 33.257 :                      
     787/ 33.257 : 315 054 031          RUC     CALL    DSAVALL         ; SAVE REGISTERS
     788/ 33.262 : 041 047 031                  LXI     H,DRSTALL
     789/ 33.265 : 345                          PUSH    H               ; RETURN VIA DRSTALL
     790/ 33.266 : 041 371 040                  LXI     H,S.OVLFL
     791/ 33.271 : 176                          MOV     A,M
     792/ 33.272 : 247                          ANA     A
     793/ 33.273 : 360                          RP                      ; NOT SWAPPED
     794/ 33.274 : 346 176                      ANI     377Q-OVL.UCS-OVL.IN ; RESTORE USER CODE, REMOVE OVL
     795/ 33.276 : 167                          MOV     M,A
     796/ 33.277 :                      
     797/ 33.277 :                      ;       RESTORE USER CODE
     798/ 33.277 :                      
     799/ 33.277 : 052 374 040                  LHLD    S.UCSL
     800/ 33.302 : 104                          MOV     B,H
     801/ 33.303 : 115                          MOV     C,L             ; (BC) = COUNT
     802/ 33.304 : 052 372 040                  LHLD    S.UCSF
     803/ 33.307 : 353                          XCHG                    ; (DE) = ADDRESS
     804/ 33.310 : 052 002 041                  LHLD    S.SSN           ; (HL) = SECTORS FOR SWAP
     805/ 33.313 : 303 275 031                  JMP     SREAD           ; READ AND EXIT
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 32 - 2024-07-31 11:12:52 AM


     806/ 33.316 :                      
     807/ 33.316 :                      
     808/ 33.316 :                      ;;      SYDD - SYSTEM DISK DEVICE DRIVER.
     809/ 33.316 :                      ;
     810/ 33.316 :                      ;       SYDD IS THE HDOS SYSTEM H17 DEVICE DRIVER.
     811/ 33.316 :                      ;
     812/ 33.316 :                      ;       ENTRY   (A) = DC.XXX FUNCTION CODE
     813/ 33.316 :                      ;               OTHER REGISTERS SET AS NEEDED BY FUNCTION
     814/ 33.316 :                      ;       EXIT    'C' CLEAR, OK
     815/ 33.316 :                      ;                REGISTERS SET BY FUNCTION
     816/ 33.316 :                      ;               'C' SET, ERROR
     817/ 33.316 :                      ;                (A) = ERROR CODE
     818/ 33.316 :                      ;       USES    ALL
     819/ 33.316 :                      
     820/ 33.316 : =33.316O             R.SYDD  EQU     $
     821/ 33.316 : 247                          ANA     A
     822/ 33.317 : 312 147 040                  JZ      D.READ
     823/ 33.322 : 075                          DCR     A
     824/ 33.323 : 312 155 040                  JZ      D.WRITE
     825/ 33.326 : 075                          DCR     A
     826/ 33.327 : 312 152 040                  JZ      D.READR         ; READ REGARDLESS
     827/ 33.332 : 376 005                      CPI     DC.ABT-2
     828/ 33.334 : 332 136 040                  JC      D.XOK           ; IS NOT ABORT OR MOUNT, IGNORE
     829/ 33.337 : 312 141 040                  JZ      D.ABORT         ; IS ABORT
     830/ 33.342 : 303 133 040                  JMP     D.MOUNT
     831/ 33.345 :                      
     832/ 33.345 :                      ;;      MOUNT - MOUNT NEW DEVICE.
     833/ 33.345 :                      ;
     834/ 33.345 :                      ;       MOUNT PROCESSES DEVICE DEPENDENT MOUNTING OF A NEW MEDIA.
     835/ 33.345 :                      ;
     836/ 33.345 :                      ;       THE VOLUME SERIAL IS READ INTO THE VOLUME TABLE, AND
     837/ 33.345 :                      ;       THE HEADS ARE HOMED.
     838/ 33.345 :                      ;
     839/ 33.345 :                      ;       ENTRY   (L) = VOLUME NUMBER (IF ANY)
     840/ 33.345 :                      
     841/ 33.345 :                      
     842/ 33.345 : =33.345O             R.MOUNT EQU     $
     843/ 33.345 : 105                          MOV     B,L             ; (B) = VOLUME SERIAL
     844/ 33.346 : 041 000 000                  LXI     H,0             ; SET SECTOR INDEX
     845/ 33.351 : 315 205 040                  CALL    D.SDP           ; SET DEVICE PARAMETERS
     846/ 33.354 : 315 213 040                  CALL    D.STZ           ; SEEK TRACK ZERO
     847/ 33.357 : 052 247 040                  LHLD    D.VOLPT
     848/ 33.362 : 160                          MOV     M,B             ; SET VOLUME NUMBER
     849/ 33.363 : 303 136 040                  JMP     D.XOK           ; EXIT WITH STUFF OK
     850/ 33.366 :                      
     851/ 33.366 :                      
     852/ 33.366 :                      ;;;     ABORT - ABORT ANY ACTIVE I/O.
     853/ 33.366 :                      ;
     854/ 33.366 :                      ;       ABORT CAUSES ANY ONGOING I/O TO BE ABORTED.
     855/ 33.366 :                      
     856/ 33.366 : =33.366O             R.ABORT EQU     $
     857/ 33.366 : 315 205 040                  CALL    D.SDP           ; SET DEVICE PARAMETERS
     858/ 33.371 : 315 213 040                  CALL    D.STZ           ; SEE TRACK ZERO
     859/ 33.374 :                      ;       JMP     D.XOK           ; EXIT AS IF OK
     860/ 33.374 :                      
     861/ 33.374 :                      ;;      XOK - EXIT WITH ALL OK FLAG.
     862/ 33.374 :                      ;
     863/ 33.374 : 257                  R.XOK   XRA     A
     864/ 33.375 : 365                  R.XIT   PUSH    PSW             ; SAVE STATUS
     865/ 33.376 : 072 244 040          XIT1    LDA     D.DLYHS
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 33 - 2024-07-31 11:12:52 AM


     866/ 34.001 : 247                          ANA     A
     867/ 34.002 : 302 376 033                  JNZ     XIT1            ; WAIT FOR HARDWARE DELAYS
     868/ 34.005 : 363                          DI                      ; LOCK OUT CLOCK
     869/ 34.006 : 072 242 040                  LDA     D.DVCTL
     870/ 34.011 : 346 220                      ANI     DF.MO+DF.WR     ; REMOVE DEVICE SELECT
     871/ 34.013 : 323 177                      OUT     DP.DC           ; DESELECT MOTOR
     872/ 34.015 : 062 242 040                  STA     D.DVCTL         ; UPDATE BYTE
     873/ 34.020 : 052 110 040                  LHLD    D.XITA
     874/ 34.023 : 042 243 040                  SHLD    D.DLYMO         ; SET 120/2 SECONDS OF MOTOR ON
     875/ 34.026 : 361                          POP     PSW
     876/ 34.027 : 373                  EIXIT   EI                      ; RESTORE INTERRUPTS
     877/ 34.030 : 311                          RET
     878/ 34.031 :                      
     879/ 34.031 :                      
     880/ 34.031 :                      ;;      CLOCK - PROCESS CLOCK INTERRUPTS.
     881/ 34.031 :                      ;
     882/ 34.031 :                      
     883/ 34.031 :                      
     884/ 34.031 : 072 033 040          CLOCK   LDA     TICCNT
     885/ 34.034 : 017                          RRC
     886/ 34.035 : 330                          RC                      ; NOT EVEN
     887/ 34.036 : 247                          ANA     A
     888/ 34.037 : 041 243 040                  LXI     H,D.DLYMO
     889/ 34.042 : 302 070 034                  JNZ     CLOCK1          ; NOT HALF SECOND
     890/ 34.045 : 075                          DCR     A               ; (A) = -1
     891/ 34.046 : 206                          ADD     M               ; SUBTRACT ONE
     892/ 34.047 : 322 070 034                  JNC     CLOCK1          ; WAS 0
     893/ 34.052 : 167                          MOV     M,A             ; UPDATE
     894/ 34.053 : 302 070 034                  JNZ     CLOCK1          ; NOT TIME FOR MOTOR OFF
     895/ 34.056 : 072 242 040                  LDA     D.DVCTL
     896/ 34.061 : 346 200                      ANI     DF.WR           ; REMOVE ALL BUT RAM/WRITE
     897/ 34.063 : 062 242 040                  STA     D.DVCTL
     898/ 34.066 : 323 177                      OUT     DP.DC           ; OFF MOTOR
     899/ 34.070 : 043                  CLOCK1  INX     H               ; (HL) = DDLYHS
     900/ 34.071 : 176                          MOV     A,M             ; (A) = D.DLYHS
     901/ 34.072 : 326 001                      SUI     1
     902/ 34.074 : 330                          RC                      ; WAS 0
     903/ 34.075 : 167                          MOV     M,A
     904/ 34.076 : 311                          RET
     905/ 34.077 :                      
     906/ 34.077 :                      
     907/ 34.077 :                      
     908/ 34.077 :                      ;;;     READ - READ FROM DISK.
     909/ 34.077 :                      ;
     910/ 34.077 :                      ;       ENTRY   (BC) = COUNT
     911/ 34.077 :                      ;               (DE) = ADDRESS
     912/ 34.077 :                      ;               (HL) = BLOCK #
     913/ 34.077 :                      ;               INTERRUPTS ENABLED
     914/ 34.077 :                      ;       EXIT    (DE) = NEXT UNUSED ADDRESS
     915/ 34.077 :                      ;               INTERRUPTS DISABLED
     916/ 34.077 :                      ;       USES    ALL
     917/ 34.077 :                      
     918/ 34.077 :                      
     919/ 34.077 : 345                  R.READ  PUSH    H               ; SAVE (HL)
     920/ 34.100 : 315 205 040                  CALL    D.SDP           ; SETUP DEVICE PARAMETERS
     921/ 34.103 : 052 273 040                  LHLD    D.OPR
     922/ 34.106 : 043                          INX     H
     923/ 34.107 : 042 273 040                  SHLD    D.OPR           ; COUNT OPERATION
     924/ 34.112 :                      
     925/ 34.112 :                      ;       READ TO READ SECTOR
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 34 - 2024-07-31 11:12:52 AM


     926/ 34.112 :                      ;
     927/ 34.112 :                      ;       (BC) = AMOUNT
     928/ 34.112 :                      ;       (DE) = ADDRESS
     929/ 34.112 :                      ;       ((SP)) = SECTOR NUMBER
     930/ 34.112 :                      
     931/ 34.112 : 341                  READ1   POP     H               ; (HL) = SECTOR NUMBER
     932/ 34.113 : 325                          PUSH    D               ; SAVE ADDR
     933/ 34.114 : 171                          MOV     A,C             ; ADJUST (B) SO THAT (B) = # OF WHOLE OR PARTIAL
     934/ 34.115 : 247                          ANA     A               ;  SECTORS TO READ, (C) = BYTES OF LAST SECTOR TO
     935/ 34.116 : 312 122 034                  JZ      READ1.5         ;  READ, (C)=0 IF TO READ ENTIRE LAST SECTOR
     936/ 34.121 : 004                          INR     B
     937/ 34.122 :                      
     938/ 34.122 :                      ;       * * NOTE * *
     939/ 34.122 :                      ;
     940/ 34.122 :                      ;       THIS CODE RUNS WITH INTERRUPTS DISABLED FROM HERE ON
     941/ 34.122 :                      
     942/ 34.122 : 305                  READ1.5 PUSH    B               ; SAVE COUNT
     943/ 34.123 : 315 163 040                  CALL    D.DTS           ; DECODE TRACK AND SECTOR
     944/ 34.126 : 076 001              READ2   MVI     A,1             ; (A) = DELAY COUNT FOR START
     945/ 34.130 :                      
     946/ 34.130 :                      ;       LOOK FOR RIGHT SECTOR.
     947/ 34.130 :                      ;       (A) = DELAY COUNT BEFORE SEARCH
     948/ 34.130 :                      
     949/ 34.130 : 315 216 040          READ2.4 CALL    D.UDLY          ; DELAY SOME MICROSECONDS
     950/ 34.133 : 315 177 040                  CALL    D.LPS           ; LOCATE PROPER SECTOR
     951/ 34.136 : 332 300 034                  JC      READ7           ; ERROR
     952/ 34.141 : 301                          POP     B               ; (BC) = COUNT
     953/ 34.142 : 341                          POP     H               ; (HL) = ADDRESS FOR DATA
     954/ 34.143 :                      
     955/ 34.143 :                      ;       CHECK AMOUNT TO READ
     956/ 34.143 :                      
     957/ 34.143 : 170                  READ3   MOV     A,B
     958/ 34.144 : 261                          ORA     C
     959/ 34.145 : 312 315 034                  JZ      READ8           ; NO MORE TO READ
     960/ 34.150 : 345                          PUSH    H
     961/ 34.151 : 305                          PUSH    B               ; SAVE COUNT AND ADDRESS IN CASE OF ERROR
     962/ 34.152 : 005                          DCR     B               ; SEE IF ON LAST (MAYBE PARTIAL) SECTOR
     963/ 34.153 : 312 160 034                  JZ      READ3.5         ; ON LAST SECTOR, READ (C) COUNT
     964/ 34.156 : 016 000                      MVI     C,0             ; WILL READ ALL 256 BYTES
     965/ 34.160 : 101                  READ3.5 MOV     B,C             ; (B) = # TO READ+1, (C) = # TO SKIP
     966/ 34.161 : 315 221 040                  CALL    D.WSC           ; WAIT SYNC CHARACTER
     967/ 34.164 : 332 261 034                  JC      READ71          ; DIDN'T GET ONE
     968/ 34.167 :                      
     969/ 34.167 :                      ;       READ DATA
     970/ 34.167 :                      
     971/ 34.167 : 315 202 040          READ4   CALL    D.RDB           ; READ BYTE
     972/ 34.172 : 167                          MOV     M,A             ; STORE
     973/ 34.173 : 043                          INX     H
     974/ 34.174 : 005                          DCR     B
     975/ 34.175 : 302 167 034                  JNZ     READ4           ; MORE TO GO
     976/ 34.200 : 171                          MOV     A,C
     977/ 34.201 : 247                          ANA     A
     978/ 34.202 : 312 214 034                  JZ      READ6           ; NONE TO DISCARD
     979/ 34.205 :                      
     980/ 34.205 :                      ;       READ, CHECKSUM, AND DISCARD DATA
     981/ 34.205 :                      
     982/ 34.205 : 315 202 040          READ5   CALL    D.RDB
     983/ 34.210 : 014                          INR     C
     984/ 34.211 : 302 205 034                  JNZ     READ5
     985/ 34.214 : 102                  READ6   MOV     B,D             ; (B) = CHECKSUM
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 35 - 2024-07-31 11:12:52 AM


     986/ 34.215 : 315 202 040                  CALL    D.RDB
     987/ 34.220 : 270                          CMP     B
     988/ 34.221 : 302 272 034                  JNZ     READ72          ; CHECKSUM ERROR
     989/ 34.224 :                      
     990/ 34.224 :                      ;       GOT GOOD SECTOR
     991/ 34.224 :                      
     992/ 34.224 : 301                          POP     B               ; (BC) = OLD COUNT
     993/ 34.225 : 005                          DCR     B               ; COUNT SECTOR READ
     994/ 34.226 : 312 315 034                  JZ      READ8           ; JUST READ LAST ONE
     995/ 34.231 :                      
     996/ 34.231 :                      ;       HAVE MORE TO READ
     997/ 34.231 :                      
     998/ 34.231 : 343                          XTHL                    ; SAVE ADDRESS
     999/ 34.232 : 305                          PUSH    B               ; SAVE COUNT
    1000/ 34.233 : 041 241 040                  LXI     H,D.TS
    1001/ 34.236 : 064                          INR     M               ; COUNT SECTOR
    1002/ 34.237 : 076 012                      MVI     A,10
    1003/ 34.241 : 226                          SUB     M
    1004/ 34.242 : 076 000                      MVI     A,0
    1005/ 34.244 : 302 130 034                  JNZ     READ2.4         ; NOT AT END OF TRACK
    1006/ 34.247 : 167                          MOV     M,A             ; SECTOR # = 0
    1007/ 34.250 : 053                          DCX     H
    1008/ 34.251 : 064                          INR     M
    1009/ 34.252 : 373                          EI                      ; RESTORE INTERRUPTS UNTIL *STS* CALLED
    1010/ 34.253 : 315 166 040                  CALL    D.SDT           ; SEE DESIRED TRACK
    1011/ 34.256 : 303 126 034                  JMP     READ2
    1012/ 34.261 :                      
    1013/ 34.261 :                      ;       CAN'T GET DATA, HEADER OR CHECKSUM PROBLEM
    1014/ 34.261 :                      
    1015/ 34.261 : 041 265 040          READ71  LXI     H,D.E.MDS       ; MISSING DATA SYNC ERROR
    1016/ 34.264 : 315 232 040                  CALL    D.ERRT
    1017/ 34.267 : 303 300 034                  JMP     READ7
    1018/ 34.272 :                      
    1019/ 34.272 : 041 267 040          READ72  LXI     H,D.E.CHK       ; CHECKSUM ERROR
    1020/ 34.275 : 315 232 040                  CALL    D.ERRT
    1021/ 34.300 :                      
    1022/ 34.300 : 315 160 040          READ7   CALL    D.CDE           ; COUNT DISK ERROR
    1023/ 34.303 : 322 126 034                  JNC     READ2           ; TRY AGAIN
    1024/ 34.306 : 301                          POP     B
    1025/ 34.307 : 321                          POP     D
    1026/ 34.310 : 076 022                      MVI     A,EC.RF         ; READ FAILURE
    1027/ 34.312 : 303 144 040                  JMP     D.XIT           ; TOO MANY ERRORS, TOO BAD...
    1028/ 34.315 :                      
    1029/ 34.315 :                      ;       ENTIRE READ WAS OK
    1030/ 34.315 :                      
    1031/ 34.315 : 341                  READ8   POP     H               ; CLEAN STACK
    1032/ 34.316 : 303 136 040                  JMP     D.XOK           ; EXIT OK
    1033/ 34.321 :                      
    1034/ 34.321 :                      
    1035/ 34.321 :                      ;;;     READR -  READ DISK REGARDLESS OF VOLUME PROTECTION.
    1036/ 34.321 :                      ;
    1037/ 34.321 :                      ;       ENTRY   (BC) = COUNT
    1038/ 34.321 :                      ;               (DE) = ADDRESS
    1039/ 34.321 :                      ;               (HL) = BLOCK #
    1040/ 34.321 :                      ;       EXIT    (DE) = NEXT USED ADDRESS
    1041/ 34.321 :                      ;       USES    ALL
    1042/ 34.321 :                      
    1043/ 34.321 :                      
    1044/ 34.321 : 345                  R.READR PUSH    H               ; SAVE (HL)
    1045/ 34.322 : 315 205 040                  CALL    D.SDP           ; SETUP DEVICE PARAMETERS
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 36 - 2024-07-31 11:12:52 AM


    1046/ 34.325 : 041 320 031                  LXI     H,ZEROS
    1047/ 34.330 : 042 247 040                  SHLD    D.VOLPT
    1048/ 34.333 : 303 112 034                  JMP     READ1           ; PROCESS AS REGULAR READ
    1049/ 34.336 :                      
    1050/ 34.336 :                      
    1051/ 34.336 :                      ;;;     WRITE - PROCESS DISK WRITE.
    1052/ 34.336 :                      ;
    1053/ 34.336 :                      ;       ENTRY   (BC) = COUNT
    1054/ 34.336 :                      ;               (DE) = ADDRESS
    1055/ 34.336 :                      ;               (HL) = BLOCK #
    1056/ 34.336 :                      ;       EXIT    (LINK) = LAST BLOCK #
    1057/ 34.336 :                      ;       USES    ALL
    1058/ 34.336 :                      
    1059/ 34.336 :                      
    1060/ 34.336 : =34.336O             R.WRITE EQU     $
    1061/ 34.336 : 345                          PUSH    H               ; SAVE BLOCK NUMBER
    1062/ 34.337 : 315 205 040                  CALL    D.SDP           ; SET DEVICE PARAMETERS
    1063/ 34.342 : 052 275 040                  LHLD    D.OPW
    1064/ 34.345 : 043                          INX     H
    1065/ 34.346 : 042 275 040                  SHLD    D.OPW           ; COUNT OPERATION
    1066/ 34.351 : 333 177                      IN      DP.DC           ; SEE IF DISK WRITE PROTECTED
    1067/ 34.353 : 346 004                      ANI     DF.WP
    1068/ 34.355 : 067                          STC
    1069/ 34.356 : 076 025                      MVI     A,EC.WP
    1070/ 34.360 : 302 132 035                  JNZ     WRITE8          ; DISK IS WRITE PROTECTED
    1071/ 34.363 :                      
    1072/ 34.363 :                      ;       READY TO WRITE SECTOR
    1073/ 34.363 :                      ;
    1074/ 34.363 :                      ;               (BC) = COUNT
    1075/ 34.363 :                      ;               (DE) = ADDRESS
    1076/ 34.363 :                      ;               ((SP)) = SECTOR NUMBER
    1077/ 34.363 :                      
    1078/ 34.363 : 041 377 000                  LXI     H,377Q
    1079/ 34.366 : 011                          DAD     B
    1080/ 34.367 : 104                          MOV     B,H             ; (B) = # OF SECTORS TO WRITE
    1081/ 34.370 :                      
    1082/ 34.370 : 341                  WRITE1  POP     H               ; (HL) = SECTOR NUMBER
    1083/ 34.371 : 325                          PUSH    D               ; SAVE ADDR
    1084/ 34.372 :                      
    1085/ 34.372 :                      ;       * * NOTE * *
    1086/ 34.372 :                      ;
    1087/ 34.372 :                      ;       THIS CODE RUNS WITH INTERRUPTS DISABLED FROM THIS POINT ON
    1088/ 34.372 :                      
    1089/ 34.372 : 315 163 040                  CALL    D.DTS           ; DETERMINE TRACK AND SECTOR
    1090/ 34.375 : 076 001              WRITE2  MVI     A,1             ; (A) = SHORT DELAY COUNT
    1091/ 34.377 :                      
    1092/ 34.377 :                      ;       FIND RIGHT SECTOR
    1093/ 34.377 :                      ;       (A) = DELAY COUNT
    1094/ 34.377 :                      
    1095/ 34.377 : 315 216 040          WRIT2.5 CALL    D.UDLY          ; DELAY SOME MICROSECONDS
    1096/ 35.002 : 305                          PUSH    B               ; SAVE COUNT
    1097/ 35.003 : 315 177 040                  CALL    D.LPS           ; LOCATE PROPER SECTOR
    1098/ 35.006 : 301                          POP     B               ; (BC) = COUNT
    1099/ 35.007 : 332 122 035                  JC      WRITE7          ; CAN'T FIND IT
    1100/ 35.012 : 341                          POP     H               ; (HL) = ADDR
    1101/ 35.013 : 072 112 040                  LDA     D.WRITA         ; (A) = GUARDBAND DELAY
    1102/ 35.016 : 075                  WRITE4  DCR     A
    1103/ 35.017 : 302 016 035                  JNZ     WRITE4          ; PAUSE OVER GUARDBAND
    1104/ 35.022 : 072 113 040                  LDA     D.WRITB
    1105/ 35.025 : 117                          MOV     C,A             ; (C) = # OF 00 CHARACTERS
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 37 - 2024-07-31 11:12:52 AM


    1106/ 35.026 : 072 114 040                  LDA     D.WRITC         ; (A) = 128/8 = TWO CHARACTER TIMES BEFORE WRITING
    1107/ 35.031 : 315 224 040                  CALL    D.WSP           ; WRITE SYNC PATTERN
    1108/ 35.034 :                      
    1109/ 35.034 :                      ;       OUT WITH THE DATA
    1110/ 35.034 :                      
    1111/ 35.034 : 176                  WRITE5  MOV     A,M
    1112/ 35.035 : 315 227 040                  CALL    D.WNB
    1113/ 35.040 : 043                          INX     H
    1114/ 35.041 : 015                          DCR     C
    1115/ 35.042 : 302 034 035                  JNZ     WRITE5          ; NOT DONE YET
    1116/ 35.045 : 172                          MOV     A,D             ; (A) = CHECKSUM
    1117/ 35.046 : 315 227 040                  CALL    D.WNB           ; WRITE CHECKSUM
    1118/ 35.051 :                      
    1119/ 35.051 :                      ;       HAVE DONE WRITING. LEAVE WRITE-GATE OPEN FOR 3 CHARACTER TIMES
    1120/ 35.051 :                      ;       TO FINISH TUNNEL ERASING.
    1121/ 35.051 :                      
    1122/ 35.051 : 315 227 040                  CALL    D.WNB
    1123/ 35.054 : 315 227 040                  CALL    D.WNB
    1124/ 35.057 : 315 227 040                  CALL    D.WNB
    1125/ 35.062 : 072 242 040                  LDA     D.DVCTL
    1126/ 35.065 : 323 177                      OUT     DP.DC           ; OFF DISK CONTROL
    1127/ 35.067 : 005                          DCR     B
    1128/ 35.070 : 312 136 040                  JZ      D.XOK           ; ALL DONE
    1129/ 35.073 : 345                          PUSH    H               ; SAVE ADDRESS
    1130/ 35.074 : 041 241 040                  LXI     H,D.TS
    1131/ 35.077 : 064                          INR     M
    1132/ 35.100 : 076 012                      MVI     A,10
    1133/ 35.102 : 226                          SUB     M
    1134/ 35.103 : 076 000                      MVI     A,0
    1135/ 35.105 : 302 377 034                  JNZ     WRIT2.5         ; NOT AT END OF TRACK
    1136/ 35.110 :                      
    1137/ 35.110 :                      ;       MOVE TO NEXT TRACK
    1138/ 35.110 :                      
    1139/ 35.110 : 167                          MOV     M,A             ; CLEAR CURRENT SECTOR INDEX
    1140/ 35.111 : 053                          DCX     H
    1141/ 35.112 : 064                          INR     M
    1142/ 35.113 : 373                          EI                      ; RESTORE INTERRUPTS UNTIL *STS* CALL
    1143/ 35.114 : 315 166 040                  CALL    D.SDT           ; SEEK DESIRED TRACK
    1144/ 35.117 : 303 375 034                  JMP     WRITE2
    1145/ 35.122 :                      
    1146/ 35.122 :                      ;       ERROR
    1147/ 35.122 :                      
    1148/ 35.122 : 315 160 040          WRITE7  CALL    D.CDE           ; COUNT DISK ERROR
    1149/ 35.125 : 322 375 034                  JNC     WRITE2          ; TRY AGAIN
    1150/ 35.130 : 076 023                      MVI     A,EC.WF         ; WRITE FAILURE
    1151/ 35.132 : 341                  WRITE8  POP     H               ; RESTORE STACK
    1152/ 35.133 : 303 144 040                  JMP     D.XIT           ; TOO MANY... TRY AGAIN
    1153/ 35.136 :                      
    1154/ 35.136 :                      ;;      CDE - COUNT DISK ERRORS.
    1155/ 35.136 :                      ;
    1156/ 35.136 :                      ;       CDE IS CALLED WHEN A DISK SOFT ERROR OCCURS. IF THERE HAVE
    1157/ 35.136 :                      ;       OCCURRED 10 SOFT ERRORS FOR THIS OPERATION, THEN A HARD ERROR
    1158/ 35.136 :                      ;       IS FLAGGED.
    1159/ 35.136 :                      ;
    1160/ 35.136 :                      ;       ENTRY   NONE
    1161/ 35.136 :                      ;       EXIT    'C' SET IF HARD ERROR
    1162/ 35.136 :                      ;               INTERRUPTS DISABLED
    1163/ 35.136 :                      ;       USES    A,F,H,L
    1164/ 35.136 :                      
    1165/ 35.136 : 373                  R.CDE   EI                      ; RESTORE INTERRUPTS
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 38 - 2024-07-31 11:12:52 AM


    1166/ 35.137 : 315 213 040                  CALL    D.STZ           ; SEEK TRACK ZERO
    1167/ 35.142 : 315 166 040                  CALL    D.SDT           ; SEEK DESIRED TRACK
    1168/ 35.145 : 247                          ANA     A               ; CLEAR CARRY
    1169/ 35.146 : 052 262 040                  LHLD    D.SECNT
    1170/ 35.151 : 043                          INX     H
    1171/ 35.152 : 042 262 040                  SHLD    D.SECNT         ; INCREMENT COUNT
    1172/ 35.155 : 041 264 040                  LXI     H,D.OECNT       ; (HL) = #OPERATION ERROR COUNT
    1173/ 35.160 : 065                          DCR     M
    1174/ 35.161 : 360                          RP                      ; NOT TOO MANY
    1175/ 35.162 : 053                          DCX     H
    1176/ 35.163 : 076 366                      MVI     A,-ERPTCNT
    1177/ 35.165 : 206                          ADD     M               ; REMOVE SOFT COUNT
    1178/ 35.166 : 167                          MOV     M,A
    1179/ 35.167 : 064                          INR     M               ; COUNT HARD ERROR
    1180/ 35.170 : 067                          STC
    1181/ 35.171 : 311                          RET                     ; EXIT WITH 'C' SET
    1182/ 35.172 :                      
    1183/ 35.172 :                      ;;      DTS - DECODE TRACK AND SECTOR.
    1184/ 35.172 :                      ;
    1185/ 35.172 :                      ;       DTS DECODES THE TRACK AND SECTOR NUMBER FROM
    1186/ 35.172 :                      ;       THE SUPPLIED SECTOR INDEX.
    1187/ 35.172 :                      ;
    1188/ 35.172 :                      ;       ENTRY   (HL) = SECTOR INDEX
    1189/ 35.172 :                      ;               INTERRUPTS ENABLED
    1190/ 35.172 :                      ;       EXIT    D.TS = SECTOR NUMBER
    1191/ 35.172 :                      ;               D.TT = TRACK
    1192/ 35.172 :                      ;               INTERRUPTS DISABLED
    1193/ 35.172 :                      ;       USES    A,F,H,L
    1194/ 35.172 :                      
    1195/ 35.172 :                      
    1196/ 35.172 : 305                  R.DTS   PUSH    B               ; SAVE (BC)
    1197/ 35.173 : 001 366 377                  LXI     B,-10
    1198/ 35.176 : 170                          MOV     A,B             ; (A) = 377Q
    1199/ 35.177 : 074                  DTS1    INR     A
    1200/ 35.200 : 011                          DAD     B
    1201/ 35.201 : 332 177 035                  JC      DTS1
    1202/ 35.204 : 062 240 040                  STA     D.TT            ; SET TRACK NUMBER
    1203/ 35.207 : 175                          MOV     A,L
    1204/ 35.210 : 306 012                      ADI     10
    1205/ 35.212 : 062 241 040                  STA     D.TS            ; SET SECTOR
    1206/ 35.215 : 301                          POP     B               ; RESTORE (BC)
    1207/ 35.216 : 303 225 035                  JMP     R.SDT           ; SEE DESIRED TRACK
    1208/ 35.221 :                      
    1209/ 35.221 :                      ;;      SDT - SEEK DESIRED TRACK.
    1210/ 35.221 :                      ;
    1211/ 35.221 :                      ;       SDT MOVES THE DISK ARM TO THE DESIRED (D.TT) TRACK.
    1212/ 35.221 :                      ;
    1213/ 35.221 :                      ;       ENTRY   NONE
    1214/ 35.221 :                      ;       EXIT    NONE
    1215/ 35.221 :                      ;       USES    A,F,H,L
    1216/ 35.221 :                      
    1217/ 35.221 :                      
    1218/ 35.221 :                      ;       MOVE ARM IN
    1219/ 35.221 :                      
    1220/ 35.221 : 064                  SDT3    INR     M
    1221/ 35.222 : 315 171 040                  CALL    D.MAI
    1222/ 35.225 :                      
    1223/ 35.225 :                      
    1224/ 35.225 : 052 245 040          R.SDT   LHLD    D.TRKPT
    1225/ 35.230 : 072 240 040                  LDA     D.TT
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 39 - 2024-07-31 11:12:52 AM


    1226/ 35.233 : 276                          CMP     M
    1227/ 35.234 : 312 210 040                  JZ      D.STS           ; GOT THERE
    1228/ 35.237 : 362 221 035                  JP      SDT3            ; MUST MOVE IN
    1229/ 35.242 :                      
    1230/ 35.242 :                      ;       MOVE ARM OUT
    1231/ 35.242 :                      
    1232/ 35.242 : 065                  SDT1    DCR     M               ; UPDATE TRACK NUMBER
    1233/ 35.243 : 315 174 040                  CALL    D.MAO           ; MOVE ARM OUT
    1234/ 35.246 : 303 225 035                  JMP     R.SDT           ; SEE IF THERE YET
    1235/ 35.251 :                      
    1236/ 35.251 :                      ;;      MAI - MOVE DISK ARM IN ONE TRACK.
    1237/ 35.251 :                      ;
    1238/ 35.251 :                      ;       ENTRY   NONE
    1239/ 35.251 :                      ;       EXIT    NONE
    1240/ 35.251 :                      ;       USES    A,F
    1241/ 35.251 :                      
    1242/ 35.251 :                      
    1243/ 35.251 :                      ;;      MAO - MOVE ARM OUT.
    1244/ 35.251 :                      ;
    1245/ 35.251 :                      ;       USES    A,F
    1246/ 35.251 :                      
    1247/ 35.251 : 076 040              R.MAI   MVI     A,DF.DI         ; SET DIRECTION
    1248/ 35.253 :                      
    1249/ 35.253 : 376                          DB      MI.CPI          ; GOBBLE XRA INSTRUCTION
    1250/ 35.254 : 257                  R.MAO   XRA     A               ; SET DIRECTION
    1251/ 35.255 :                      
    1252/ 35.255 : 345                          PUSH    H
    1253/ 35.256 : 147                          MOV     H,A
    1254/ 35.257 : 072 242 040                  LDA     D.DVCTL
    1255/ 35.262 : 346 237                      ANI     377Q-DF.DI-DF.ST
    1256/ 35.264 : 264                          ORA     H               ; SET DIRECTION
    1257/ 35.265 : 323 177                      OUT     DP.DC           ; SET DIRECTION
    1258/ 35.267 : 341                          POP     H               ; RESTORE (HL)
    1259/ 35.270 : 366 100                      ORI     DF.ST
    1260/ 35.272 : 323 177                      OUT     DP.DC           ; START STEP
    1261/ 35.274 : 356 100                      XRI     DF.ST
    1262/ 35.276 : 323 177                      OUT     DP.DC           ; COMPLETE STEP
    1263/ 35.300 : 072 115 040                  LDA     D.MAIA          ; (A) = MS/2 FOR TRACK TIMING
    1264/ 35.303 :                      ;       JMP     D.DLY           ; DELAY 8 MS
    1265/ 35.303 :                      
    1266/ 35.303 :                      ;;      DLY - DELAY BY FRONT PANEL CLOCK.
    1267/ 35.303 :                      ;
    1268/ 35.303 :                      ;       ENTRY   (A) = MILLISECOND COUNT/2
    1269/ 35.303 :                      ;       EXIT    NONE
    1270/ 35.303 :                      ;       USES    A,F
    1271/ 35.303 :                      
    1272/ 35.303 :                      
    1273/ 35.303 : 345                  R.DLY   PUSH    H
    1274/ 35.304 : 041 033 040                  LXI     H,TICCNT
    1275/ 35.307 : 206                          ADD     M
    1276/ 35.310 : 276                  DLY1    CMP     M
    1277/ 35.311 : 302 310 035                  JNZ     DLY1
    1278/ 35.314 : 341                          POP     H
    1279/ 35.315 : 311                          RET
    1280/ 35.316 :                      
    1281/ 35.316 :                      ;;      LPS - LOCATE PROPER SECTOR.
    1282/ 35.316 :                      ;
    1283/ 35.316 :                      ;       LPS READS OVER SECTOR HEADERS UNTIL THE PROPER SECTOR
    1284/ 35.316 :                      ;       IS FOUND.
    1285/ 35.316 :                      ;
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 40 - 2024-07-31 11:12:52 AM


    1286/ 35.316 :                      ;       UPON ENTRY, THE ARM SHOULD BE POSITIONED OVER THE SECTOR.
    1287/ 35.316 :                      ;
    1288/ 35.316 :                      ;       D.TT = DESIRED TRACK
    1289/ 35.316 :                      ;       D.TS - DESIRED SECTOR
    1290/ 35.316 :                      ;
    1291/ 35.316 :                      ;       ENTRY   NONE
    1292/ 35.316 :                      ;       EXIT    INTERRUPTS DISABLED
    1293/ 35.316 :                      ;               'C' SET IF ERROR
    1294/ 35.316 :                      ;       USES    ALL BUT C
    1295/ 35.316 :                      
    1296/ 35.316 :                      
    1297/ 35.316 : 315 210 040          LPS0    CALL    D.STS           ; SKIP THIS SECTOR
    1298/ 35.321 :                      
    1299/ 35.321 : 072 116 040          R.LPS   LDA     D.LPSA          ; (A) = #OF TRIES FOR THIS SECTOR
    1300/ 35.324 : 107                          MOV     B,A
    1301/ 35.325 : 072 244 040                  LDA     D.DLYHS
    1302/ 35.330 : 247                          ANA     A
    1303/ 35.331 : 302 316 035                  JNZ     LPS0            ; WAIT FOR HEADS TO SETTLE
    1304/ 35.334 :                      
    1305/ 35.334 : 363                  LPS1    DI                      ; DISABLE INTERRUPTS
    1306/ 35.335 : 315 221 040                  CALL    D.WSC           ; WAIT SYNC CHARACTER
    1307/ 35.340 : 332 025 036                  JC      LPS3            ; NONE
    1308/ 35.343 : 052 247 040                  LHLD    D.VOLPT
    1309/ 35.346 : 315 202 040                  CALL    D.RDB
    1310/ 35.351 : 276                          CMP     M               ; SEE IF PROPER VOLUME
    1311/ 35.352 : 302 032 036                  JNZ     LPS4            ; WRONG VOLUME
    1312/ 35.355 : 041 240 040                  LXI     H,D.TT
    1313/ 35.360 : 315 202 040                  CALL    D.RDB
    1314/ 35.363 : 276                          CMP     M               ; SEE IF PROPER TRACK
    1315/ 35.364 : 302 037 036                  JNZ     LPS5            ; WRONG TRACK
    1316/ 35.367 : 043                          INX     H
    1317/ 35.370 : 315 202 040                  CALL    D.RDB
    1318/ 35.373 : 276                          CMP     M
    1319/ 35.374 : 302 014 036                  JNZ     LPS2            ; WRONG SECTOR
    1320/ 35.377 :                      
    1321/ 35.377 :                      ;       GOT RIGHT SECTOR, READ CHECKSUM
    1322/ 35.377 :                      
    1323/ 35.377 : 142                          MOV     H,D
    1324/ 36.000 : 315 202 040                  CALL    D.RDB
    1325/ 36.003 : 274                          CMP     H
    1326/ 36.004 : 310                          RZ                      ; ALL OK
    1327/ 36.005 : 056 270                      MVI     L,D.E.HCK#256   ; HEADER CHECKSUM ERROR
    1328/ 36.007 : 046 040              LPS1.5  MVI     H,D.ERR/256     ; (HL) = ERROR BY ADDRESS
    1329/ 36.011 : 315 232 040                  CALL    D.ERRT          ; COUNT ERROR
    1330/ 36.014 :                      
    1331/ 36.014 :                      ;       WRONG SECTOR OR BAD DATA. TRY SOME MORE
    1332/ 36.014 :                      
    1333/ 36.014 : 315 210 040          LPS2    CALL    D.STS           ; SKIP THIS SECTOR
    1334/ 36.017 : 005                          DCR     B
    1335/ 36.020 : 302 334 035                  JNZ     LPS1            ; TRY AGAIN
    1336/ 36.023 : 067                          STC                     ; ENOUGH TRIES
    1337/ 36.024 : 311                          RET                     ; ERROR
    1338/ 36.025 :                      
    1339/ 36.025 : 056 266              LPS3    MVI     L,D.E.HSY#256   ; HEADER SYNC ERROR
    1340/ 36.027 : 303 007 036                  JMP     LPS1.5
    1341/ 36.032 :                      
    1342/ 36.032 : 056 271              LPS4    MVI     L,D.E.VOL#256   ; BAD VOLUME NUMBER
    1343/ 36.034 : 303 007 036                  JMP     LPS1.5
    1344/ 36.037 :                      
    1345/ 36.037 : 056 272              LPS5    MVI     L,D.E.TRK#256   ; BAD TRACK NUMBER
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 41 - 2024-07-31 11:12:52 AM


    1346/ 36.041 : 303 007 036                  JMP     LPS1.5
    1347/ 36.044 :                      
    1348/ 36.044 :                      ;;      RDB - READ BYTE FROM DISK.
    1349/ 36.044 :                      ;
    1350/ 36.044 :                      ;       RDB READS THE NEXT BYTE FROM THE DISK.
    1351/ 36.044 :                      ;
    1352/ 36.044 :                      ;       ENTRY   (D) = CHECKSUM
    1353/ 36.044 :                      ;       EXIT    (A) = BYTE
    1354/ 36.044 :                      ;               (D) UPDATED
    1355/ 36.044 :                      ;       USES    A,F,D,E
    1356/ 36.044 :                      
    1357/ 36.044 :                      
    1358/ 36.044 : 333 175              R.RDB   IN      UP.ST
    1359/ 36.046 : 037                          RAR
    1360/ 36.047 : 322 044 036                  JNC     R.RDB           ; NOT READY YET
    1361/ 36.052 : 333 174                      IN      UP.DP           ; (A) = DATA
    1362/ 36.054 : 137                          MOV     E,A
    1363/ 36.055 : 252                          XRA     D               ; DIFFER
    1364/ 36.056 : 007                          RLC                     ; SHIFT LEFT
    1365/ 36.057 : 127                          MOV     D,A             ; REPLACE
    1366/ 36.060 : 173                          MOV     A,E             ; (A) = CHAR
    1367/ 36.061 : 311                          RET                     ; EXIT
    1368/ 36.062 :                      
    1369/ 36.062 :                      ;;      SDP - SET DEVICE PARAMETERS
    1370/ 36.062 :                      ;
    1371/ 36.062 :                      ;       SDP SET UP ARGUMENTS FOR THE SPECIFIC UNIT
    1372/ 36.062 :                      ;
    1373/ 36.062 :                      ;       D.DVCTL = MOTOR ON, DEVICE SELECT
    1374/ 36.062 :                      ;       D.TRKPT = ADDRESS OF DEVICE TRACK NUMBER
    1375/ 36.062 :                      ;
    1376/ 36.062 :                      ;       ENTRY   AIO.UNI = UNIT NUMBER
    1377/ 36.062 :                      ;       EXIT    (HL) = (D.TRKPT)
    1378/ 36.062 :                      ;       USES    A,F,H,L
    1379/ 36.062 :                      
    1380/ 36.062 :                      
    1381/ 36.062 : 076 012              R.SDP   MVI     A,ERPTCNT
    1382/ 36.064 : 062 264 040                  STA     D.OECNT         ; SET MAX ERROR COUNT FOR OPERATION
    1383/ 36.067 : 072 061 041                  LDA     AIO.UNI
    1384/ 36.072 : 365                          PUSH    PSW             ; SAVE UNIT NUMBER
    1385/ 36.073 : 074                          INR     A               ; (A) = 1 IF DEV 0, 2 IF DEV 1
    1386/ 36.074 : 207                          ADD     A
    1387/ 36.075 : 363                          DI                      ; INTERLOCK CODE INTERRUPTS
    1388/ 36.076 : 041 242 040                  LXI     H,D.DVCTL
    1389/ 36.101 : 256                          XRA     M               ; MERGE WITH DF.WR BIT FROM D.DVCTL
    1390/ 36.102 : 346 177                      ANI     377Q-DF.WR
    1391/ 36.104 : 256                          XRA     M
    1392/ 36.105 : 366 020                      ORI     DF.MO           ; MOTOR ON
    1393/ 36.107 : 167                          MOV     M,A             ; UPDATE
    1394/ 36.110 : 323 177                      OUT     DP.DC           ; SELECT DRIVE, LOAD HEAD
    1395/ 36.112 :                      
    1396/ 36.112 :                      ;       SEE IF HEADS HAVE BEEN UNLOADED LONG ENOUGH TO REQUIRE LOAD DELAY
    1397/ 36.112 :                      
    1398/ 36.112 : 041 244 040                  LXI     H,D.DLYHS
    1399/ 36.115 : 176                          MOV     A,M             ; (A) = FLAG SET BY XIT
    1400/ 36.116 : 247                          ANA     A
    1401/ 36.117 : 066 000                      MVI     M,0             ; ASSUME NO RE-LOAD
    1402/ 36.121 : 302 130 036                  JNZ     SDP1            ; NO RE-LOAD
    1403/ 36.124 : 072 117 040                  LDA     D.SDPA          ; (A) = HEAD SETTLE WAIT TIME/4
    1404/ 36.127 : 167                          MOV     M,A             ; SET FOR CLOCK TIMER
    1405/ 36.130 : 053                  SDP1    DCX     H
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 42 - 2024-07-31 11:12:52 AM


    1406/ 36.131 : 176                          MOV     A,M             ; (A) = MOTOR ON DELAY
    1407/ 36.132 : 066 170                      MVI     M,120           ; 60 SECONDS BEFORE TURN OFF AGAIN
    1408/ 36.134 : 247                          ANA     A               ; 'Z' IF MOTOR TURNED OFF
    1409/ 36.135 : 043                          INX     H               ; (HL) = #D.DLYHS
    1410/ 36.136 : 302 145 036                  JNZ     SDP2            ; MOTOR IS STILL ON
    1411/ 36.141 : 072 120 040                  LDA     D.SDPB          ; (A) = MOTOR WAIT TIME (MS/2)
    1412/ 36.144 : 167                          MOV     M,A
    1413/ 36.145 : 373                  SDP2    EI                      ; RESTORE INTERRUPTS
    1414/ 36.146 : 361                          POP     PSW             ; (A) = UNIT NUMBER
    1415/ 36.147 : 207                          ADD     A               ; (A) = 2*UNIT NUMBER
    1416/ 36.150 : 041 251 040                  LXI     H,D.DRVTB
    1417/ 36.153 : 205                          ADD     L
    1418/ 36.154 : 157                          MOV     L,A             ; (HL) = ADDRESS OF TRACK ENTRY
    1419/ 36.155 : 042 245 040                  SHLD    D.TRKPT
    1420/ 36.160 : 043                          INX     H
    1421/ 36.161 : 042 247 040                  SHLD    D.VOLPT         ; SET VOLUME NUMBER
    1422/ 36.164 : 311                          RET
    1423/ 36.165 :                      
    1424/ 36.165 :                      ;;      STS - SKIP THIS SECTOR.
    1425/ 36.165 :                      ;
    1426/ 36.165 :                      ;       STS IS CALLED TO SKIP THE CURRENT SECTOR, REGARDLESS OF WHERE
    1427/ 36.165 :                      ;       THE HEAD IS POSITIONED.
    1428/ 36.165 :                      ;
    1429/ 36.165 :                      ;       STS WILL EXIT AT THE BEGINNING OF THE NEXT SECTOR.
    1430/ 36.165 :                      ;
    1431/ 36.165 :                      ;       1. IF THE HEAD IS NOT OVER A HOLE, WAIT 8 MS WHILE
    1432/ 36.165 :                      ;          HOLE CHECKING. IF NO HOLE IN THIS TIME, WHEN WE ARE IN
    1433/ 36.165 :                      ;          A REGULAR GAP, WAIT FOR THE NEXT HOLE AND EXIT.
    1434/ 36.165 :                      ;
    1435/ 36.165 :                      ;       2. IF THE HEAD IS OVER A HOLE, OR BECOMES SO DURING THE 8 MS
    1436/ 36.165 :                      ;          WAIT, THEN WAIT FOR THE HOLE TO PASS, WAIT 12 MILLISECONDS
    1437/ 36.165 :                      ;          IN CASE OF THE INDEX HOLE, THEN WAIT FOR THE NEXT HOLE AND EXIT.
    1438/ 36.165 :                      ;
    1439/ 36.165 :                      ;       ENTRY   NONE
    1440/ 36.165 :                      ;       EXIT    INTERRUPTS DISABLED
    1441/ 36.165 :                      ;       USES    A,F,H,L
    1442/ 36.165 :                      
    1443/ 36.165 :                      
    1444/ 36.165 : 373                  R.STS   EI
    1445/ 36.166 : 305                          PUSH    B               ; SAVE (BC)
    1446/ 36.167 : 333 177                      IN      DP.DC
    1447/ 36.171 : 037                          RAR
    1448/ 36.172 : 332 222 036                  JC      STS2            ; AM CURRENTLY OVER HOLE
    1449/ 36.175 :                      
    1450/ 36.175 :                      ;       NO HOLE YET, WAIT 8 MS MIN (10 MAX) FOR HOLE TO
    1451/ 36.175 :                      ;       APPEAR
    1452/ 36.175 :                      
    1453/ 36.175 : 041 033 040                  LXI     H,TICCNT
    1454/ 36.200 : 106                          MOV     B,M             ; (B) = CURRENT TIME
    1455/ 36.201 : 333 177              STS1    IN      DP.DC
    1456/ 36.203 : 037                          RAR
    1457/ 36.204 : 332 222 036                  JC      STS2            ; GOT HOLE
    1458/ 36.207 : 072 121 040                  LDA     D.STSA          ; (A) = DELAY COUNT
    1459/ 36.212 : 200                          ADD     B               ; 10 MS MAX, 8 MS MIN
    1460/ 36.213 : 276                          CMP     M
    1461/ 36.214 : 302 201 036                  JNZ     STS1            ; 8 MS NOT UP YET
    1462/ 36.217 : 303 233 036                  JMP     STS3            ; AM IN SECTOR GAP
    1463/ 36.222 :                      
    1464/ 36.222 :                      ;       HAVE HOLE, SKIP IT AND WAIT 12 MS
    1465/ 36.222 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 43 - 2024-07-31 11:12:52 AM


    1466/ 36.222 : 315 271 036          STS2    CALL    WNH             ; WAIT FOR NO HOLE
    1467/ 36.225 : 072 122 040                  LDA     D.STSB          ; (A) = COUNT (10 MS MIN, 12 M MAX)
    1468/ 36.230 : 315 235 040                  CALL    D.DLY           ; WAIT
    1469/ 36.233 : 301                  STS3    POP     B               ; RESTORE (BC)
    1470/ 36.234 : 363                          DI
    1471/ 36.235 :                      ;       JMP     WHD             ; WAIT HOLE DETECT
    1472/ 36.235 :                      
    1473/ 36.235 :                      ;;      WHD - WAIT HOLE DETECT.
    1474/ 36.235 :                      ;
    1475/ 36.235 :                      ;       WHD WAITS UNTIL A HOLE IS LOCATED.
    1476/ 36.235 :                      ;
    1477/ 36.235 :                      ;       ENTRY   NONE
    1478/ 36.235 :                      ;       EXIT    NONE
    1479/ 36.235 :                      ;       USES    A,F
    1480/ 36.235 :                      
    1481/ 36.235 :                      
    1482/ 36.235 : 333 177              WHD     IN      DP.DC
    1483/ 36.237 : 037                          RAR
    1484/ 36.240 : 322 235 036                  JNC     WHD             ; WAIT UNTIL FOUND
    1485/ 36.243 : 072 123 040                  LDA     D.WHDA          ; (A) = LOOP DELAY COUNT
    1486/ 36.246 : 303 216 040                  JMP     D.UDLY
    1487/ 36.251 :                      
    1488/ 36.251 :                      ;;      STZ - SEEK TRACK ZERO.
    1489/ 36.251 :                      ;
    1490/ 36.251 :                      ;       STZ SEEKS THE SELECTED UNIT ARM OUTWARDS UNTIL IT REACHES
    1491/ 36.251 :                      ;       TRACK ZERO.
    1492/ 36.251 :                      ;
    1493/ 36.251 :                      ;       THE ARM POSITION BYTE IS THEN UPDATED TO 0.
    1494/ 36.251 :                      ;
    1495/ 36.251 :                      ;       ENTRY   INTERRUPTS ENABLED
    1496/ 36.251 :                      ;       EXIT    INTERRUPTS ENABLED
    1497/ 36.251 :                      ;       USES    A,F,H,L
    1498/ 36.251 :                      
    1499/ 36.251 :                      
    1500/ 36.251 : 315 174 040          STZ0    CALL    D.MAO           ; MOVE ARM OUT
    1501/ 36.254 :                      
    1502/ 36.254 : 333 177              R.STZ   IN      DP.DC
    1503/ 36.256 : 346 002                      ANI     DF.T0
    1504/ 36.260 : 312 251 036                  JZ      STZ0            ; NOT TRACK 0 YET
    1505/ 36.263 : 052 245 040                  LHLD    D.TRKPT
    1506/ 36.266 : 066 000                      MVI     M,0             ; SET TRACK POINTER
    1507/ 36.270 : 311                          RET
    1508/ 36.271 :                      
    1509/ 36.271 :                      ;;      WNH - WAIT FOR NO HOLE.
    1510/ 36.271 :                      ;
    1511/ 36.271 :                      ;       WNH WAITS UNTIL THE CURRENT HOLE IS PAST.
    1512/ 36.271 :                      ;
    1513/ 36.271 :                      ;       ENTRY   NONE
    1514/ 36.271 :                      ;       EXIT    NONE
    1515/ 36.271 :                      ;       USES    A,F
    1516/ 36.271 :                      
    1517/ 36.271 :                      
    1518/ 36.271 : 333 177              WNH     IN      DP.DC
    1519/ 36.273 : 037                          RAR
    1520/ 36.274 : 332 271 036                  JC      WNH             ; STILL HOLE
    1521/ 36.277 : 072 124 040                  LDA     D.WNHA          ; (A) = DEBOUNCE COUNT
    1522/ 36.302 :                      ;       JMP     D.UDLY          ; WAIT A LITTLE
    1523/ 36.302 :                      
    1524/ 36.302 :                      ;;      UDLY - MICROSECOND DELAY
    1525/ 36.302 :                      ;
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 44 - 2024-07-31 11:12:52 AM


    1526/ 36.302 :                      ;       UDLY IS CALLED (WITH INTERRUPTS DISABLED)
    1527/ 36.302 :                      ;       TO WAIT FOR A CERTAIN NUMBER OF MICROSECONDS.
    1528/ 36.302 :                      ;
    1529/ 36.302 :                      ;       EACH TIME THROUGH THE DELAY LOOP CAUSES A PAUSE OF 15/2.048
    1530/ 36.302 :                      ;       MICROSECONDS.
    1531/ 36.302 :                      ;
    1532/ 36.302 :                      ;       ENTRY   (A) = LOOP COUNT (ZERO TAKEN AS 256)
    1533/ 36.302 :                      ;       EXIT    (A) = 0
    1534/ 36.302 :                      ;       USES    A,F
    1535/ 36.302 :                      
    1536/ 36.302 :                      
    1537/ 36.302 : 075                  R.UDLY  DCR     A
    1538/ 36.303 : 302 302 036                  JNZ     R.UDLY
    1539/ 36.306 : 311                          RET
    1540/ 36.307 :                      
    1541/ 36.307 :                      
    1542/ 36.307 :                      ;;      WSC - WAIT SYNC CHARACTER.
    1543/ 36.307 :                      ;
    1544/ 36.307 :                      ;       WSC WAITS FOR THE APPEARANCE OF A SYNC CHARACTER. THE DISK SHOULD BE
    1545/ 36.307 :                      ;       SELECTED, MOVING, AND THE HEAD SHOULD BE OVER THE PRE-SYNC
    1546/ 36.307 :                      ;       ZERO BAND.
    1547/ 36.307 :                      ;
    1548/ 36.307 :                      ;       IF A SYNC IS NOT DETECTED IN 25 CHARACTER TIMES, AN ERROR IS RETURNED.
    1549/ 36.307 :                      ;
    1550/ 36.307 :                      ;       ENTRY   NONE
    1551/ 36.307 :                      ;       EXIT    'C' CLEAR IF OK, SYNC CHARACTER READ
    1552/ 36.307 :                      ;                (D) = 0 (CHECKSUM)
    1553/ 36.307 :                      ;               'C' SET OF NO SYNC FOUND
    1554/ 36.307 :                      ;       USES    A,F,D
    1555/ 36.307 :                      
    1556/ 36.307 :                      
    1557/ 36.307 : 076 375              R.WSC   MVI     A,C.DSYN
    1558/ 36.311 : 323 176                      OUT     UP.SC           ; SET SYNC CHARACTER
    1559/ 36.313 : 333 176                      IN      UP.SC           ; RESET SYNC SEARCH
    1560/ 36.315 : 072 125 040                  LDA     D.WSCA          ; (A) = NUMBER OF LOOPS IN 25 CHARACTERS
    1561/ 36.320 : 127                          MOV     D,A
    1562/ 36.321 : 333 177              WSC1    IN      DP.DC
    1563/ 36.323 : 346 010                      ANI     DF.SD           ; SEE IF SYNC
    1564/ 36.325 : 302 336 036                  JNZ     WSC2            ; GOT SYNC
    1565/ 36.330 : 025                          DCR     D
    1566/ 36.331 : 302 321 036                  JNZ     WSC1            ; TRY SOME MORE
    1567/ 36.334 :                      
    1568/ 36.334 :                      ;       COULDN'T FIND SYNC
    1569/ 36.334 :                      
    1570/ 36.334 : 067                          STC                     ; CAN'T FIND IT
    1571/ 36.335 : 311                          RET
    1572/ 36.336 :                      
    1573/ 36.336 :                      ;       FOUND IT
    1574/ 36.336 :                      
    1575/ 36.336 : 333 174              WSC2    IN      UP.DP           ; GOBBLE SYNC CHARACTER
    1576/ 36.340 : 026 000                      MVI     D,0             ; CLEAR CHECKSUM
    1577/ 36.342 : 311                          RET
    1578/ 36.343 :                      
    1579/ 36.343 :                      ;;      WSP - WRITE SYNC PATTERN.
    1580/ 36.343 :                      ;
    1581/ 36.343 :                      ;       WSP WRITES A SYNC PATTERN OF ZEROS, FOLLOWED BY A SYNC
    1582/ 36.343 :                      ;       CHARACTER.
    1583/ 36.343 :                      ;
    1584/ 36.343 :                      ;       ENTRY   (A) = INITIAL DELAY COUNTER
    1585/ 36.343 :                      ;               (C) = # OF ZERO BYTES TO WRITE
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 45 - 2024-07-31 11:12:52 AM


    1586/ 36.343 :                      ;       EXIT    (D) = CHECKSUM
    1587/ 36.343 :                      ;               (C) = 0
    1588/ 36.343 :                      ;       USES    A,F,C,D,E
    1589/ 36.343 :                      
    1590/ 36.343 :                      
    1591/ 36.343 : 075                  R.WSP   DCR     A
    1592/ 36.344 : 302 343 036                  JNZ     R.WSP           ; DELAY
    1593/ 36.347 :                      
    1594/ 36.347 :                      ;       DELAY IS UP, ON WRITE GATE
    1595/ 36.347 :                      
    1596/ 36.347 : 072 242 040                  LDA     D.DVCTL
    1597/ 36.352 : 074                          INR     A               ; SET WRITE GATE
    1598/ 36.353 : 323 177                      OUT     DP.DC           ; SET GATE
    1599/ 36.355 :                      
    1600/ 36.355 :                      ;       USED AS ENTRY POINT BY DDIAG ...
    1601/ 36.355 :                      
    1602/ 36.355 : 257                  WSP1    XRA     A
    1603/ 36.356 : 315 227 040                  CALL    D.WNB
    1604/ 36.361 : 015                          DCR     C
    1605/ 36.362 : 302 355 036                  JNZ     WSP1            ; DO MORE
    1606/ 36.365 : 076 375                      MVI     A,C.DSYN
    1607/ 36.367 : 127                          MOV     D,A             ; PRE-CLEAR CHECKSUM SO WNB EXITS WITH (D) = 0
    1608/ 36.370 : 303 227 040                  JMP     D.WNB           ; WRITE NEXT BYTE
    1609/ 36.373 :                      
    1610/ 36.373 :                      ;;      WNB - WRITE NEXT BYTE.
    1611/ 36.373 :                      ;
    1612/ 36.373 :                      ;       WNB WRITE A BYTE TO THE DISK, ASSUMING THAT THE WRITE GATE
    1613/ 36.373 :                      ;       IS ALREADY SELECTED.
    1614/ 36.373 :                      ;
    1615/ 36.373 :                      ;       ENTRY   (A) = CHARACTER
    1616/ 36.373 :                      ;               (D) = CHECKSUM
    1617/ 36.373 :                      ;       EXIT    (D) = CHECKSUM
    1618/ 36.373 :                      ;       USES    A,F,D,E
    1619/ 36.373 :                      
    1620/ 36.373 :                      
    1621/ 36.373 : 137                  R.WNB   MOV     E,A
    1622/ 36.374 : 333 175              WNB1    IN      UP.ST
    1623/ 36.376 : 247                          ANA     A
    1624/ 36.377 : 362 374 036                  JP      WNB1            ; NOT READY
    1625/ 37.002 : 173                          MOV     A,E
    1626/ 37.003 : 323 174                      OUT     UP.DP           ; OUT DATA
    1627/ 37.005 : 252                          XRA     D
    1628/ 37.006 : 007                          RLC
    1629/ 37.007 : 127                          MOV     D,A
    1630/ 37.010 : 311                          RET
    1631/ 37.011 :                      
    1632/ 37.011 : 107 053 123                  DB      'G+S'
    1633/ 37.014 :                      
    1634/ 37.014 :                      ;;      BOOT CODE.
    1635/ 37.014 :                      ;
    1636/ 37.014 :                      ;       ENTERED TO BOOT DISK SYSTEM.
    1637/ 37.014 :                      
    1638/ 37.014 : 363                  BOOT    DI                      ; WANT NO TROUBLES WITH INTERRUPTS !
    1639/ 37.015 : 061 200 042                  LXI     SP,STACK        ; CLEAR STACK
    1640/ 37.020 : 001 130 000                  LXI     B,BOOTAL
    1641/ 37.023 : 021 132 037                  LXI     D,BOOTA
    1642/ 37.026 : 041 110 040                  LXI     H,D.CON
    1643/ 37.031 : 315 252 030                  CALL    DMOVE           ; MOVE IN CONSTANTS AND VECTORS
    1644/ 37.034 :                      
    1645/ 37.034 :                      ;       ZERO WORK FIELD
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 46 - 2024-07-31 11:12:52 AM


    1646/ 37.034 :                      
    1647/ 37.034 : 041 240 040                  LXI     H,D.RAM
    1648/ 37.037 : 006 037                      MVI     B,D.RAML
    1649/ 37.041 : 315 212 031                  CALL    DZERO           ; ZERO MEMORY
    1650/ 37.044 : 062 061 041                  STA     AIO.UNI
    1651/ 37.047 : 323 177                      OUT     DP.DC           ; OFF DISK
    1652/ 37.051 :                      
    1653/ 37.051 :                      ;       SETUP ALL INTERRUPT VECTORS TO AN EI/RET SEQUENCE
    1654/ 37.051 :                      
    1655/ 37.051 : 074                          INR     A               ; (A) = UO.CLK
    1656/ 37.052 : 062 010 040                  STA     MFLAG           ; REQUEST CLOCK INTERRUPTS (*DI* STILL IN EFFECT NOW!)
    1657/ 37.055 :                      
    1658/ 37.055 : 041 037 040                  LXI     H,UIVEC         ; (HL) = UIVEC ADDRESS, (A) = 1
    1659/ 37.060 : 066 303              BOOT2   MVI     M,303Q
    1660/ 37.062 : 043                          INX     H
    1661/ 37.063 : 066 027                      MVI     M,EIXIT#256
    1662/ 37.065 : 043                          INX     H
    1663/ 37.066 : 066 034                      MVI     M,EIXIT/256
    1664/ 37.070 : 043                          INX     H
    1665/ 37.071 : 207                          ADD     A               ; SHIFT '1' IN (A) LEFT 1
    1666/ 37.072 : 362 060 037                  JP      BOOT2
    1667/ 37.075 :                      
    1668/ 37.075 :                      ;       SETUP CLOCK INTERRUPTS
    1669/ 37.075 :                      
    1670/ 37.075 : 041 031 034          BOOT3   LXI     H,CLOCK
    1671/ 37.100 : 042 040 040                  SHLD    UIVEC+1
    1672/ 37.103 : 373                          EI                      ; RESTORE INTERRUPTS
    1673/ 37.104 :                      
    1674/ 37.104 :                      ;       READ BOOT CODE
    1675/ 37.104 :                      
    1676/ 37.104 : 315 366 033                  CALL    R.ABORT         ; RESET DISK 0
    1677/ 37.107 : 021 200 042                  LXI     D,USERFWA
    1678/ 37.112 : 001 000 011                  LXI     B,9*256
    1679/ 37.115 : 041 000 000                  LXI     H,0
    1680/ 37.120 : 315 077 034                  CALL    R.READ          ; READ SYSTEM DISK BOOT CODE
    1681/ 37.123 : 322 200 042                  JNC     USERFWA         ; IS ALL OK
    1682/ 37.126 :                      
    1683/ 37.126 :                      ;       WAIT FOR HIM TO HIT A CHARACTER
    1684/ 37.126 :                      
    1685/ 37.126 : 166                          HLT
    1686/ 37.127 : 303 014 037                  JMP     BOOT            ; BOOT AGAIN
    1687/ 37.132 :                      
    1688/ 37.132 :                      
    1689/ 37.132 :                      ;;      DISK CONSTANT AND VECTOR INITIALIZATION TABLE.
    1690/ 37.132 :                      
    1691/ 37.132 : =37.132O             BOOTA   EQU     $
    1692/ 37.132 :                      
    1693/ 37.132 : 170 002                      DW      2*256+120       ; HEAD UNSETTLE AND MOTOR ON TIMES
    1694/ 37.134 : 024                          DB      20              ; GUARDBAND COUNT FOR WRITE
    1695/ 37.135 : 012                          DB      10              ; NUMBER OF ZERO CHARACTERS AFTER HOLE EDGE
    1696/ 37.136 : 020                          DB      128/8           ; TWO CHARACTER DELAY BEFORE WRITING
    1697/ 37.137 : 017                          DB      15              ; TRACK-TO-TRACK STEP TIMES
    1698/ 37.140 : 024                          DB      20              ; NUMBER OF TRIES FOR CORRECT SECTOR
    1699/ 37.141 : 021                          DB      70/4            ; 70 MILLISECONDS WAIT FOR HEAD SETTLE
    1700/ 37.142 : 372                          DB      1000/4          ; 1 SECOND WAIT FOR MOTOR ON
    1701/ 37.143 : 005                          DB      8/2+1           ; MS/2 TO WAIT FOR INDEX HOLE
    1702/ 37.144 : 007                          DB      12/2+1          ; MS/2 TO WAIT PAST INDEX HOLE
    1703/ 37.145 : 024                          DB      20              ; UDLY COUNT FOR HOLE DEBOUNCE
    1704/ 37.146 : 024                          DB      20              ; UDLY COUNT FOR HOLE DEBOUNCE
    1705/ 37.147 : 120                          DB      64*25/20        ; LOOP COUNT FOR 25 CHARACTERS
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 47 - 2024-07-31 11:12:52 AM


    1706/ 37.150 :                      
    1707/ 37.150 :                      ;;      ERRT - ERROR TEST LOOP
    1708/ 37.150 :                      
    1709/ 37.150 : 064                  R.ERRT  INR     M               ; COUNT ERROR
    1710/ 37.151 : 311                          RET                     ; EXIT
    1711/ 37.152 :                      
    1712/ 37.152 :                      ;       JMP VECTORS
    1713/ 37.152 :                      
    1714/ 37.152 : 303 316 033                  JMP     R.SYDD          ; D.SYDD (MUST BE FIRST)
    1715/ 37.155 : 303 345 033                  JMP     R.MOUNT         ; D.MOUNT
    1716/ 37.160 : 303 374 033                  JMP     R.XOK           ; D.XOK
    1717/ 37.163 : 303 366 033                  JMP     R.ABORT         ; D.ABORT
    1718/ 37.166 : 303 375 033                  JMP     R.XIT           ; D.XIT
    1719/ 37.171 : 303 077 034                  JMP     R.READ          ; D.READ
    1720/ 37.174 : 303 321 034                  JMP     R.READR         ; D.READR
    1721/ 37.177 : 303 336 034                  JMP     R.WRITE         ; D.WRITE
    1722/ 37.202 : 303 136 035                  JMP     R.CDE           ; D.CDE
    1723/ 37.205 : 303 172 035                  JMP     R.DTS           ; D.DTS
    1724/ 37.210 : 303 225 035                  JMP     R.SDT           ; D.SDT
    1725/ 37.213 : 303 251 035                  JMP     R.MAI           ; D.MAI
    1726/ 37.216 : 303 254 035                  JMP     R.MAO           ; D.MAO
    1727/ 37.221 : 303 321 035                  JMP     R.LPS           ; D.LPS
    1728/ 37.224 : 303 044 036                  JMP     R.RDB           ; D.RDB
    1729/ 37.227 : 303 062 036                  JMP     R.SDP           ; D.SDP
    1730/ 37.232 : 303 165 036                  JMP     R.STS           ; D.STS
    1731/ 37.235 : 303 254 036                  JMP     R.STZ           ; D.STZ
    1732/ 37.240 : 303 302 036                  JMP     R.UDLY          ; D.UDLY
    1733/ 37.243 : 303 307 036                  JMP     R.WSC           ; D.WSC
    1734/ 37.246 : 303 343 036                  JMP     R.WSP           ; D.WSP
    1735/ 37.251 : 303 373 036                  JMP     R.WNB           ; D.WNB
    1736/ 37.254 : 303 150 037                  JMP     R.ERRT          ; D.ERRT
    1737/ 37.257 : 303 303 035                  JMP     R.DLY           ; D.DLY
    1738/ 37.262 : =130O                BOOTAL  EQU     $-BOOTA
    1739/ 37.262 :                      
    1740/ 37.262 :                      ; The remaining code was reverse engineered from the Heathkit ROM.
    1741/ 37.262 :                      
    1742/ 37.262 : 076 031                      MVI     A,31Q
    1743/ 37.264 : 323 177                      OUT     DP.DC
    1744/ 37.266 : 016 372                      MVI     C,372Q
    1745/ 37.270 : 171                          MOV     A,C
    1746/ 37.271 : 315 303 035                  CALL    R.DLY
    1747/ 37.274 : 171                          MOV     A,C
    1748/ 37.275 : 315 303 035                  CALL    R.DLY
    1749/ 37.300 : 363                          DI
    1750/ 37.301 : 315 306 037                  CALL    L1
    1751/ 37.304 : 373                          EI
    1752/ 37.305 : 166                          HLT
    1753/ 37.306 : 315 355 036          L1      CALL    WSP1
    1754/ 37.311 : 001 134 014                  LXI     B,6134Q
    1755/ 37.314 : 076 107              L2      MVI     A,107Q
    1756/ 37.316 : 315 373 036                  CALL    R.WNB
    1757/ 37.321 : 013                          DCX     B
    1758/ 37.322 : 170                          MOV     A,B
    1759/ 37.323 : 261                          ORA     C
    1760/ 37.324 : 302 314 037                  JNZ     L2
    1761/ 37.327 : 076 030                      MVI     A,30Q
    1762/ 37.331 : 323 177                      OUT     DP.DC
    1763/ 37.333 : 076 333                      MVI     A,333Q
    1764/ 37.335 : 062 125 040                  STA     D.WSCA
    1765/ 37.340 : 315 307 036                  CALL    R.WSC
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 48 - 2024-07-31 11:12:52 AM


    1766/ 37.343 : 330                          RC
    1767/ 37.344 : 001 132 014                  LXI     B,6132Q
    1768/ 37.347 : 315 044 036          L3      CALL    R.RDB
    1769/ 37.352 : 376 107                      CPI     107Q
    1770/ 37.354 : 300                          RNZ
    1771/ 37.355 : 013                          DCX     B
    1772/ 37.356 : 170                          MOV     A,B
    1773/ 37.357 : 261                          ORA     C
    1774/ 37.360 : 302 347 037                  JNZ     L3
    1775/ 37.363 : 373                          EI
    1776/ 37.364 : 166                          HLT
    1777/ 37.365 : 000                          NOP
    1778/ 37.366 :                      
    1779/ 37.366 : 112 107 114 000              DB      "JGL", 0        ; INITIALS OF J.G. LETWIN
    1780/ 37.372 : 110 105 101 124 110          DB      "HEATH", 0
          37.377 : 000                
    1781/ 40.000 :                      
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 49 - 2024-07-31 11:12:52 AM


  Symbol Table (* = unused):
  --------------------------

 AIO.CGN :                   41.047 C | *AIO.CHA :                   41.116 C |
 AIO.CNT :                   41.111 C |  AIO.CSI :                   41.050 C |
*AIO.DDA :                   41.041 - | *AIO.DES :                   41.055 C |
*AIO.DEV :                   41.057 C |  AIO.DIR :                   41.062 C |
*AIO.DTA :                   41.053 C |  AIO.EOF :                   41.113 C |
*AIO.EOM :                   41.112 C | *AIO.FLG :                   41.043 C |
 AIO.GRT :                   41.044 C |  AIO.LGN :                   41.051 C |
*AIO.LSI :                   41.052 C |  AIO.SPG :                   41.046 C |
 AIO.TFP :                   41.114 C |  AIO.UNI :                   41.061 C |
*AIO.VEC :                   41.040 C |
*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BELL :                           7 - |  BOOT :                      37.014 C |
 BOOT2 :                     37.060 C | *BOOT3 :                     37.075 C |
 BOOTA :                     37.132 - |  BOOTAL :                       130 - |
 C.DSYN :                       375 - | *CASESENSITIVE :                  0 - |
*CDB.H84 :                        1 - | *CDB.H85 :                        0 - |
*CFF :                       31.354 C |  CLOCK :                     34.031 C |
 CLOCK1 :                    34.070 C | *CO.FLG :                         1 - |
*CONSTPI :        3.141592653589793 - | *CR :                            15 - |
*CS.FLG :                       200 - | *CSL.CHR :                        1 - |
*CSL.ECH :                      200 - | *CSL.WRP :                        2 - |
*CTP.2SB :                       10 - | *CTP.BKM :                        2 - |
*CTP.BKS :                      200 - | *CTP.MLI :                       40 - |
*CTP.MLO :                       20 - | *CTP.TAB :                        1 - |
 D.ABORT :                   40.141 C |  D.CDE :                     40.160 C |
 D.CON :                     40.110 C |  D.DLY :                     40.235 C |
 D.DLYHS :                   40.244 C |  D.DLYMO :                   40.243 C |
 D.DRVTB :                   40.251 C |  D.DTS :                     40.163 C |
 D.DVCTL :                   40.242 C |  D.E.CHK :                   40.267 C |
 D.E.HCK :                   40.270 C |  D.E.HSY :                   40.266 C |
 D.E.MDS :                   40.265 C |  D.E.TRK :                   40.272 C |
 D.E.VOL :                   40.271 C |  D.ERR :                     40.265 C |
*D.ERRL :                    40.273 C |  D.ERRT :                    40.232 C |
*D.ERTS :                    40.126 C | *D.HECNT :                   40.261 C |
 D.LPS :                     40.177 C |  D.LPSA :                    40.116 C |
 D.MAI :                     40.171 C |  D.MAIA :                    40.115 C |
 D.MAO :                     40.174 C |  D.MOUNT :                   40.133 C |
 D.OECNT :                   40.264 C |  D.OPR :                     40.273 C |
 D.OPW :                     40.275 C |  D.RAM :                     40.240 C |
 D.RAML :                        37 - |  D.RDB :                     40.202 C |
 D.READ :                    40.147 C |  D.READR :                   40.152 C |
 D.SDP :                     40.205 C |  D.SDPA :                    40.117 C |
 D.SDPB :                    40.120 C |  D.SDT :                     40.166 C |
 D.SECNT :                   40.262 C |  D.STS :                     40.210 C |
 D.STSA :                    40.121 C |  D.STSB :                    40.122 C |
 D.STZ :                     40.213 C | *D.SYDD :                    40.130 C |
 D.TRKPT :                   40.245 C |  D.TS :                      40.241 C |
 D.TT :                      40.240 C |  D.UDLY :                    40.216 C |
 D.VEC :                     40.130 C |  D.VOLPT :                   40.247 C |
 D.WHDA :                    40.123 C |  D.WNB :                     40.227 C |
 D.WNHA :                    40.124 C |  D.WRITA :                   40.112 C |
 D.WRITB :                   40.113 C |  D.WRITC :                   40.114 C |
 D.WRITE :                   40.155 C |  D.WSC :                     40.221 C |
 D.WSCA :                    40.125 C |  D.WSP :                     40.224 C |
 D.XIT :                     40.144 C |  D.XITA :                    40.110 C |
 D.XOK :                     40.136 C | *DATE :                "2024-07-31" - |
 DC.ABT :                         7 C | *DC.CLU :                         6 C |
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 50 - 2024-07-31 11:12:52 AM


*DC.MOV :                        10 C | *DC.OPR :                         3 C |
*DC.OPU :                         5 C | *DC.OPW :                         4 C |
*DC.REA :                         0 C | *DC.RER :                         2 C |
 DC.WRI :                         1 C | *DCA :                       32.002 C |
 DCA1 :                      31.377 C |  DCA2 :                      32.035 C |
 DCA3 :                      32.055 C |  DCA4 :                      32.071 C |
 DCDEHL :                    30.216 C |  DCHL :                      30.224 C |
 DCOMP :                     30.060 C |  DDADA :                     30.072 C |
 DDADA. :                    30.101 C |  DDU66 :                     30.106 C |
*DEV.DDA :                        4 C | *DEV.DIR :                       16 C |
*DEV.DVG :                       15 C | *DEV.DVL :                       13 C |
*DEV.FLG :                        6 C | *DEV.GRT :                        7 C |
*DEV.GTS :                       20 C | *DEV.JMP :                        3 C |
*DEV.MNU :                       12 C | *DEV.MUM :                       12 C |
*DEV.NAM :                        0 C | *DEV.RES :                        2 C |
*DEV.SPG :                       11 C | *DF.CLR :                       376 - |
 DF.DI :                         40 - | *DF.DS0 :                         2 - |
*DF.DS1 :                         4 - | *DF.DS2 :                        10 - |
*DF.EMP :                       377 - | *DF.HD :                          1 - |
 DF.MO :                         20 - |  DF.SD :                         10 - |
 DF.ST :                        100 - |  DF.T0 :                          2 - |
 DF.WP :                          4 - | *DF.WQ :                          1 - |
 DF.WR :                        200 - | *DHLIHL :                    30.211 C |
*DINDL :                     30.234 C | *DIR.ALD :                       25 C |
 DIR.CLU :                       15 C | *DIR.CRD :                       23 C |
*DIR.EXT :                       10 C | *DIR.FGN :                       20 C |
*DIR.FLG :                       16 C | *DIR.LGN :                       21 C |
*DIR.LSI :                       22 C | *DIR.NAM :                        0 C |
*DIR.PRO :                       13 C | *DIR.VER :                       14 C |
 DIRELEN :                       27 - | *DIRIDL :                        15 - |
 DLY1 :                      35.310 C |  DMOVE :                     30.252 - |
*DMU10 :                     30.324 C | *DMU66 :                     30.337 C |
*DMU86 :                     31.007 C |  DP.DC :                        177 - |
 DR.IM :                          1 - | *DR.PRG :                         2 - |
*DREAD :                     31.256 C |  DRSTALL :                   31.047 C |
 DSAVALL :                   31.054 C | *DT.CR :                          2 - |
*DT.CW :                          4 - | *DT.DD :                          1 - |
 DTBL1 :                     31.113 C |  DTBL2 :                     31.133 C |
*DTBLS :                     31.111 C | *DTBRA :                     31.076 - |
*DTJMP :                     31.061 C | *DTJMP. :                    31.062 - |
 DTS1 :                      35.177 C | *DTYPTX :                    31.136 C |
 DTYPTX. :                   31.144 C |  DU661 :                     30.123 C |
 DU662 :                     30.143 C |  DU663 :                     30.150 C |
 DU664 :                     30.163 C |  DU665 :                     30.205 C |
*DUDD :                      31.157 - |  DWDR1 :                     31.231 C |
*DWER :                      31.241 C | *DWRD :                      31.222 C |
*DWRITE :                    31.253 C |  DZERO :                     31.212 C |
*EC.CNA :                         4 C | *EC.DDA :                        27 C |
*EC.DIF :                        17 C | *EC.DIW :                        35 C |
*EC.DNS :                         5 C |  EC.EOF :                         1 C |
*EC.EOM :                         2 C | *EC.FAO :                        31 C |
*EC.FAP :                        26 C | *EC.FL :                         30 C |
*EC.FNF :                        14 C |  EC.FNO :                        11 C |
*EC.FNR :                        34 C | *EC.FUC :                        13 C |
*EC.ICN :                        16 C | *EC.IDN :                         6 C |
*EC.IFC :                        20 C | *EC.IFN :                         7 C |
*EC.ILC :                         3 C | *EC.ILO :                        40 C |
 EC.ILR :                        12 C | *EC.ILV :                        37 C |
*EC.IS :                         32 C | *EC.NEM :                        21 C |
*EC.NRD :                        10 C |  EC.RF :                         22 C |
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 51 - 2024-07-31 11:12:52 AM


*EC.UNA :                        36 C | *EC.UND :                        15 C |
*EC.UUN :                        33 C |  EC.WF :                         23 C |
 EC.WP :                         25 C | *EC.WPV :                        24 C |
 EIXIT :                     34.027 C |  ERPTCNT :                       12 - |
*ERR.FNO :                   31.344 C | *ERR.ILR :                   31.350 C |
*FALSE :                          0 - | *FFB :                       32.133 C |
 FFB4 :                      32.145 C |  FFB5 :                      32.161 C |
 FFB6 :                      32.165 C |  FFL :                       32.205 C |
*HAS64 :                          1 - | *I.CONFL :                        4 - |
*I.CONTY :                        1 - | *I.CONWI :                        3 - |
*I.CSLMD :                        0 - | *I.CUSOR :                        2 - |
 L1 :                        37.306 C |  L2 :                        37.314 C |
 L3 :                        37.347 C | *LDD :                       32.223 C |
 LDD2 :                      32.252 C |  LDD3 :                      32.271 C |
 LDD4 :                      32.323 C |  LDD8 :                      32.362 C |
*LDO :                       33.012 C |  LDO1 :                      33.073 C |
*LF :                            12 - | *LISTON :                         1 - |
 LPS0 :                      35.316 C |  LPS1 :                      35.334 C |
 LPS1.5 :                    36.007 C |  LPS2 :                      36.014 C |
 LPS3 :                      36.025 C |  LPS4 :                      36.032 C |
 LPS5 :                      36.037 C | *MACEXP :                         7 - |
 MEM1 :                      30.017 C |  MEM2 :                      30.032 C |
 MEM3 :                      30.036 C |  MEM4 :                      30.046 C |
 MFLAG :                     40.010 - |  MI.CPI :                       376 - |
*MOMCPU :                   200.200 - | *MOMCPUNAME :                "8080" - |
 MOV1 :                      30.272 C |  MOV2 :                      30.311 C |
 MU661 :                     30.344 C |  MU662 :                     30.364 C |
 MU663 :                     31.005 C |  MU860 :                     31.014 C |
 MU861 :                     31.015 C |  MU862 :                     31.026 C |
 MU863 :                     31.044 C | *NESTMAX :                    1.000 - |
 OVL.IN :                         1 - | *OVL.RES :                        2 - |
 OVL.UCS :                      200 - |  PCHL :                      32.361 C |
*PDI :                       33.145 C |  PDI1 :                      33.161 C |
 PIC.COD :                        6 C | *PIC.ID :                         0 C |
*PIC.LEN :                        2 C | *PIC.PTR :                        4 C |
 R.ABORT :                   33.366 - |  R.CDE :                     35.136 C |
 R.DLY :                     35.303 C |  R.DTS :                     35.172 C |
 R.ERRT :                    37.150 C |  R.LPS :                     35.321 C |
 R.MAI :                     35.251 C |  R.MAO :                     35.254 C |
 R.MOUNT :                   33.345 - |  R.RDB :                     36.044 C |
 R.READ :                    34.077 C |  R.READR :                   34.321 C |
 R.SDP :                     36.062 C |  R.SDT :                     35.225 C |
 R.STS :                     36.165 C |  R.STZ :                     36.254 C |
 R.SYDD :                    33.316 - |  R.UDLY :                    36.302 C |
 R.WNB :                     36.373 C |  R.WRITE :                   34.336 - |
 R.WSC :                     36.307 C |  R.WSP :                     36.343 C |
 R.XIT :                     33.375 C |  R.XOK :                     33.374 C |
 READ1 :                     34.112 C |  READ1.5 :                   34.122 C |
 READ2 :                     34.126 C |  READ2.4 :                   34.130 C |
*READ3 :                     34.143 C |  READ3.5 :                   34.160 C |
 READ4 :                     34.167 C |  READ5 :                     34.205 C |
 READ6 :                     34.214 C |  READ7 :                     34.300 C |
 READ71 :                    34.261 C |  READ72 :                    34.272 C |
 READ8 :                     34.315 C |  REL :                       33.177 C |
 REL. :                      33.175 C |  REL1 :                      33.213 C |
*RELAXED :                        0 - | *ROMBOOT :                   30.000 - |
*RUC :                       33.257 C | *S.BAUD :                    40.346 C |
*S.CAADR :                   40.332 C | *S.CACC :                    41.006 C |
*S.CCTAB :                   40.334 C | *S.CDB :                     40.345 C |
*S.CFWA :                    40.352 C | *S.CODE :                    41.007 C |
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 52 - 2024-07-31 11:12:52 AM


*S.CONFL :                   40.331 C | *S.CONTY :                   40.326 C |
*S.CONWI :                   40.330 C | *S.CSLMD :                        1 - |
*S.CUSOR :                   40.327 C | *S.DATC :                    40.310 C |
*S.DATE :                    40.277 C | *S.DCS :                     41.030 C |
 S.DDDTA :                   40.366 C |  S.DDGRP :                   40.364 C |
 S.DDLDA :                   40.360 C |  S.DDLEN :                   40.362 C |
 S.DDOPC :                   40.370 C |  S.DDSEC :                   40.364 - |
*S.DFWA :                    40.354 C | *S.DIREA :                   41.016 C |
*S.DLINK :                   40.350 C |  S.FASER :                   41.013 C |
*S.FCI :                     41.021 C | *S.GRT :                     24.000 - |
*S.GRT1 :                    25.000 - | *S.HIMEM :                   40.316 C |
 S.INT :                     40.345 C | *S.JUMPS :                   41.010 C |
*S.MOUNT :                   41.027 C | *S.OMAX :                    40.324 C |
 S.OSN :                     41.004 C |  S.OVLE :                    41.000 C |
 S.OVLFL :                   40.371 C |  S.OVLS :                    40.376 C |
*S.OVSTK :                   41.032 C | *S.RFWA :                    40.356 C |
*S.S1DIS :                   41.034 C | *S.S1GRT :                   41.036 C |
*S.SCI :                     41.024 C | *S.SDD :                     41.010 C |
*S.SOVR :                    41.146 C |  S.SSN :                     41.002 C |
 S.SYSM :                    40.320 C | *S.TIME :                    40.312 C |
 S.UCSF :                    40.372 C |  S.UCSL :                    40.374 C |
 S.USRM :                    40.322 C |  S.VAL :                     40.277 C |
*SC.UART :                      372 - |  SCOUT :                          2 C |
*SCOUT.CHFLG :                   60 C | *SCOUT.CLEAR :                   55 C |
*SCOUT.CLEARA :                  56 C | *SCOUT.CLOSE :                   46 C |
*SCOUT.CLRCO :                    7 C | *SCOUT.CONSL :                    6 C |
*SCOUT.CTLC :                    41 C | *SCOUT.DECODE :                  53 C |
*SCOUT.DELET :                   50 C | *SCOUT.DISMT :                   61 C |
*SCOUT.ERROR :                   57 C | *SCOUT.LINK :                    40 C |
*SCOUT.NAME :                    54 C | *SCOUT.OPENC :                   45 C |
*SCOUT.OPENR :                   42 C | *SCOUT.OPENU :                   44 C |
*SCOUT.OPENW :                   43 C | *SCOUT.POSIT :                   47 C |
*SCOUT.PRINT :                    3 C | *SCOUT.READ :                     4 C |
*SCOUT.RENAM :                   51 C | *SCOUT.SETTP :                   52 C |
*SCOUT.SYSRES :                  10 C | *SCOUT.WRITE :                    5 C |
 SDP1 :                      36.130 C |  SDP2 :                      36.145 C |
*SDT1 :                      35.242 C |  SDT3 :                      35.221 C |
 SECSCR :                    26.000 - |  SREAD :                     31.275 C |
 SREAD1 :                    31.305 C |  STACK :                     42.200 - |
 STS1 :                      36.201 C |  STS2 :                      36.222 C |
 STS3 :                      36.233 C |  STZ0 :                      36.251 C |
 SWRITE :                    31.330 C |  SYDD :                      40.130 - |
 SYSCALL :                      377 - | *SYSCALL.EXIT :                   0 C |
*SYSCALL.SCIN :                   1 C |  TFE :                       33.233 C |
 TICCNT :                    40.033 - | *TIME :               "11:12:52 AM" - |
*TRUE :                           1 - | *UBR :                            1 - |
*UCI.ER :                        20 - | *UCI.IE :                         2 - |
*UCI.IR :                       100 - | *UCI.RE :                         4 - |
*UCI.RO :                        40 - | *UCI.TE :                         1 - |
 UDD1 :                      31.163 C | *UDR :                            0 - |
*UF.FCT :                       100 - | *UF.RDA :                         1 - |
*UF.ROR :                         2 - | *UF.RPE :                         4 - |
*UF.TB :                        200 - |  UIVEC :                     40.037 - |
*UMI.16X :                        2 - | *UMI.1B :                       100 - |
*UMI.1X :                         1 - | *UMI.2B :                       300 - |
*UMI.64X :                        3 - | *UMI.HB :                       200 - |
*UMI.L5 :                         0 - | *UMI.L6 :                         4 - |
*UMI.L7 :                        10 - | *UMI.L8 :                        14 - |
*UMI.PA :                        20 - | *UMI.PE :                        40 - |
 UP.DP :                        174 - | *UP.FC :                        175 - |
 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 53 - 2024-07-31 11:12:52 AM


 UP.SC :                        176 - | *UP.SR :                        176 - |
 UP.ST :                        175 - |  USERFWA :                   42.200 - |
*USR.FE :                        40 - | *USR.OE :                        20 - |
*USR.PE :                        10 - | *USR.RXR :                        2 - |
*USR.TXE :                        4 - | *USR.TXR :                        1 - |
*VERSION :                   24.057 - |  WHD :                       36.235 C |
 WNB1 :                      36.374 C |  WNH :                       36.271 C |
 WRIT2.5 :                   34.377 C | *WRITE1 :                    34.370 C |
 WRITE2 :                    34.375 C |  WRITE4 :                    35.016 C |
 WRITE5 :                    35.034 C |  WRITE7 :                    35.122 C |
 WRITE8 :                    35.132 C |  WSC1 :                      36.321 C |
 WSC2 :                      36.336 C |  WSP1 :                      36.355 C |
 XIT1 :                      33.376 C | *Z80SYNTAX :                      0 - |
 ZEROS :                     31.320 C |  ZRO1 :                      31.213 C |

  1.244 symbols
    244 unused symbols

 AS V1.42 Beta [Bld 269] - Source File h17.asm - Page 54 - 2024-07-31 11:12:52 AM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.02 seconds assembly time

 11.019 lines source file
      2 passes
      0 errors
      0 warnings
